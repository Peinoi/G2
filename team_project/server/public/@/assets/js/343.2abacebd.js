"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[343],{6343:function(e,t,a){a.r(t),a.d(t,{default:function(){return O}});a(8743),a(3725),a(9838);var s=a(641),u=a(2644),r=a(9322),i=a(9841),l=a(5220),o=a(4335),n=a(6698),c=a(2351);const d=e=>((0,s.Qi)("data-v-91a9a808"),e=e(),(0,s.jt)(),e),v={class:"p-6 max-w-5xl mx-auto"},m={class:"mb-4 flex items-center justify-between header-row"},p=d(()=>(0,s.Lk)("div",null,[(0,s.Lk)("h2",{class:"text-2xl font-semibold"},"제출본 수정")],-1)),_={key:0,class:"text-gray-500"},y={key:1,class:"text-red-600"},b={key:2,class:"guard-card"},f={key:3},h=["onSubmit"],k={class:"section-header"},E={class:"section-title"},C={key:0,class:"section-desc"},X={class:"sub-header"},g={class:"sub-title"},q={key:0,class:"sub-desc"},A={class:"question-title block mb-2"},w={key:0,class:"required-mark"},S=["onUpdate:modelValue"],x={key:2,class:"choice-group"},L=["name","value","onUpdate:modelValue"],W={class:"choice-label"},U={key:3,class:"choice-group"},V=["value","onUpdate:modelValue"],I={class:"choice-label"},K={key:4,class:"unsupported"},N={class:"form-actions"};var F={__name:"SurveySubmissionEdit",setup(e){const t=(0,l.lq)(),a=(0,l.rd)(),d=t.params.submitCode,F=JSON.parse(localStorage.getItem("user")||"{}"),R=Number(F.user_code||0),$=(0,s.EW)(()=>Number(t.query.role||1)),O=(0,s.EW)(()=>Number(t.query.userId||1)),J=(0,i.KR)(null),j=(0,s.EW)(()=>J.value),z=(0,i.KR)(!1),Q=(0,i.KR)(""),T=(0,i.KR)({}),Y=(0,s.EW)(()=>!!j.value&&(1===$.value&&Number(j.value.written_by)===Number(O.value)));async function D(){z.value=!0,Q.value="";try{const e=await o.A.get(`/api/survey/submission/${d}`);if(!1===e.data?.success)throw new Error(e.data.message||"조회 실패");const t=e.data?.result??e.data;J.value=ae(t)}catch(e){Q.value=e?.response?.data?.message||e.message||"조회 실패"}finally{z.value=!1}}function H(){const e={};j.value.sections?.forEach(t=>{t.subsections?.forEach(t=>{t.items?.forEach(t=>{const a=se(t.answer_text);P(t)?e[t.item_code]=Array.isArray(a)?a:a?[String(a)]:[]:e[t.item_code]=Array.isArray(a)?a[0]??"":a??""})})}),T.value=e}function B(){a.push({path:`/survey/submission/${d}`,query:{role:$.value,userId:O.value}})}async function G(){try{const e=[];if(j.value.sections?.forEach(t=>{t.subsections?.forEach(t=>{t.items?.forEach(t=>{if("Y"===t.is_required){const a=T.value[t.item_code];P(t)?Array.isArray(a)&&0!==a.length||e.push(t.question_text):null!=a&&""!==String(a).trim()||e.push(t.question_text)}})})}),e.length)return void alert(`필수 문항을 입력해주세요:\n- ${e.join("\n- ")}`);const t={answers:T.value,modifier:R},a=await o.A.put(`/api/survey/submission/${d}`,t);if(!1===a.data?.success)throw new Error(a.data.message||"수정 실패");alert("수정 완료!"),B()}catch(e){alert(e?.response?.data?.message||e.message||"수정 실패")}}function M(e){return"RADIO"===String(e.question_type).toUpperCase()}function P(e){return"CHECKBOX"===String(e.question_type).toUpperCase()}function Z(e){return"TEXT"===String(e.question_type).toUpperCase()}function ee(e){return"TEXTAREA"===String(e.question_type).toUpperCase()}function te(e){if(null==e)return[];if(Array.isArray(e))return e;if("object"===typeof e)return e;if("string"===typeof e){const t=e.trim();if(!t)return[];try{return JSON.parse(t)}catch{return[]}}return[]}function ae(e){if(!e)return e;const t=JSON.parse(JSON.stringify(e));return t.sections?.forEach(e=>{e.subsections?.forEach(e=>{e.items?.forEach(e=>{e.option_values=te(e.option_values)})})}),t}function se(e){if(null==e)return null;if(Array.isArray(e))return e;if("object"===typeof e)return e;if("string"===typeof e){const t=e.trim();if(!t)return"";if(t.startsWith("[")&&t.endsWith("]")||t.startsWith("{")&&t.endsWith("}"))try{return JSON.parse(t)}catch{return t}return t}return String(e)}return(0,s.sV)(async()=>{await D(),j.value&&H()}),(e,t)=>((0,s.uX)(),(0,s.CE)("section",v,[(0,s.Lk)("header",m,[p,(0,s.bF)(n.A,{color:"dark",size:"sm",onClick:B},{default:(0,s.k6)(()=>[(0,s.eW)(" ← 상세로 ")]),_:1})]),z.value?((0,s.uX)(),(0,s.CE)("div",_,"불러오는 중...")):Q.value?((0,s.uX)(),(0,s.CE)("div",y,(0,u.v_)(Q.value),1)):Y.value?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("form",{onSubmit:(0,r.D$)(G,["prevent"])},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(j.value.sections,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e.section_code,class:"section-card"},[(0,s.Lk)("div",k,[(0,s.Lk)("h3",E,(0,u.v_)(t+1)+". "+(0,u.v_)(e.section_title),1),e.section_desc?((0,s.uX)(),(0,s.CE)("p",C,(0,u.v_)(e.section_desc),1)):(0,s.Q3)("",!0)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subsections,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e.subsection_code,class:"subsection-card"},[(0,s.Lk)("div",X,[(0,s.Lk)("h4",g,(0,u.v_)(t+1)+"."+(0,u.v_)(a+1)+" "+(0,u.v_)(e.subsection_title),1),e.subsection_desc?((0,s.uX)(),(0,s.CE)("p",q,(0,u.v_)(e.subsection_desc),1)):(0,s.Q3)("",!0)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.items,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:e.item_code,class:"question-card"},[(0,s.Lk)("label",A,[(0,s.eW)((0,u.v_)(t+1)+"."+(0,u.v_)(a+1)+"."+(0,u.v_)(i+1)+" "+(0,u.v_)(e.question_text)+" ",1),"Y"===e.is_required?((0,s.uX)(),(0,s.CE)("span",w," * ")):(0,s.Q3)("",!0)]),Z(e)?((0,s.uX)(),(0,s.Wv)(c.A,{key:0,modelValue:T.value[e.item_code],"onUpdate:modelValue":t=>T.value[e.item_code]=t,id:`item-${e.item_code}`,name:`item-${e.item_code}`,variant:"outline",size:"default",placeholder:e.placeholder||"",isRequired:"Y"===e.is_required},null,8,["modelValue","onUpdate:modelValue","id","name","placeholder","isRequired"])):ee(e)?(0,s.bo)(((0,s.uX)(),(0,s.CE)("textarea",{key:1,"onUpdate:modelValue":t=>T.value[e.item_code]=t,rows:"4",class:"textarea-basic"},null,8,S)),[[r.Jo,T.value[e.item_code]]]):M(e)?((0,s.uX)(),(0,s.CE)("div",x,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.option_values,t=>((0,s.uX)(),(0,s.CE)("label",{key:t.value??t.label,class:"choice-row"},[(0,s.bo)((0,s.Lk)("input",{type:"radio",name:`r-${e.item_code}`,value:t.value??t.label,"onUpdate:modelValue":t=>T.value[e.item_code]=t},null,8,L),[[r.XL,T.value[e.item_code]]]),(0,s.Lk)("span",W,(0,u.v_)(t.label??t.value),1)]))),128))])):P(e)?((0,s.uX)(),(0,s.CE)("div",U,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.option_values,t=>((0,s.uX)(),(0,s.CE)("label",{key:t.value??t.label,class:"choice-row"},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:t.value??t.label,"onUpdate:modelValue":t=>T.value[e.item_code]=t},null,8,V),[[r.lH,T.value[e.item_code]]]),(0,s.Lk)("span",I,(0,u.v_)(t.label??t.value),1)]))),128))])):((0,s.uX)(),(0,s.CE)("div",K," 지원하지 않는 타입입니다. ("+(0,u.v_)(e.question_type)+") ",1))]))),128))]))),128))]))),128)),(0,s.Lk)("div",N,[(0,s.bF)(n.A,{type:"button",color:"dark",size:"sm",variant:"outlined",onClick:B},{default:(0,s.k6)(()=>[(0,s.eW)(" 취소 ")]),_:1}),(0,s.bF)(n.A,{type:"submit",color:"dark",size:"sm"},{default:(0,s.k6)(()=>[(0,s.eW)(" 수정 완료 ")]),_:1})])],40,h)])):((0,s.uX)(),(0,s.CE)("div",b," 수정 권한이 없습니다. (작성자: "+(0,u.v_)(j.value?.written_by)+", 현재 사용자: "+(0,u.v_)(O.value)+") ",1))]))}},R=a(6262);const $=(0,R.A)(F,[["__scopeId","data-v-91a9a808"]]);var O=$}}]);
//# sourceMappingURL=343.2abacebd.js.map