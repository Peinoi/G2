"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[747],{5747:function(e,a,t){t.r(a),t.d(a,{default:function(){return be}});t(8743),t(3725),t(5019),t(9838),t(1339),t(9229);var l=t(641),n=t(2644),s=t(9322),i=t(9841),u=t(5220),o=t(4335),r=t(6698),c=t(6571),d=t(2351);const p=e=>((0,l.Qi)("data-v-89ed639c"),e=e(),(0,l.jt)(),e),m={class:"p-6"},v={class:"page-shell space-y-6"},k=p(()=>(0,l.Lk)("header",{class:"page-header"},[(0,l.Lk)("h2",{class:"page-title text-2xl md:text-3xl font-bold tracking-tight"}," 지원계획 수정 ")],-1)),f={key:0,class:"text-sm text-gray-500"},b={key:1,class:"text-sm text-red-500"},g={class:"meta-card"},C={class:"meta-grid"},h={class:"meta-item"},L=p(()=>(0,l.Lk)("span",{class:"meta-label"},"지원자",-1)),y={class:"meta-value"},x={class:"meta-item"},_=p(()=>(0,l.Lk)("span",{class:"meta-label"},"보호자",-1)),w={class:"meta-value"},A={class:"meta-item"},E=p(()=>(0,l.Lk)("span",{class:"meta-label"},"담당자",-1)),S={class:"meta-value"},F={class:"meta-item"},N=p(()=>(0,l.Lk)("span",{class:"meta-label"},"장애유형",-1)),R={class:"meta-value"},I={class:"meta-item"},K=p(()=>(0,l.Lk)("span",{class:"meta-label"},"우선순위",-1)),X={class:"meta-value"},B={class:"meta-item"},$=p(()=>(0,l.Lk)("span",{class:"meta-label"},"상담지 제출일",-1)),z={class:"meta-value"},V={class:"meta-item"},q=p(()=>(0,l.Lk)("span",{class:"meta-label"},"진행기간",-1)),D={class:"meta-value period-value"},W={class:"card-block space-y-4"},T={class:"form-group"},U=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"계획 목표",-1)),J={class:"form-group"},Q=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (일반용) ",-1)),M={class:"form-group"},O=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (관리자용) ",-1)),P={class:"form-group"},j=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"첨부 파일",-1)),Y=p(()=>(0,l.Lk)("p",{class:"mt-1 text-xs text-gray-500"}," * 여러 개 파일을 한 번에 선택하거나, 나눠서 여러 번 선택할 수 있습니다. ",-1)),G={key:0,class:"mt-2 text-xs text-gray-700 space-y-1"},H={class:"file-link"},Z=["onClick"],ee={key:1,class:"mt-2 text-xs text-gray-700 space-y-1"},ae={class:"file-link"},te=["onClick"],le={class:"record-header"},ne=p(()=>(0,l.Lk)("h4",{class:"font-medium text-sm"},"추가 계획",-1)),se={class:"form-group"},ie=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"계획 목표",-1)),ue={class:"form-group"},oe=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (일반용) ",-1)),re={class:"form-group"},ce=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (관자용) ",-1)),de={class:"action-bar"},pe={class:"left-actions"},me={class:"right-actions"};var ve={__name:"PlanEdit",setup(e){const a=(0,u.lq)(),t=(0,u.rd)(),p=Number(a.params.planCode||0),ve=Number(a.query.submitCode||0),ke=(0,i.KR)({name:"",childName:"",guardianName:"",assigneeName:"",disabilityType:"",counselSubmitAt:"",level:""}),fe=(0,l.EW)(()=>{const e=ke.value.counselSubmitAt;return e?String(e).slice(0,10):"-"}),be=(0,i.KR)({planDate:"",expectedStart:"",expectedEnd:"",goal:"",publicContent:"",privateContent:""}),ge=(0,i.KR)([]),Ce=(0,i.KR)(null),he=(0,i.KR)([]),Le=(0,i.KR)([]),ye=(0,i.KR)([]),xe=(0,i.KR)(!1),_e=(0,i.KR)(""),we=(0,i.KR)(""),Ae=(0,l.EW)(()=>"CC7"===we.value);function Ee(){const e=new Date;return e.toISOString().slice(0,10)}async function Se(){xe.value=!0,_e.value="";try{if(!ve)throw new Error("submitCode가 없습니다. (쿼리로 전달 필요)");if(!p)throw new Error("planCode가 없습니다. (params로 전달 필요)");const[e,a]=await Promise.all([o.A.get(`/api/plans/${ve}`),o.A.get(`/api/plans/detail/${p}`)]);if(!e.data?.success||!e.data.result)throw new Error(e.data?.message||"지원자 기본 정보를 찾을 수 없습니다.");const t=e.data.result;if(ke.value={name:t.name||"",childName:t.childName||"",guardianName:t.guardianName||t.name||"",assigneeName:t.assigneeName||"",disabilityType:t.disabilityType||"",counselSubmitAt:t.counselSubmitAt||"",level:t.level||""},!a.data?.success||!a.data.result)throw new Error(a.data?.message||"지원계획 정보를 찾을 수 없습니다.");const l=a.data.result;be.value={planDate:l.main?.planDate?String(l.main.planDate).slice(0,10):Ee(),expectedStart:l.main?.expectedStart||"",expectedEnd:l.main?.expectedEnd||"",goal:l.main?.goal||"",publicContent:l.main?.publicContent||"",privateContent:l.main?.privateContent||""},we.value=l.status||"",ye.value=(l.items||[]).map((e,a)=>({id:e.planItemCode||Date.now()+a,goal:e.goal||"",publicContent:e.publicContent||"",privateContent:e.privateContent||""}))||[],he.value=(l.attachments||[]).map(e=>({attachCode:e.attachCode,originalFilename:e.originalFilename,url:e.url}))||[]}catch(e){console.error(e),_e.value=e.message||"지원계획 정보 조회 중 오류"}finally{xe.value=!1}}function Fe(e){const a=(e||"").toString().toUpperCase();switch(a){case"BB1":return"긴급";case"BB2":return"중점";case"BB3":return"계획";default:return"-"}}function Ne(e){const a=Array.from(e.target.files||[]),t=a.filter(e=>!ge.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified));ge.value=[...ge.value,...t],e.target&&(e.target.value="")}function Re(e){ge.value.splice(e,1)}function Ie(e,a){a&&!Le.value.includes(a)&&Le.value.push(a),he.value.splice(e,1)}function Ke(){if(!ve)return;const e=`/counsel/detail/${ve}`;window.open(e,"_blank")}function Xe(){t.push({name:"planList"})}function Be(){ye.value.push({id:Date.now(),goal:"",publicContent:"",privateContent:""})}function $e(e){ye.value=ye.value.filter(a=>a.id!==e)}function ze(){if(!be.value.goal.trim())return"계획 목표를 입력해주세요.";if(!be.value.publicContent.trim())return"계획 내용(일반용)을 입력해주세요.";if(!be.value.privateContent.trim())return"계획 내용(관리자용)을 입력해주세요.";for(const e of ye.value){if(!e.goal.trim())return"추가 계획의 목표를 입력해주세요.";if(!e.publicContent.trim())return"추가 계획의 내용(일반용)을 입력해주세요.";if(!e.privateContent.trim())return"추가 계획의 내용(관리자용)을 입력해주세요."}return null}(0,l.sV)(()=>{Se()});const Ve=JSON.parse(localStorage.getItem("user")||"{}"),qe=Number(Ve.user_code||0);async function De(){const e=ze();if(e)alert(e);else try{const e={planCode:p,submitCode:ve,mainForm:be.value,planItems:ye.value,removedAttachCodes:Le.value,modifier:qe},a=new FormData;a.append("formJson",JSON.stringify(e)),ge.value.forEach(e=>{a.append("planFiles",e)});const l=await o.A.put(`/api/plans/${p}`,a,{headers:{"Content-Type":"multipart/form-data"}});if(!l.data?.success)return void alert(l.data.message||"수정 실패");Ae.value?(await o.A.post(`/api/plans/${p}/resubmit`,{requesterCode:2}),alert("재작성된 지원계획이 재승인 요청 되었습니다.")):alert("지원계획이 수정되었습니다."),t.push({name:"planList"})}catch(a){console.error(a),alert("수정 처리 중 서버 오류: "+(a.response?.data?.message||a.message))}}return(e,a)=>((0,l.uX)(),(0,l.CE)("section",m,[(0,l.Lk)("div",v,[k,xe.value?((0,l.uX)(),(0,l.CE)("p",f," 지원계획 정보를 불러오는 중입니다... ")):(0,l.Q3)("",!0),_e.value?((0,l.uX)(),(0,l.CE)("p",b,(0,n.v_)(_e.value),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",g,[(0,l.Lk)("div",C,[(0,l.Lk)("div",h,[L,(0,l.Lk)("span",y,(0,n.v_)(ke.value.childName||"본인"),1)]),(0,l.Lk)("div",x,[_,(0,l.Lk)("span",w,(0,n.v_)(ke.value.name||"-"),1)]),(0,l.Lk)("div",A,[E,(0,l.Lk)("span",S,(0,n.v_)(ke.value.assigneeName||"-"),1)]),(0,l.Lk)("div",F,[N,(0,l.Lk)("span",R,(0,n.v_)(ke.value.disabilityType||"-"),1)]),(0,l.Lk)("div",I,[K,(0,l.Lk)("span",X,(0,n.v_)(Fe(ke.value.level)),1)]),(0,l.Lk)("div",B,[$,(0,l.Lk)("span",z,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Ke},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(fe.value),1)]),_:1})])]),(0,l.Lk)("div",V,[q,(0,l.Lk)("span",D,[(0,l.bo)((0,l.Lk)("input",{type:"month","onUpdate:modelValue":a[0]||(a[0]=e=>be.value.expectedStart=e),class:"input-month"},null,512),[[s.Jo,be.value.expectedStart]]),(0,l.eW)(" ~ "),(0,l.bo)((0,l.Lk)("input",{type:"month","onUpdate:modelValue":a[1]||(a[1]=e=>be.value.expectedEnd=e),class:"input-month"},null,512),[[s.Jo,be.value.expectedEnd]])])])])]),(0,l.Lk)("div",W,[(0,l.Lk)("div",T,[U,(0,l.bF)(d.A,{id:`plan-goal-${(0,i.R1)(p)}`,variant:"static",size:"default",modelValue:be.value.goal,"onUpdate:modelValue":a[2]||(a[2]=e=>be.value.goal=e),placeholder:"지원계획의 목표를 입력하세요"},null,8,["id","modelValue"])]),(0,l.Lk)("div",J,[Q,(0,l.bF)(c.A,{id:"plan-content-public",variant:"outline",rows:4,placeholder:"대상자/일반용 계획 내용을 입력하세요...",value:be.value.publicContent,onInput:a[3]||(a[3]=e=>be.value.publicContent=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",M,[O,(0,l.bF)(c.A,{id:"plan-content-private",variant:"outline",rows:4,placeholder:"관계자/관리자용 내부 계획 내용을 입력하세요...",value:be.value.privateContent,onInput:a[4]||(a[4]=e=>be.value.privateContent=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",P,[j,(0,l.Lk)("input",{ref_key:"fileInputRef",ref:Ce,type:"file",multiple:"",onChange:Ne,class:"file-input"},null,544),Y,he.value.length?((0,l.uX)(),(0,l.CE)("ul",G,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(he.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.attachCode,class:"file-row"},[(0,l.Lk)("span",H,(0,n.v_)(e.originalFilename),1),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:t=>Ie(a,e.attachCode)}," 삭제 ",8,Z)]))),128))])):(0,l.Q3)("",!0),ge.value.length?((0,l.uX)(),(0,l.CE)("ul",ee,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ge.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.name+"_"+e.lastModified+"_"+a,class:"file-row"},[(0,l.Lk)("span",ae,(0,n.v_)(e.name)+" ("+(0,n.v_)((e.size/1024).toFixed(1))+" KB) ",1),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:e=>Re(a)}," 삭제 ",8,te)]))),128))])):(0,l.Q3)("",!0)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ye.value,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"record-card space-y-4"},[(0,l.Lk)("div",le,[ne,(0,l.bF)(r.A,{color:"dark",size:"sm",variant:"outlined",onClick:a=>$e(e.id)},{default:(0,l.k6)(()=>[(0,l.eW)(" 제거 ")]),_:2},1032,["onClick"])]),(0,l.Lk)("div",se,[ie,(0,l.bF)(d.A,{id:`plan-item-goal-${e.id}`,variant:"outline",size:"default",modelValue:e.goal,"onUpdate:modelValue":a=>e.goal=a,placeholder:"추가 계획의 목표를 입력하세요"},null,8,["id","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",ue,[oe,(0,l.bF)(c.A,{id:`plan-item-public-${e.id}`,variant:"outline",rows:3,placeholder:"대상자/일반용 내용을 입력하세요...",value:e.publicContent,onInput:a=>e.publicContent=a.target.value},null,8,["id","value","onInput"])]),(0,l.Lk)("div",re,[ce,(0,l.bF)(c.A,{id:`plan-item-private-${e.id}`,variant:"outline",rows:3,placeholder:"관계자/관리자용 내용을 입력하세요...",value:e.privateContent,onInput:a=>e.privateContent=a.target.value},null,8,["id","value","onInput"])])]))),128)),(0,l.Lk)("div",de,[(0,l.Lk)("div",pe,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Xe},{default:(0,l.k6)(()=>[(0,l.eW)(" 수정 취소 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Be},{default:(0,l.k6)(()=>[(0,l.eW)(" + 계획 추가 ")]),_:1})]),(0,l.Lk)("div",me,[(0,l.bF)(r.A,{color:"dark",size:"sm",class:"ml-auto shrink-0",onClick:De},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(Ae.value?"재작성 완료":"수정 완료"),1)]),_:1})])])])]))}},ke=t(6262);const fe=(0,ke.A)(ve,[["__scopeId","data-v-89ed639c"]]);var be=fe},6571:function(e,a,t){t.d(a,{A:function(){return d}});var l=t(641),n=t(2644);const s=["id","rows","name","value","placeholder","isRequired","disabled"];function i(e,a,t,i,u,o){return(0,l.uX)(),(0,l.CE)("div",{class:(0,n.C4)(["input-group",`input-group-${t.variant} ${o.getStatus(t.error,t.success)}`])},[(0,l.Lk)("textarea",{id:t.id,class:"form-control",rows:t.rows,name:t.name,value:t.value,placeholder:t.placeholder,isRequired:t.isRequired,disabled:t.disabled},null,8,s)],2)}var u=t(5685),o={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,u.A)()},methods:{getStatus:(e,a)=>{let t;return t=a?"is-valid":e?"is-invalid":null,t}}},r=t(6262);const c=(0,r.A)(o,[["render",i]]);var d=c}}]);
//# sourceMappingURL=747.452b7558.js.map