"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[728],{8347:function(a,l,e){e.r(l),e.d(l,{default:function(){return Z}});e(8743);var t=e(641),n=e(9322),u=e(2644),o=e(9841),v=e(4335),s=e(2798),r=e(5220);const p=a=>((0,t.Qi)("data-v-66eb25e3"),a=a(),(0,t.jt)(),a),c={class:"apv-page"},i=p(()=>(0,t.Lk)("h2",{class:"apv-title"},"기관 담당자 승인 및 요청 목록",-1)),d={class:"apv-toolbar"},k={class:"apv-filters"},L=["onKeyup"],b=p(()=>(0,t.Lk)("option",{value:""},"전체",-1)),_=p(()=>(0,t.Lk)("option",{value:"BA1"},"요청",-1)),h=p(()=>(0,t.Lk)("option",{value:"BA2"},"승인",-1)),C=p(()=>(0,t.Lk)("option",{value:"BA3"},"반려",-1)),f=[b,_,h,C],m={class:"apv-table-wrap"},y={class:"apv-table"},A=p(()=>(0,t.Lk)("th",null,"승인코드",-1)),g=p(()=>(0,t.Lk)("th",null,"이름",-1)),K=p(()=>(0,t.Lk)("th",null,"아이디",-1)),R={key:0},w=p(()=>(0,t.Lk)("th",null,"연락처",-1)),E=p(()=>(0,t.Lk)("th",null,"이메일",-1)),$=p(()=>(0,t.Lk)("th",null,"상태",-1)),X=p(()=>(0,t.Lk)("th",null,"요청일",-1)),I=p(()=>(0,t.Lk)("th",null,"처리일",-1)),x=p(()=>(0,t.Lk)("th",null,"관리",-1)),B={key:0},Q=["colspan"],S={key:0},U={class:"apv-actions-cell"},V=["onClick"],j=["onClick"],D={key:1,class:"apv-muted"},F=["onClick"],W={class:"apv-modal"},z=p(()=>(0,t.Lk)("h3",{class:"apv-modal-title"},"반려 사유 입력",-1)),J={class:"apv-modal-sub"},N={class:"apv-pagination"},q=["disabled"],M={class:"apv-page-text"},T=["disabled"],Y={key:1,class:"apv-error",role:"alert"},G="/api/approvals/staff";var H={__name:"StaffApprovals",setup(a){const l=(0,s.n)(),e=(0,r.rd)(),p=(0,t.EW)(()=>"AA3"!==l.role),b=(0,o.KR)([]),_=(0,o.KR)(!1),h=(0,o.KR)(""),C=(0,o.KR)(""),H=(0,o.KR)(""),O=(0,o.KR)(1),P=(0,o.KR)(20),Z=(0,o.KR)(!1),aa=(0,o.KR)(""),la=(0,o.KR)(null);function ea(a){switch(a){case"BA1":return"요청";case"BA2":return"승인";case"BA3":return"반려";default:return a||"-"}}function ta(a){if(!a)return"-";const l=new Date(a);if(isNaN(l.getTime()))return"-";const e=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0");return`${e}-${t}-${n}`}async function na(){_.value=!0,h.value="";try{if(!l.userId)return h.value="로그인 정보가 없습니다.",void(_.value=!1);const a=await v.A.get(G,{params:{state:C.value,keyword:H.value,page:O.value,size:P.value,loginId:l.userId,role:l.role}});b.value=Array.isArray(a.data?.data)?a.data.data:[]}catch(a){console.error(a),h.value="목록을 불러오지 못했습니다.",b.value=[]}finally{_.value=!1}}function ua(a){a<1||(O.value=a,na())}function oa(){O.value=1,na()}async function va(a){if(confirm(`[${a.approval_code}] ${a.user_name} (기관 담당자) 승인 처리할까요?`))try{await v.A.put(`${G}/${encodeURIComponent(a.approval_code)}/approve`,{processorCode:l.userCode}),alert("승인 처리되었습니다."),await na()}catch(e){console.error(e),alert("승인 처리 중 오류가 발생했습니다.")}}function sa(a){la.value=a,aa.value="",Z.value=!0}function ra(){Z.value=!1,la.value=null,aa.value=""}async function pa(){if(la.value)if(aa.value.trim())try{await v.A.put(`${G}/${encodeURIComponent(la.value.approval_code)}/reject`,{reason:aa.value,processorCode:l.userCode}),alert("반려 처리되었습니다."),Z.value=!1,la.value=null,aa.value="",await na()}catch(a){console.error(a),alert("반려 처리 중 오류가 발생했습니다.")}else alert("반려 사유를 입력하세요.")}return(0,t.sV)(async()=>(l.reload(),l.isLogin&&l.userId?"AA3"!==l.role&&"AA4"!==l.role?(alert("기관 관리자 및 시스템 관리자만 접근 가능한 메뉴입니다."),void e.push("/")):void na():(alert("로그인 정보가 없습니다. 다시 로그인 해주세요."),void e.push("/sign-in")))),(a,e)=>((0,t.uX)(),(0,t.CE)("div",c,[i,(0,t.Lk)("div",d,[(0,t.Lk)("div",k,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>H.value=a),class:"apv-input",placeholder:"이름/아이디/기관명/연락처/이메일 검색",onKeyup:(0,n.jR)(na,["enter"])},null,40,L),[[n.Jo,H.value,void 0,{trim:!0}]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),class:"apv-select",onChange:oa},f,544),[[n.u1,C.value]])]),(0,t.Lk)("button",{class:"apv-btn apv-btn-outline",onClick:na},"조회")]),(0,t.Lk)("div",m,[(0,t.Lk)("table",y,[(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[A,g,K,p.value?((0,t.uX)(),(0,t.CE)("th",R,"기관명")):(0,t.Q3)("",!0),w,E,$,X,I,x])]),(0,t.Lk)("tbody",null,[_.value||0!==b.value.length?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("tr",B,[(0,t.Lk)("td",{colspan:p.value?10:9,class:"apv-empty"}," 데이터가 없습니다. ",8,Q)])),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(b.value,a=>((0,t.uX)(),(0,t.CE)("tr",{key:a.approval_code},[(0,t.Lk)("td",null,(0,u.v_)(a.approval_code),1),(0,t.Lk)("td",null,(0,u.v_)(a.user_name),1),(0,t.Lk)("td",null,(0,u.v_)(a.login_id),1),p.value?((0,t.uX)(),(0,t.CE)("td",S,(0,u.v_)(a.organization_name),1)):(0,t.Q3)("",!0),(0,t.Lk)("td",null,(0,u.v_)(a.phone),1),(0,t.Lk)("td",null,(0,u.v_)(a.email),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,u.C4)(["apv-state-pill",`apv-state-${a.state}`])},(0,u.v_)(ea(a.state)),3)]),(0,t.Lk)("td",null,(0,u.v_)(ta(a.request_date)),1),(0,t.Lk)("td",null,(0,u.v_)(a.approval_date?ta(a.approval_date):"-"),1),(0,t.Lk)("td",U,["BA1"===a.state&&"AA3"===(0,o.R1)(l).role?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.Lk)("button",{class:"apv-btn apv-btn-xs apv-btn-primary",onClick:l=>va(a)}," 승인 ",8,V),(0,t.Lk)("button",{class:"apv-btn apv-btn-xs apv-btn-danger",onClick:l=>sa(a)}," 반려 ",8,j)],64)):((0,t.uX)(),(0,t.CE)("span",D,"-"))])]))),128))])])]),Z.value?((0,t.uX)(),(0,t.CE)("div",{key:0,class:"apv-modal-backdrop",onClick:(0,n.D$)(ra,["self"])},[(0,t.Lk)("div",W,[z,(0,t.Lk)("p",J,[(0,t.eW)(" 승인코드: "),(0,t.Lk)("b",null,(0,u.v_)(la.value?.approval_code),1),(0,t.eW)("  / 신청자: "),(0,t.Lk)("b",null,(0,u.v_)(la.value?.user_name),1)]),(0,t.bo)((0,t.Lk)("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>aa.value=a),rows:"4",class:"apv-textarea",placeholder:"반려 사유를 입력하세요."},null,512),[[n.Jo,aa.value,void 0,{trim:!0}]]),(0,t.Lk)("div",{class:"apv-modal-actions"},[(0,t.Lk)("button",{class:"apv-btn",onClick:ra},"취소"),(0,t.Lk)("button",{class:"apv-btn apv-btn-primary",onClick:pa}," 반려 확정 ")])])],8,F)):(0,t.Q3)("",!0),(0,t.Lk)("div",N,[(0,t.Lk)("button",{class:"apv-btn apv-btn-xs",disabled:O.value<=1||_.value,onClick:e[3]||(e[3]=a=>ua(O.value-1))}," 이전 ",8,q),(0,t.Lk)("span",M,(0,u.v_)(O.value),1),(0,t.Lk)("button",{class:"apv-btn apv-btn-xs",disabled:b.value.length<P.value||_.value,onClick:e[4]||(e[4]=a=>ua(O.value+1))}," 다음 ",8,T)]),h.value?((0,t.uX)(),(0,t.CE)("div",Y,(0,u.v_)(h.value),1)):(0,t.Q3)("",!0)]))}},O=e(6262);const P=(0,O.A)(H,[["__scopeId","data-v-66eb25e3"]]);var Z=P}}]);
//# sourceMappingURL=728.a4b367b2.js.map