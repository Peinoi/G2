"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[338],{6888:function(e,t,a){a.d(t,{A:function(){return c}});var l=a(641),s=a(2644);function u(e,t,a,u,n,o){return(0,l.uX)(),(0,l.CE)("ul",{class:(0,s.C4)(["pagination",o.getClasses(a.color,a.size)])},[(0,l.RG)(e.$slots,"default")],2)}var n={name:"MaterialPagination",props:{color:{type:String,default:"success"},size:{type:String,default:"md"}},methods:{getClasses:(e,t)=>{let a,l;return a=e?`pagination-${e}`:null,l=t?`pagination-${t}`:null,`${a} ${l}`}}},o=a(6262);const r=(0,o.A)(n,[["render",u]]);var c=r},7338:function(e,t,a){a.r(t),a.d(t,{default:function(){return me}});a(8743),a(3725),a(5019);var l=a(641),s=a(9322),u=a(2644),n=a(9841),o=a(5220),r=a(4335),c=a(6698),i=a(6888),d=a(8896);const v=e=>((0,l.Qi)("data-v-b6e2de5e"),e=e(),(0,l.jt)(),e),p={class:"p-6"},k={class:"page-shell"},m=v(()=>(0,l.Lk)("header",{class:"mb-2 header-row"},[(0,l.Lk)("div",{class:"header-title"},[(0,l.Lk)("h2",{class:"text-2xl md:text-3xl font-bold tracking-tight whitespace-nowrap align-middle"}," 상담 목록 ")])],-1)),C={class:"filter-row"},f=["onSubmit"],_={class:"filter-field filter-field--search"},b=["placeholder"],h={class:"filter-field filter-field--select select-wrapper"},L=(0,l.Fv)('<option value="ALL" data-v-b6e2de5e>전체 상태</option><option value="TEMP" data-v-b6e2de5e>상담전</option><option value="CB3" data-v-b6e2de5e>검토전</option><option value="CB4" data-v-b6e2de5e>반려</option><option value="CB5" data-v-b6e2de5e>검토완료</option><option value="CB6" data-v-b6e2de5e>재승인요청</option>',6),y=[L],E={class:"filter-field filter-field--select select-wrapper"},g=(0,l.Fv)('<option value="COUNSEL_RECENT" data-v-b6e2de5e>상담일 최신순</option><option value="COUNSEL_OLD" data-v-b6e2de5e>상담일 오래된순</option><option value="SUBMIT_RECENT" data-v-b6e2de5e>제출일 최신순</option><option value="SUBMIT_OLD" data-v-b6e2de5e>제출일 오래된순</option><option value="NAME" data-v-b6e2de5e>이름순</option>',5),A=[g],x={class:"filter-field filter-field--button"},w={key:0,class:"text-gray-500"},B={key:1,class:"text-red-600"},X={key:2,class:"empty-state"},R={key:3,class:"table-wrapper"},S={class:"table-card"},K={class:"nice-table"},N=v(()=>(0,l.Lk)("th",{class:"th-cell text-center w-14"},"No",-1)),W=v(()=>(0,l.Lk)("th",{class:"th-cell"},"지원자 이름",-1)),U=v(()=>(0,l.Lk)("th",{class:"th-cell"},"보호자 이름",-1)),$=v(()=>(0,l.Lk)("th",{class:"th-cell"},"담당자",-1)),M={key:0,class:"th-cell"},T=v(()=>(0,l.Lk)("th",{class:"th-cell"},"조사지 제출일",-1)),F=v(()=>(0,l.Lk)("th",{class:"th-cell"},"상담 작성일",-1)),I=v(()=>(0,l.Lk)("th",{class:"th-cell"},"상태",-1)),O={key:1,class:"th-cell text-center w-24"},Q={key:2,class:"th-cell text-center w-24"},j=["onClick"],D={class:"td-cell text-center"},z={class:"td-cell"},P={class:"td-cell"},V={class:"td-cell"},J={key:0,class:"td-cell"},q={class:"td-cell"},G={class:"td-cell"},H={class:"td-cell td-status"},Y=["onClick"],Z={class:"td-cell text-center"},ee={key:0,class:"mt-6 text-center"},te={key:4,class:"modal-overlay"},ae={class:"modal-container"},le=v(()=>(0,l.Lk)("h3",{class:"text-lg font-semibold mb-3"},"반려 사유",-1)),se={key:0,class:"text-sm text-gray-500"},ue={key:1,class:"text-sm text-red-600"},ne={key:2,class:"space-y-2"},oe={key:0,class:"text-xs text-gray-600"},re={class:"font-medium"},ce={class:"text-sm whitespace-pre-line text-gray-800 max-h-60 overflow-y-auto border rounded px-3 py-2 bg-gray-50"},ie={class:"modal-actions mt-4 flex justify-end gap-2"},de=10;var ve={__name:"CounselList",setup(e){const t=(0,o.rd)(),a=(0,n.KR)(null),v=(0,n.KR)(""),L=(0,n.KR)(2),g=(0,n.KR)([]),ve=(0,n.KR)(!1),pe=(0,n.KR)(null),ke=(0,n.KR)(""),me=(0,n.KR)(""),Ce=(0,n.KR)("ALL"),fe=(0,n.KR)("COUNSEL_RECENT"),_e=(0,l.EW)(()=>4===L.value?"지원자, 보호자, 담당자, 기관명 검색":"지원자, 보호자, 담당자 검색"),be=(0,n.KR)(1),he=(0,n.KR)(!1),Le=(0,n.KR)(""),ye=(0,n.KR)(!1),Ee=(0,n.KR)(""),ge=(0,n.KR)("");function Ae(e){switch(e){case"AA1":return 1;case"AA2":return 2;case"AA3":return 3;case"AA4":return 4;default:return 1}}const xe=(0,l.EW)(()=>2===Number(L.value));function we(e){return(e??"").toString().trim().toUpperCase()}function Be(e){const t=we(e);return"CB1"===t||"CB2"===t}function Xe(e){return e?.slice?.(0,10)||"-"}function Re(e){switch(we(e)){case"CB1":return"상담전";case"CB2":return"상담전";case"CB3":return"검토전";case"CB4":return"반려";case"CB5":return"검토완료";case"CB6":return"재승인요청";default:return e||"-"}}function Se(e){switch(we(e)){case"CB1":case"CB2":return"status-pill--before";case"CB3":return"status-pill--review";case"CB5":return"status-pill--done";case"CB6":return"status-pill--resubmit";default:return"status-pill--default"}}const Ke=(0,l.EW)(()=>{let e=[...g.value];const t=me.value.trim().toLowerCase();return t&&(e=e.filter(e=>{const a=[e.child_name,e.writer_name,e.assi_name],l=4===L.value?[e.org_name]:[],s=[...a,...l];return s.some(e=>String(e||"").toLowerCase().includes(t))})),"ALL"!==Ce.value&&(e="TEMP"===Ce.value?e.filter(e=>Be(e.status)):e.filter(e=>we(e.status)===Ce.value)),"COUNSEL_RECENT"===fe.value?e.sort((e,t)=>{const a=e.note_created_at??"",l=t.note_created_at??"";return a&&l&&a!==l?l.localeCompare(a):(t.submit_at||"").localeCompare(e.submit_at||"")}):"COUNSEL_OLD"===fe.value?e.sort((e,t)=>{const a=e.note_created_at??"",l=t.note_created_at??"";return a&&l&&a!==l?a.localeCompare(l):(e.submit_at||"").localeCompare(t.submit_at||"")}):"SUBMIT_RECENT"===fe.value?e.sort((e,t)=>(t.submit_at||"").localeCompare(e.submit_at||"")):"SUBMIT_OLD"===fe.value?e.sort((e,t)=>(e.submit_at||"").localeCompare(t.submit_at||"")):"NAME"===fe.value&&e.sort((e,t)=>{const a=e.child_name||"본인",l=t.child_name||"본인";return a.localeCompare(l,"ko")}),e}),Ne=(0,l.EW)(()=>Math.max(1,Math.ceil(Ke.value.length/de)||1)),We=(0,l.EW)(()=>{const e=(be.value-1)*de;return Ke.value.slice(e,e+de)});function Ue(e){e<1||e>Ne.value||(be.value=e)}function $e(){me.value=ke.value,be.value=1}async function Me(){ve.value=!0,pe.value=null;try{const e={role:L.value,userId:a.value},{data:t}=await r.A.get("/api/counsel",{params:e});g.value=Array.isArray(t?.result)?t.result:[],be.value=1}catch(e){console.error(e),pe.value=e.message||"상담 목록 조회 중 오류",g.value=[]}finally{ve.value=!1}}async function Te(e){he.value=!0,Le.value="",ge.value="",Ee.value="",ye.value=!0;try{const t=Number(e.submit_code);if(!t)throw new Error("유효한 제출번호가 없습니다. (submit_code 없음)");const{data:a}=await r.A.get(`/api/counsel/${t}/rejection-reason`);if(!1===a?.success)throw new Error(a.message||"반려 사유를 불러오지 못했습니다.");const l=a.result||a;Le.value=l.rejection_reason??a.rejection_reason??"",ge.value=l.rejection_date??a.rejection_date??""}catch(t){console.error(t),Ee.value=t.response?.data?.message||t.message||"반려 사유 조회 중 오류"}finally{ye.value=!1}}function Fe(){he.value=!1}function Ie(e){t.push({name:"counsel-new",params:{submitCode:e.submit_code}})}function Oe(e){t.push({name:"counsel-edit",params:{submitCode:e.submit_code}})}function Qe(e){t.push({name:"counsel-detail",params:{submitCode:e.submit_code},query:{role:L.value}})}return(0,l.sV)(()=>{try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e),l=t.user_code??null,s=t.role??"AA1";a.value=l?Number(l):null,v.value=String(s).toUpperCase(),L.value=Ae(v.value)}else a.value=null,v.value="AA1",L.value=Ae("AA1")}catch(e){console.error("localStorage user 파싱 오류:",e),a.value=null,v.value="AA1",L.value=Ae("AA1")}Me()}),(e,t)=>((0,l.uX)(),(0,l.CE)("section",p,[(0,l.Lk)("div",k,[m,(0,l.Lk)("div",C,[(0,l.Lk)("form",{class:"filter-form",onSubmit:(0,s.D$)($e,["prevent"])},[(0,l.Lk)("div",_,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>ke.value=e),type:"text",class:"search-input",placeholder:_e.value},null,8,b),[[s.Jo,ke.value]])]),(0,l.Lk)("div",h,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>Ce.value=e),class:"select-input"},y,512),[[s.u1,Ce.value]])]),(0,l.Lk)("div",E,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>fe.value=e),class:"select-input"},A,512),[[s.u1,fe.value]])]),(0,l.Lk)("div",x,[(0,l.bF)(c.A,{type:"submit",color:"dark",size:"sm"},{default:(0,l.k6)(()=>[(0,l.eW)(" 검색 ")]),_:1})])],40,f)]),ve.value?((0,l.uX)(),(0,l.CE)("div",w,"불러오는 중...")):pe.value?((0,l.uX)(),(0,l.CE)("div",B,(0,u.v_)(pe.value),1)):0===g.value.length?((0,l.uX)(),(0,l.CE)("div",X," 상담 내역이 없습니다. ")):((0,l.uX)(),(0,l.CE)("div",R,[(0,l.Lk)("div",S,[(0,l.Lk)("table",K,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[N,W,U,$,4===L.value?((0,l.uX)(),(0,l.CE)("th",M,"기관명")):(0,l.Q3)("",!0),T,F,I,xe.value?((0,l.uX)(),(0,l.CE)("th",O)):((0,l.uX)(),(0,l.CE)("th",Q))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(We.value,(e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:e.submit_code,class:"table-row-item",onClick:t=>Qe(e)},[(0,l.Lk)("td",D,(0,u.v_)((be.value-1)*de+t+1),1),(0,l.Lk)("td",z,(0,u.v_)(e.child_name?e.child_name:"본인"),1),(0,l.Lk)("td",P,(0,u.v_)(e.writer_name),1),(0,l.Lk)("td",V,(0,u.v_)(e.assi_name),1),4===L.value?((0,l.uX)(),(0,l.CE)("td",J,(0,u.v_)(e.org_name||"-"),1)):(0,l.Q3)("",!0),(0,l.Lk)("td",q,(0,u.v_)(Xe(e.submit_at)),1),(0,l.Lk)("td",G,(0,u.v_)(Be(e.status)?"-":Xe(e.note_created_at)),1),(0,l.Lk)("td",H,["CB4"===we(e.status)?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"status-pill status-pill--rejected status-pill--clickable",onClick:(0,s.D$)(t=>Te(e),["stop"])},(0,u.v_)(Re(e.status)),9,Y)):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,u.C4)(["status-pill",Se(e.status)])},(0,u.v_)(Re(e.status)),3))]),(0,l.Lk)("td",Z,[xe.value?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[["CB1","CB2"].includes(we(e.status))?((0,l.uX)(),(0,l.Wv)(c.A,{key:0,color:"dark",size:"sm",onClick:(0,s.D$)(t=>Ie(e),["stop"])},{default:(0,l.k6)(()=>[(0,l.eW)(" 작성하기 ")]),_:2},1032,["onClick"])):"CB3"===we(e.status)?((0,l.uX)(),(0,l.Wv)(c.A,{key:1,color:"dark",size:"sm",onClick:(0,s.D$)(t=>Oe(e),["stop"])},{default:(0,l.k6)(()=>[(0,l.eW)(" 수정하기 ")]),_:2},1032,["onClick"])):"CB4"===we(e.status)?((0,l.uX)(),(0,l.Wv)(c.A,{key:2,color:"dark",size:"sm",onClick:(0,s.D$)(t=>Oe(e),["stop"])},{default:(0,l.k6)(()=>[(0,l.eW)(" 재수정하기 ")]),_:2},1032,["onClick"])):(0,l.Q3)("",!0)],64)):(0,l.Q3)("",!0)])],8,j))),128))])])]),Ne.value>1?((0,l.uX)(),(0,l.CE)("div",ee,[(0,l.bF)(i.A,{color:"dark",size:"md",class:"pagination"},{default:(0,l.k6)(()=>[(0,l.bF)(d.A,{prev:"",disabled:1===be.value,onClick:t[3]||(t[3]=e=>Ue(be.value-1))},null,8,["disabled"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ne.value,e=>((0,l.uX)(),(0,l.Wv)(d.A,{key:e,label:String(e),active:e===be.value,onClick:t=>Ue(e)},null,8,["label","active","onClick"]))),128)),(0,l.bF)(d.A,{next:"",disabled:be.value===Ne.value,onClick:t[4]||(t[4]=e=>Ue(be.value+1))},null,8,["disabled"])]),_:1})])):(0,l.Q3)("",!0)])),he.value?((0,l.uX)(),(0,l.CE)("div",te,[(0,l.Lk)("div",ae,[le,ye.value?((0,l.uX)(),(0,l.CE)("div",se," 불러오는 중... ")):Ee.value?((0,l.uX)(),(0,l.CE)("div",ue,(0,u.v_)(Ee.value),1)):((0,l.uX)(),(0,l.CE)("div",ne,[ge.value?((0,l.uX)(),(0,l.CE)("div",oe,[(0,l.eW)(" 반려일자: "),(0,l.Lk)("span",re,(0,u.v_)(String(ge.value).slice(0,10)),1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",ce,(0,u.v_)(Le.value||"등록된 반려 사유가 없습니다."),1)])),(0,l.Lk)("div",ie,[(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:Fe},{default:(0,l.k6)(()=>[(0,l.eW)(" 닫기 ")]),_:1})])])])):(0,l.Q3)("",!0)])]))}},pe=a(6262);const ke=(0,pe.A)(ve,[["__scopeId","data-v-b6e2de5e"]]);var me=ke},8896:function(e,t,a){a.d(t,{A:function(){return v}});var l=a(641),s=a(2644);const u={class:"page-link",href:"javascript:;"},n={key:0,class:"fa fa-angle-left"},o={key:1,class:"fa fa-angle-right"};function r(e,t,a,r,c,i){return(0,l.uX)(),(0,l.CE)("li",{class:(0,s.C4)(["page-item",i.getClasses(a.active,a.disabled)])},[(0,l.Lk)("a",u,[(0,l.eW)((0,s.v_)(a.prev||a.next?null:a.label)+" ",1),a.prev?((0,l.uX)(),(0,l.CE)("i",n)):(0,l.Q3)("",!0),a.next?((0,l.uX)(),(0,l.CE)("i",o)):(0,l.Q3)("",!0)])],2)}var c={name:"MaterialPaginationItem",props:{label:{type:String,default:""},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},prev:{type:Boolean,default:!1},next:{type:Boolean,default:!1}},methods:{getClasses:(e,t)=>{let a,l;return a=e?"active":null,l=t?"disabled":null,`${a} ${l}`}}},i=a(6262);const d=(0,i.A)(c,[["render",r]]);var v=d}}]);
//# sourceMappingURL=338.80df9bf7.js.map