"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[461],{2461:function(a,l,e){e.r(l),e.d(l,{default:function(){return z}});e(8743);var t=e(641),n=e(9322),u=e(2644),o=e(9841),s=e(4335),v=e(2798),r=e(5220);const p=a=>((0,t.Qi)("data-v-3d1aae28"),a=a(),(0,t.jt)(),a),c={class:"apv-page"},i=p(()=>(0,t.Lk)("h2",{class:"apv-title"},"승인 및 요청 목록",-1)),d={class:"apv-toolbar"},k={class:"apv-filters"},L=["onKeyup"],b=p(()=>(0,t.Lk)("option",{value:""},"전체",-1)),_=p(()=>(0,t.Lk)("option",{value:"BA1"},"요청",-1)),h=p(()=>(0,t.Lk)("option",{value:"BA2"},"승인",-1)),C=p(()=>(0,t.Lk)("option",{value:"BA3"},"반려",-1)),m=[b,_,h,C],f={class:"apv-table-wrap"},y={class:"apv-table"},g=p(()=>(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"승인코드"),(0,t.Lk)("th",null,"이름"),(0,t.Lk)("th",null,"아이디"),(0,t.Lk)("th",null,"기관명"),(0,t.Lk)("th",null,"연락처"),(0,t.Lk)("th",null,"이메일"),(0,t.Lk)("th",null,"상태"),(0,t.Lk)("th",null,"요청일"),(0,t.Lk)("th",null,"처리일"),(0,t.Lk)("th",null,"관리")])],-1)),A={key:0},R=p(()=>(0,t.Lk)("td",{colspan:"10",class:"apv-empty"},"데이터가 없습니다.",-1)),K=[R],w={class:"apv-actions-cell"},E=["onClick"],$=["onClick"],X={key:1,class:"apv-muted"},x=["onClick"],B={class:"apv-modal"},U=p(()=>(0,t.Lk)("h3",{class:"apv-modal-title"},"반려 사유 입력",-1)),V={class:"apv-modal-sub"},I={class:"apv-pagination"},Q=["disabled"],S={class:"apv-page-text"},j=["disabled"],D={key:1,class:"apv-error",role:"alert"};var F={__name:"ManagerApprovals",setup(a){const l=(0,v.n)(),e=(0,r.rd)();(0,t.sV)(()=>{l.reload(),"AA4"!==l.role&&(alert("접근 권한이 없습니다."),e.push("/"))});const p=(0,o.KR)([]),b=(0,o.KR)(!1),_=(0,o.KR)(""),h=(0,o.KR)(!1),C=(0,o.KR)(""),R=(0,o.KR)(null),F=(0,o.KR)(""),M=(0,o.KR)(""),N=(0,o.KR)(1),z=(0,o.KR)(20);function G(a){switch(a){case"BA1":return"요청";case"BA2":return"승인";case"BA3":return"반려";default:return a||"-"}}function J(a){if(!a)return"-";const l=new Date(a);if(isNaN(l.getTime()))return"-";const e=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0");return`${e}-${t}-${n}`}async function W(){b.value=!0,_.value="";try{const a=await s.A.get("/api/approvals",{params:{type:"ORG_MANAGER",state:F.value,keyword:M.value,page:N.value,size:z.value}});p.value=Array.isArray(a.data?.data)?a.data.data:[]}catch(a){console.error(a),_.value="목록을 불러오지 못했습니다.",p.value=[]}finally{b.value=!1}}function q(a){a<1||(N.value=a,W())}function O(){N.value=1,W()}async function T(a){if(confirm(`[${a.approval_code}] ${a.user_name} 승인 처리할까요?`))try{await s.A.put(`/api/approvals/${encodeURIComponent(a.approval_code)}/approve`,{processorCode:l.userCode}),alert("승인 처리되었습니다."),await W()}catch(e){console.error(e),alert("승인 처리 중 오류가 발생했습니다.")}}async function Y(a){R.value=a,C.value="",h.value=!0}function H(){h.value=!1,R.value=null,C.value=""}async function P(){if(R.value)if(C.value.trim())try{await s.A.put(`/api/approvals/${encodeURIComponent(R.value.approval_code)}/reject`,{reason:C.value,processorCode:l.userCode}),alert("반려 처리되었습니다."),h.value=!1,R.value=null,C.value="",await W()}catch(a){console.error(a),alert("반려 처리 중 오류가 발생했습니다.")}else alert("반려 사유를 입력하세요.")}return(0,t.sV)(W),(a,l)=>((0,t.uX)(),(0,t.CE)("div",c,[i,(0,t.Lk)("div",d,[(0,t.Lk)("div",k,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>M.value=a),class:"apv-input",placeholder:"이름/아이디/기관명/연락처/이메일 검색",onKeyup:(0,n.jR)(W,["enter"])},null,40,L),[[n.Jo,M.value,void 0,{trim:!0}]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>F.value=a),class:"apv-select",onChange:O},m,544),[[n.u1,F.value]])]),(0,t.Lk)("button",{class:"apv-btn apv-btn-outline",onClick:W},"조회")]),(0,t.Lk)("div",f,[(0,t.Lk)("table",y,[g,(0,t.Lk)("tbody",null,[b.value||0!==p.value.length?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("tr",A,K)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(p.value,a=>((0,t.uX)(),(0,t.CE)("tr",{key:a.approval_code},[(0,t.Lk)("td",null,(0,u.v_)(a.approval_code),1),(0,t.Lk)("td",null,(0,u.v_)(a.user_name),1),(0,t.Lk)("td",null,(0,u.v_)(a.login_id),1),(0,t.Lk)("td",null,(0,u.v_)(a.organization_name),1),(0,t.Lk)("td",null,(0,u.v_)(a.phone),1),(0,t.Lk)("td",null,(0,u.v_)(a.email),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,u.C4)(["apv-state-pill",`apv-state-${a.state}`])},(0,u.v_)(G(a.state)),3)]),(0,t.Lk)("td",null,(0,u.v_)(J(a.request_date)),1),(0,t.Lk)("td",null,(0,u.v_)(a.approval_date?J(a.approval_date):"-"),1),(0,t.Lk)("td",w,["BA1"===a.state?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.Lk)("button",{class:"apv-btn apv-btn-xs apv-btn-primary",onClick:l=>T(a)}," 승인 ",8,E),(0,t.Lk)("button",{class:"apv-btn apv-btn-xs apv-btn-danger",onClick:l=>Y(a)}," 반려 ",8,$)],64)):((0,t.uX)(),(0,t.CE)("span",X,"-"))])]))),128))])])]),h.value?((0,t.uX)(),(0,t.CE)("div",{key:0,class:"apv-modal-backdrop",onClick:(0,n.D$)(H,["self"])},[(0,t.Lk)("div",B,[U,(0,t.Lk)("p",V,[(0,t.eW)(" 승인코드: "),(0,t.Lk)("b",null,(0,u.v_)(R.value?.approval_code),1),(0,t.eW)("  / 신청자: "),(0,t.Lk)("b",null,(0,u.v_)(R.value?.user_name),1)]),(0,t.bo)((0,t.Lk)("textarea",{"onUpdate:modelValue":l[2]||(l[2]=a=>C.value=a),rows:"4",class:"apv-textarea",placeholder:"반려 사유를 입력하세요."},null,512),[[n.Jo,C.value,void 0,{trim:!0}]]),(0,t.Lk)("div",{class:"apv-modal-actions"},[(0,t.Lk)("button",{class:"apv-btn",onClick:H},"취소"),(0,t.Lk)("button",{class:"apv-btn apv-btn-primary",onClick:P}," 반려 확정 ")])])],8,x)):(0,t.Q3)("",!0),(0,t.Lk)("div",I,[(0,t.Lk)("button",{class:"apv-btn apv-btn-xs",disabled:N.value<=1||b.value,onClick:l[3]||(l[3]=a=>q(N.value-1))}," 이전 ",8,Q),(0,t.Lk)("span",S,(0,u.v_)(N.value),1),(0,t.Lk)("button",{class:"apv-btn apv-btn-xs",disabled:p.value.length<z.value||b.value,onClick:l[4]||(l[4]=a=>q(N.value+1))}," 다음 ",8,j)]),_.value?((0,t.uX)(),(0,t.CE)("div",D,(0,u.v_)(_.value),1)):(0,t.Q3)("",!0)]))}},M=e(6262);const N=(0,M.A)(F,[["__scopeId","data-v-3d1aae28"]]);var z=N}}]);
//# sourceMappingURL=461.23128883.js.map