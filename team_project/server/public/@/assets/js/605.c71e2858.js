"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[605],{6571:function(e,a,t){t.d(a,{A:function(){return d}});var l=t(641),n=t(2644);const s=["id","rows","name","value","placeholder","isRequired","disabled"];function i(e,a,t,i,u,o){return(0,l.uX)(),(0,l.CE)("div",{class:(0,n.C4)(["input-group",`input-group-${t.variant} ${o.getStatus(t.error,t.success)}`])},[(0,l.Lk)("textarea",{id:t.id,class:"form-control",rows:t.rows,name:t.name,value:t.value,placeholder:t.placeholder,isRequired:t.isRequired,disabled:t.disabled},null,8,s)],2)}var u=t(5685),o={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,u.A)()},methods:{getStatus:(e,a)=>{let t;return t=a?"is-valid":e?"is-invalid":null,t}}},r=t(6262);const c=(0,r.A)(o,[["render",i]]);var d=c},7605:function(e,a,t){t.r(a),t.d(a,{default:function(){return he}});t(8743),t(3725),t(5019),t(9838),t(1339),t(9229);var l=t(641),n=t(2644),s=t(9322),i=t(9841),u=t(5220),o=t(4335),r=t(6698),c=t(6571),d=t(2351);const p=e=>((0,l.Qi)("data-v-19e53104"),e=e(),(0,l.jt)(),e),m={class:"p-6"},v={class:"page-shell space-y-6"},k={class:"page-header"},f=p(()=>(0,l.Lk)("h2",{class:"page-title text-2xl md:text-3xl font-bold tracking-tight"}," 지원계획 작성 ",-1)),b={class:"header-actions"},g={key:0,class:"text-sm text-gray-500"},C={key:1,class:"text-sm text-red-500"},h={class:"meta-card"},L={class:"meta-grid"},y={class:"meta-item"},x=p(()=>(0,l.Lk)("span",{class:"meta-label"},"지원자",-1)),_={class:"meta-value"},A={class:"meta-item"},w=p(()=>(0,l.Lk)("span",{class:"meta-label"},"보호자",-1)),F={class:"meta-value"},S={class:"meta-item"},E=p(()=>(0,l.Lk)("span",{class:"meta-label"},"담당자",-1)),N={class:"meta-value"},I={class:"meta-item"},R=p(()=>(0,l.Lk)("span",{class:"meta-label"},"장애유형",-1)),K={class:"meta-value"},z={class:"meta-item"},D=p(()=>(0,l.Lk)("span",{class:"meta-label"},"우선순위",-1)),X={class:"meta-value"},B={class:"meta-item"},V=p(()=>(0,l.Lk)("span",{class:"meta-label"},"상담지 제출일",-1)),W={class:"meta-value"},$={class:"meta-item"},T=p(()=>(0,l.Lk)("span",{class:"meta-label"},"예상 진행기간",-1)),q={class:"meta-value period-value"},J=p(()=>(0,l.Lk)("span",{class:"mx-1"},"~",-1)),U={class:"card-block space-y-4"},Q={class:"form-group"},M=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"계획 목표",-1)),O={class:"form-group"},j=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (일반용) ",-1)),P={class:"form-group"},Y=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (관리자용) ",-1)),G={class:"form-group"},H=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"첨부 파일",-1)),Z=p(()=>(0,l.Lk)("p",{class:"mt-1 text-xs text-gray-500"}," * 여러 개 파일을 한 번에 선택하거나, 나눠서 여러 번 선택할 수 있습니다. ",-1)),ee={key:0,class:"mt-2 text-xs text-gray-700 space-y-1"},ae=["href"],te=["onClick"],le={key:1,class:"mt-2 text-xs text-gray-700 space-y-1"},ne={class:"file-link"},se=["onClick"],ie={class:"record-header"},ue=p(()=>(0,l.Lk)("h4",{class:"font-medium text-sm"},"추가 계획",-1)),oe={class:"form-group"},re=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"계획 목표",-1)),ce={class:"form-group"},de=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (일반용) ",-1)),pe={class:"form-group"},me=p(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"}," 계획 내용 (관리자용) ",-1)),ve={class:"action-bar"},ke={class:"left-actions"},fe={class:"right-actions"};var be={__name:"PlanWrite",setup(e){const a=(0,u.lq)(),t=(0,u.rd)(),p=Number(a.params.submitcode||0),be=(0,i.KR)({childName:"",name:"",guardianName:"",assigneeName:"",disabilityType:"",counselSubmitAt:"",level:""}),ge=(0,l.EW)(()=>{const e=be.value.counselSubmitAt;return e?e.slice(0,10):"-"}),Ce=(0,i.KR)({planDate:"",expectedStart:"",expectedEnd:"",goal:"",publicContent:"",privateContent:""}),he=(0,i.KR)([]),Le=(0,i.KR)(null),ye=(0,i.KR)([]),xe=(0,i.KR)([]),_e=(0,i.KR)([]),Ae=(0,i.KR)(!1),we=(0,i.KR)("");function Fe(){const e=new Date;return e.toISOString().slice(0,10)}async function Se(){Ae.value=!0,we.value="";try{const{data:e}=await o.A.get(`/api/plans/${p}`);if(!e?.success||!e.result)throw new Error(e?.message||"기본 정보를 찾을 수 없습니다.");const a=e.result;be.value={childName:a.childName||"본인",name:a.name||"",guardianName:a.guardianName||a.name||"",assigneeName:a.assigneeName||"-",disabilityType:a.disabilityType||"-",counselSubmitAt:a.counselSubmitAt||"",level:a.level||""},Ce.value.planDate||(Ce.value.planDate=Fe())}catch(e){console.error(e),we.value=e.message||"기본 정보 조회 중 오류"}finally{Ae.value=!1}}function Ee(e){const a=(e||"").toString().toUpperCase();switch(a){case"BB1":return"긴급";case"BB2":return"중점";case"BB3":return"계획";default:return"-"}}function Ne(e){const a=Array.from(e.target.files||[]),t=a.filter(e=>!he.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified));he.value=[...he.value,...t],e.target&&(e.target.value="")}function Ie(e){he.value.splice(e,1)}function Re(e,a){a&&!xe.value.includes(a)&&xe.value.push(a),ye.value.splice(e,1)}async function Ke(){try{const e={submitCode:p,mainForm:Ce.value,planItems:_e.value,removedAttachCodes:xe.value},a=new FormData;a.append("formJson",JSON.stringify(e)),he.value.forEach(e=>{a.append("planFiles",e)});const t=await o.A.post("/api/plans/temp",a,{headers:{"Content-Type":"multipart/form-data"}});t.data?.success?alert("임시 저장이 완료되었습니다."):alert(t.data.message||"임시 저장 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}}async function ze(){try{const{data:e}=await o.A.get(`/api/plans/form/${p}`);if(!e?.success||!e.result)return void alert(e?.message||"불러올 지원계획 내용이 없습니다.");const a=e.result;Ce.value={planDate:a.main?.planDate?String(a.main.planDate).slice(0,10):Fe(),expectedStart:a.main?.expectedStart||"",expectedEnd:a.main?.expectedEnd||"",goal:a.main?.goal||"",publicContent:a.main?.publicContent||"",privateContent:a.main?.privateContent||""},_e.value=(a.items||[]).map((e,a)=>({id:e.planItemCode||Date.now()+a,goal:e.goal||"",publicContent:e.publicContent||"",privateContent:e.privateContent||""}))||[],ye.value=(a.attachments||[]).map(e=>({attachCode:e.attachCode,originalFilename:e.originalFilename,url:e.url}))||[],xe.value=[],alert("임시 저장된 지원계획을 불러왔습니다.")}catch(e){console.error(e),alert("지원계획 불러오기 중 오류: "+(e.response?.data?.message||e.message))}}function De(){window.open(`/counsel/detail/${p}`,"_blank")}function Xe(){t.push({name:"planList"})}function Be(){_e.value.push({id:Date.now(),goal:"",publicContent:"",privateContent:""})}function Ve(e){_e.value=_e.value.filter(a=>a.id!==e)}function We(){if(!Ce.value.expectedStart)return"예상 진행기간 시작 월을 선택해주세요.";if(!Ce.value.expectedEnd)return"예상 진행기간 종료 월을 선택해주세요.";if(Ce.value.expectedStart>Ce.value.expectedEnd)return"예상 진행기간의 시작 월이 종료 월보다 늦을 수 없습니다.";if(!Ce.value.goal.trim())return"계획 목표를 입력해주세요.";if(!Ce.value.publicContent.trim())return"계획 내용(일반용)을 입력해주세요.";if(!Ce.value.privateContent.trim())return"계획 내용(관자용)을 입력해주세요.";for(const e of _e.value){if(!e.goal.trim())return"추가 계획의 목표를 입력해주세요.";if(!e.publicContent.trim())return"추가 계획의 내용(일반용)을 입력해주세요.";if(!e.privateContent.trim())return"추가 계획의 내용(관자용)을 입력해주세요."}return null}async function $e(){const e=We();if(e)alert(e);else try{const e={submitCode:p,mainForm:Ce.value,planItems:_e.value,removedAttachCodes:xe.value},a=new FormData;a.append("formJson",JSON.stringify(e)),he.value.forEach(e=>{a.append("planFiles",e)});const l=await o.A.post("/api/plans/new",a,{headers:{"Content-Type":"multipart/form-data"}});l.data?.success?(alert("지원계획이 저장되었습니다."),t.push({name:"planList"})):alert(l.data.message||"저장 실패")}catch(a){console.error(a),alert("서버 오류: "+(a.response?.data?.message||a.message))}}return(0,l.sV)(()=>{Ce.value.planDate=Fe(),Se()}),(e,a)=>((0,l.uX)(),(0,l.CE)("section",m,[(0,l.Lk)("div",v,[(0,l.Lk)("header",k,[f,(0,l.Lk)("div",b,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:ze},{default:(0,l.k6)(()=>[(0,l.eW)(" 불러오기 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Ke},{default:(0,l.k6)(()=>[(0,l.eW)(" 임시 저장 ")]),_:1})])]),Ae.value?((0,l.uX)(),(0,l.CE)("p",g," 기본 정보를 불러오는 중입니다... ")):(0,l.Q3)("",!0),we.value?((0,l.uX)(),(0,l.CE)("p",C,(0,n.v_)(we.value),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",h,[(0,l.Lk)("div",L,[(0,l.Lk)("div",y,[x,(0,l.Lk)("span",_,(0,n.v_)(be.value.childName||"본인"),1)]),(0,l.Lk)("div",A,[w,(0,l.Lk)("span",F,(0,n.v_)(be.value.guardianName||"-"),1)]),(0,l.Lk)("div",S,[E,(0,l.Lk)("span",N,(0,n.v_)(be.value.assigneeName||"-"),1)]),(0,l.Lk)("div",I,[R,(0,l.Lk)("span",K,(0,n.v_)(be.value.disabilityType||"-"),1)]),(0,l.Lk)("div",z,[D,(0,l.Lk)("span",X,(0,n.v_)(Ee(be.value.level)),1)]),(0,l.Lk)("div",B,[V,(0,l.Lk)("span",W,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:De},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(ge.value),1)]),_:1})])]),(0,l.Lk)("div",$,[T,(0,l.Lk)("span",q,[(0,l.bo)((0,l.Lk)("input",{type:"month","onUpdate:modelValue":a[0]||(a[0]=e=>Ce.value.expectedStart=e),class:"input input-month"},null,512),[[s.Jo,Ce.value.expectedStart]]),J,(0,l.bo)((0,l.Lk)("input",{type:"month","onUpdate:modelValue":a[1]||(a[1]=e=>Ce.value.expectedEnd=e),class:"input input-month"},null,512),[[s.Jo,Ce.value.expectedEnd]])])])])]),(0,l.Lk)("div",U,[(0,l.Lk)("div",Q,[M,(0,l.bF)(d.A,{id:"plan-goal",variant:"static",size:"default",modelValue:Ce.value.goal,"onUpdate:modelValue":a[2]||(a[2]=e=>Ce.value.goal=e),placeholder:"지원계획의 목표를 입력하세요"},null,8,["modelValue"])]),(0,l.Lk)("div",O,[j,(0,l.bF)(c.A,{id:"plan-content-public",variant:"outline",rows:4,placeholder:"대상자/일반용 계획 내용을 입력하세요...",value:Ce.value.publicContent,onInput:a[3]||(a[3]=e=>Ce.value.publicContent=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",P,[Y,(0,l.bF)(c.A,{id:"plan-content-private",variant:"outline",rows:4,placeholder:"관계자/관리자용 내부 계획 내용을 입력하세요...",value:Ce.value.privateContent,onInput:a[4]||(a[4]=e=>Ce.value.privateContent=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",G,[H,(0,l.Lk)("input",{ref_key:"fileInputRef",ref:Le,type:"file",multiple:"",onChange:Ne,class:"file-input"},null,544),Z,ye.value.length?((0,l.uX)(),(0,l.CE)("ul",ee,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ye.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.attachCode,class:"file-row"},[(0,l.Lk)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",class:"file-link"},(0,n.v_)(e.originalFilename),9,ae),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:t=>Re(a,e.attachCode)}," 삭제 ",8,te)]))),128))])):(0,l.Q3)("",!0),he.value.length?((0,l.uX)(),(0,l.CE)("ul",le,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(he.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.name+"_"+e.lastModified+"_"+a,class:"file-row"},[(0,l.Lk)("span",ne,(0,n.v_)(e.name)+" ("+(0,n.v_)((e.size/1024).toFixed(1))+" KB) ",1),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:e=>Ie(a)}," 삭제 ",8,se)]))),128))])):(0,l.Q3)("",!0)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_e.value,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"record-card space-y-4"},[(0,l.Lk)("div",ie,[ue,(0,l.bF)(r.A,{color:"dark",size:"sm",variant:"outlined",onClick:a=>Ve(e.id)},{default:(0,l.k6)(()=>[(0,l.eW)(" 제거 ")]),_:2},1032,["onClick"])]),(0,l.Lk)("div",oe,[re,(0,l.bF)(d.A,{id:`plan-item-goal-${e.id}`,variant:"static",size:"default",modelValue:e.goal,"onUpdate:modelValue":a=>e.goal=a,placeholder:"추가 계획의 목표를 입력하세요"},null,8,["id","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",ce,[de,(0,l.bF)(c.A,{id:`plan-item-public-${e.id}`,variant:"outline",rows:3,placeholder:"대상자/일반용 내용을 입력하세요...",value:e.publicContent,onInput:a=>e.publicContent=a.target.value},null,8,["id","value","onInput"])]),(0,l.Lk)("div",pe,[me,(0,l.bF)(c.A,{id:`plan-item-private-${e.id}`,variant:"outline",rows:3,placeholder:"관계자/관리자용 내용을 입력하세요...",value:e.privateContent,onInput:a=>e.privateContent=a.target.value},null,8,["id","value","onInput"])])]))),128)),(0,l.Lk)("div",ve,[(0,l.Lk)("div",ke,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Xe},{default:(0,l.k6)(()=>[(0,l.eW)(" 작성 취소 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Be},{default:(0,l.k6)(()=>[(0,l.eW)(" + 계획 추가 ")]),_:1})]),(0,l.Lk)("div",fe,[(0,l.bF)(r.A,{color:"dark",size:"sm",class:"ml-auto shrink-0",onClick:$e},{default:(0,l.k6)(()=>[(0,l.eW)(" 제출하기 ")]),_:1})])])])]))}},ge=t(6262);const Ce=(0,ge.A)(be,[["__scopeId","data-v-19e53104"]]);var he=Ce}}]);
//# sourceMappingURL=605.c71e2858.js.map