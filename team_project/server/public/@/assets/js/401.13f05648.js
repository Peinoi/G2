"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[401],{6571:function(e,a,s){s.d(a,{A:function(){return d}});var l=s(641),t=s(2644);const u=["id","rows","name","value","placeholder","isRequired","disabled"];function n(e,a,s,n,i,r){return(0,l.uX)(),(0,l.CE)("div",{class:(0,t.C4)(["input-group",`input-group-${s.variant} ${r.getStatus(s.error,s.success)}`])},[(0,l.Lk)("textarea",{id:s.id,class:"form-control",rows:s.rows,name:s.name,value:s.value,placeholder:s.placeholder,isRequired:s.isRequired,disabled:s.disabled},null,8,u)],2)}var i=s(5685),r={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,i.A)()},methods:{getStatus:(e,a)=>{let s;return s=a?"is-valid":e?"is-invalid":null,s}}},c=s(6262);const o=(0,c.A)(r,[["render",n]]);var d=o},9401:function(e,a,s){s.r(a),s.d(a,{default:function(){return qe}});s(8743),s(3725),s(1339);var l=s(641),t=s(2644),u=s(9841),n=s(5220),i=s(4335),r=s(6698),c=s(6571),o=s(2798);const d=e=>((0,l.Qi)("data-v-a07bacd2"),e=e(),(0,l.jt)(),e),v={class:"p-6 max-w-5xl mx-auto"},k={class:"form-action"},m={class:"flex items-center gap-2"},p={class:"detail-card"},f={class:"flex justify-between items-start detail-header"},b=d(()=>(0,l.Lk)("div",null,[(0,l.Lk)("h2",{class:"text-2xl font-semibold mb-1"},"상담 상세")],-1)),L={key:0,class:"text-sm text-gray-500 py-6"},C={key:1,class:"text-sm text-red-600 py-6"},y={class:"meta-card"},g={class:"meta-grid"},_={class:"meta-item"},h=d(()=>(0,l.Lk)("span",{class:"meta-label"},"지원자",-1)),B={class:"meta-value"},w={class:"meta-item"},x=d(()=>(0,l.Lk)("span",{class:"meta-label"},"보호자",-1)),E={class:"meta-value"},W={class:"meta-item"},X=d(()=>(0,l.Lk)("span",{class:"meta-label"},"담당자",-1)),A={class:"meta-value"},K={class:"meta-item"},R=d(()=>(0,l.Lk)("span",{class:"meta-label"},"장애유형",-1)),F={class:"meta-value"},j={class:"meta-item"},S=d(()=>(0,l.Lk)("span",{class:"meta-label"},"우선순위",-1)),q={class:"meta-value"},z={class:"meta-item"},D=d(()=>(0,l.Lk)("span",{class:"meta-label"},"조사지 제출일",-1)),I={class:"meta-value"},N={key:0,class:"info-card muted-info"},$=d(()=>(0,l.Lk)("strong",null,"임시 저장",-1)),Q=d(()=>(0,l.Lk)("br",null,null,-1)),U=d(()=>(0,l.Lk)("strong",null,"작성 전",-1)),T=d(()=>(0,l.Lk)("br",null,null,-1)),M={class:"block-card"},Y=d(()=>(0,l.Lk)("h3",{class:"block-title"},"첫 상담",-1)),G={class:"text-sm text-gray-600 mb-2"},H={class:"font-medium"},J={class:"field-block"},O=d(()=>(0,l.Lk)("div",{class:"field-label"},"상담 제목",-1)),P={class:"field-value"},V={class:"field-block"},Z=d(()=>(0,l.Lk)("div",{class:"field-label"},"상담 내용",-1)),ee={class:"field-value whitespace-pre-line"},ae={class:"field-block mt-3"},se=d(()=>(0,l.Lk)("div",{class:"field-label"},"첨부 파일",-1)),le={key:0},te={class:"list-disc pl-4 text-sm"},ue=["href"],ne={key:1,class:"text-xs text-gray-400"},ie={class:"space-y-4 mt-4"},re=d(()=>(0,l.Lk)("h3",{class:"font-semibold text-lg"},"추가 상담 기록",-1)),ce={class:"flex justify-between items-center text-sm mb-2 border-b border-gray-200 pb-2"},oe={class:"font-medium"},de={class:"text-gray-500"},ve={class:"font-medium"},ke={class:"field-block"},me=d(()=>(0,l.Lk)("div",{class:"field-label"},"상담 제목",-1)),pe={class:"field-value"},fe={class:"field-block"},be=d(()=>(0,l.Lk)("div",{class:"field-label"},"상담 내용",-1)),Le={class:"field-value whitespace-pre-line"},Ce={key:1,class:"text-sm text-gray-500"},ye={key:0,class:"rejection-card"},ge=d(()=>(0,l.Lk)("div",{class:"font-semibold mb-1 text-sm"},"반려 이력",-1)),_e={class:"mb-1"},he={class:"font-medium"},Be=d(()=>(0,l.Lk)("div",{class:"font-medium"},"사유:",-1)),we={class:"whitespace-pre-line mt-1"},xe={class:"right-wrap mt-2"},Ee={key:1,class:"pt-4 border-t mt-2 space-y-3"},We={class:"approve-actions"},Xe={key:2,class:"modal-overlay"},Ae={class:"modal-container"},Ke=d(()=>(0,l.Lk)("h3",{class:"text-lg font-semibold mb-3"},"반려 사유 입력",-1)),Re={class:"modal-actions"};var Fe={__name:"CounselDetail",setup(e){const a=(0,n.lq)(),s=(0,n.rd)(),d=(0,o.n)();d.reload();const Fe=(0,l.EW)(()=>Number(a.params.submitCode||a.query.submitCode||0)),je=(0,u.KR)(!1),Se=(0,u.KR)(""),qe=(0,u.KR)([]),ze=(0,l.EW)(()=>Number(a.query.role||0)),De=(0,u.KR)({name:"",ssnFront:"",submitAt:""}),Ie=(0,l.EW)(()=>{const e=De.value.submitAt;return e?e.slice(0,10):"-"}),Ne=(0,u.KR)({counselDate:"",title:"",content:""}),$e=(0,u.KR)([]),Qe=(0,u.KR)("BB3"),Ue=(0,u.KR)(""),Te=(0,u.KR)({reason:"",date:""}),Me=(0,l.EW)(()=>{const e=Te.value.date;return e?String(e).slice(0,10):"-"}),Ye=(0,l.EW)(()=>{const e=(Qe.value||"").toString().toUpperCase();switch(e){case"BB1":return"긴급";case"BB2":return"중점";case"BB3":return"계획";default:return Qe.value||"-"}});async function Ge(){je.value=!0,Se.value="";try{const e=Fe.value,{data:a}=await i.A.get(`/api/counsel/${e}`);if(!a?.success||!a.result)throw new Error(a?.message||"상담 정보를 찾을 수 없습니다.");const s=a.result;De.value=s.submit_info||De.value,Ne.value={counselDate:s.main?.counsel_date||"",title:s.main?.title||"",content:s.main?.content||""},Qe.value=s.priority||"BB3",Ue.value=s.status||"",$e.value=(s.details||[]).map((e,a)=>({id:e.detail_code||Date.now()+a,counselDate:e.counsel_date||"",title:e.title||"",content:e.content||""}))||[],qe.value=s.attachments||[],await He()}catch(e){console.error(e),Se.value=e.message||"상담 정보 조회 중 오류"}finally{je.value=!1}}async function He(){try{const e=Fe.value;if(!Number.isInteger(e)||e<=0)return console.warn("[loadRejectionInfo] invalid submitCode:",{params:a.params.submitCode,query:a.query.submitCode}),void(Te.value={reason:"",date:""});const{data:s}=await i.A.get(`/api/counsel/${e}/rejection-reason`);if(s?.success&&s.result){const e=s.result;Te.value={reason:e.rejection_reason||"",date:e.rejection_date||e.approval_date||""}}else Te.value={reason:"",date:""}}catch(e){console.error("[loadRejectionInfo]",e),Te.value={reason:"",date:""}}}function Je(e){const a=(e||"").toString().toUpperCase();switch(a){case"CB1":return"상담전";case"CB2":return"상담전";case"CB3":return"검토전";case"CB4":return"반려";case"CB5":return"검토완료";case"CB6":return"재승인요청";default:return e||"-"}}function Oe(e){const a=(e||"").toString().toUpperCase();switch(a){case"CB1":case"CB2":return"p-gray";case"CB3":return"p-yellow";case"CB4":return"p-red";case"CB5":return"p-green";case"CB6":return"p-orange";default:return"p-gray"}}function Pe(){const e=Fe.value;e&&window.open(`/survey/submission/${e}`,"_blank")}function Ve(){s.push({name:"counselList"})}function Ze(){s.push({name:"counsel-edit",params:{submitCode:Fe.value}})}function ea(){s.push({name:"counsel-new",params:{submitCode:Fe.value}})}const aa=(0,u.KR)(!1),sa=(0,u.KR)("");async function la(){try{const e=Fe.value,a=d.userCode;if(!a)return void alert("로그인 정보가 없어 승인자를 기록할 수 없습니다. 다시 로그인해주세요.");const{data:s}=await i.A.post(`/api/counsel/${e}/approve`,{processorCode:a});s?.success?(alert("승인되었습니다."),await Ge()):alert(s.message||"승인 처리 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}}function ta(){sa.value="",aa.value=!0}async function ua(){if(sa.value.trim())try{const e=Fe.value,{data:a}=await i.A.post(`/api/counsel/${e}/reject`,{reason:sa.value});a?.success?(alert("반려되었습니다."),aa.value=!1,await Ge()):alert(a.message||"반려 처리 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}else alert("반려 사유를 입력해주세요.")}function na(){aa.value=!1}return Ge(),(e,a)=>((0,l.uX)(),(0,l.CE)("section",v,[(0,l.Lk)("div",k,[(0,l.bF)(r.A,{color:"dark",size:"sm",variant:"outlined",onClick:Ve},{default:(0,l.k6)(()=>[(0,l.eW)(" ← 목록으로 ")]),_:1}),(0,l.Lk)("div",m,[2!==ze.value||"CB1"!==Ue.value&&"CB2"!==Ue.value?2===ze.value&&"CB3"===Ue.value?((0,l.uX)(),(0,l.Wv)(r.A,{key:1,color:"dark",size:"sm",onClick:Ze},{default:(0,l.k6)(()=>[(0,l.eW)(" 수정하기 ")]),_:1})):(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(r.A,{key:0,color:"dark",size:"sm",onClick:ea},{default:(0,l.k6)(()=>[(0,l.eW)(" 작성하기 ")]),_:1}))])]),(0,l.Lk)("div",p,[(0,l.Lk)("header",f,[b,(0,l.Lk)("span",{class:(0,t.C4)(["status-pill",Oe(Ue.value)])},(0,t.v_)(Je(Ue.value)),3)]),je.value?((0,l.uX)(),(0,l.CE)("div",L," 불러오는 중... ")):Se.value?((0,l.uX)(),(0,l.CE)("div",C,(0,t.v_)(Se.value),1)):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[(0,l.Lk)("div",y,[(0,l.Lk)("div",g,[(0,l.Lk)("div",_,[h,(0,l.Lk)("span",B,(0,t.v_)(De.value.childName||"본인"),1)]),(0,l.Lk)("div",w,[x,(0,l.Lk)("span",E,(0,t.v_)(De.value.guardianName||"-"),1)]),(0,l.Lk)("div",W,[X,(0,l.Lk)("span",A,(0,t.v_)(De.value.assigneeName||"-"),1)]),(0,l.Lk)("div",K,[R,(0,l.Lk)("span",F,(0,t.v_)(De.value.disabilityType||"-"),1)]),(0,l.Lk)("div",j,[S,(0,l.Lk)("span",q,(0,t.v_)(Ye.value),1)]),(0,l.Lk)("div",z,[D,(0,l.Lk)("span",I,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Pe},{default:(0,l.k6)(()=>[(0,l.eW)((0,t.v_)(Ie.value),1)]),_:1})])])])]),"CB1"===Ue.value||"CB2"===Ue.value?((0,l.uX)(),(0,l.CE)("div",N,["CB1"===Ue.value?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.eW)(" 이 상담은 "),$,(0,l.eW)(" 상태입니다."),Q],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)(" 이 상담은 아직 "),U,(0,l.eW)(" 상태입니다."),T],64))])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("div",M,[Y,(0,l.Lk)("div",G,[(0,l.eW)(" 상담일: "),(0,l.Lk)("span",H,(0,t.v_)(Ne.value.counselDate||"-"),1)]),(0,l.Lk)("div",J,[O,(0,l.Lk)("div",P,(0,t.v_)(Ne.value.title||"-"),1)]),(0,l.Lk)("div",V,[Z,(0,l.Lk)("div",ee,(0,t.v_)(Ne.value.content||"-"),1)]),(0,l.Lk)("div",ae,[se,qe.value.length?((0,l.uX)(),(0,l.CE)("div",le,[(0,l.Lk)("ul",te,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(qe.value,e=>((0,l.uX)(),(0,l.CE)("li",{key:e.attachCode,class:"text-blue-600"},[(0,l.Lk)("a",{href:e.url,target:"_blank",class:"hover:underline break-all"},(0,t.v_)(e.originalFilename),9,ue)]))),128))])])):((0,l.uX)(),(0,l.CE)("div",ne," 첨부된 파일이 없습니다. "))])]),(0,l.Lk)("div",ie,[re,$e.value.length?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)($e.value,(e,a)=>((0,l.uX)(),(0,l.CE)("div",{key:e.id||a,class:"block-card"},[(0,l.Lk)("div",ce,[(0,l.Lk)("div",oe,"기록 #"+(0,t.v_)(a+1),1),(0,l.Lk)("div",de,[(0,l.eW)(" 상담일: "),(0,l.Lk)("span",ve,(0,t.v_)(e.counselDate||"-"),1)])]),(0,l.Lk)("div",ke,[me,(0,l.Lk)("div",pe,(0,t.v_)(e.title||"-"),1)]),(0,l.Lk)("div",fe,[be,(0,l.Lk)("div",Le,(0,t.v_)(e.content||"-"),1)])]))),128)):((0,l.uX)(),(0,l.CE)("p",Ce," 추가 상담 기록이 없습니다. "))])],64))],64))]),!Te.value.reason||"CB4"!==Ue.value&&"CB6"!==Ue.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",ye,[ge,(0,l.Lk)("div",_e,[(0,l.eW)(" 반려일자: "),(0,l.Lk)("span",he,(0,t.v_)(Me.value),1)]),(0,l.Lk)("div",null,[Be,(0,l.Lk)("p",we,(0,t.v_)(Te.value.reason),1)])])),(0,l.Lk)("div",xe,[2===ze.value&&"CB4"===Ue.value?((0,l.uX)(),(0,l.Wv)(r.A,{key:0,color:"dark",size:"sm",onClick:Ze},{default:(0,l.k6)(()=>[(0,l.eW)(" 재수정하기 ")]),_:1})):(0,l.Q3)("",!0)]),3!==ze.value||"CB3"!==Ue.value&&"CB6"!==Ue.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Ee,[(0,l.Lk)("div",We,[(0,l.bF)(r.A,{color:"dark",size:"sm",class:"px-4",onClick:la},{default:(0,l.k6)(()=>[(0,l.eW)(" 승인 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",class:"px-4",onClick:ta},{default:(0,l.k6)(()=>[(0,l.eW)(" 반려 ")]),_:1})])])),aa.value?((0,l.uX)(),(0,l.CE)("div",Xe,[(0,l.Lk)("div",Ae,[Ke,(0,l.bF)(c.A,{id:"reject-reason",variant:"outline",rows:4,placeholder:"반려 사유를 입력하세요...",value:sa.value,onInput:a[0]||(a[0]=e=>sa.value=e.target.value)},null,8,["value"]),(0,l.Lk)("div",Re,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:na},{default:(0,l.k6)(()=>[(0,l.eW)(" 취소 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:ua},{default:(0,l.k6)(()=>[(0,l.eW)(" 반려 ")]),_:1})])])])):(0,l.Q3)("",!0)]))}},je=s(6262);const Se=(0,je.A)(Fe,[["__scopeId","data-v-a07bacd2"]]);var qe=Se}}]);
//# sourceMappingURL=401.13f05648.js.map