"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[50],{7050:function(a,l,e){e.r(l),e.d(l,{default:function(){return fa}});e(3725),e(2598),e(1339);var t=e(641),u=e(2644),s=e(9322),n=e(9841),r=e(4335),o=e(2798);const v=a=>((0,t.Qi)("data-v-1e41c5f1"),a=a(),(0,t.jt)(),a),c={class:"at-page"},d=v(()=>(0,t.Lk)("h2",{class:"at-title"},"담당자 권한(이용자) 이전",-1)),i={key:0,class:"at-no-auth"},k=v(()=>(0,t.Lk)("p",null,"접근 권한이 없습니다. (기관 관리자 전용 페이지)",-1)),L=[k],p={key:1},h={class:"at-toolbar"},y={class:"at-row"},g={class:"at-field-group"},m=v(()=>(0,t.Lk)("label",{class:"at-label"},"현재 담당자(From)",-1)),_=v(()=>(0,t.Lk)("option",{value:""},"담당자 선택",-1)),b=["value"],C={class:"at-field-group"},f=v(()=>(0,t.Lk)("label",{class:"at-label"},"이전받을 담당자(To)",-1)),E=v(()=>(0,t.Lk)("option",{value:""},"담당자 선택",-1)),K=["value"],X={class:"at-field-group at-field-grow"},I=v(()=>(0,t.Lk)("label",{class:"at-label"},"이용자 검색(이름/ID 등)",-1)),w={class:"at-inline"},R=["onKeyup"],W={class:"at-row at-row-hint"},A=v(()=>(0,t.Lk)("strong",null,"이전할 이용자",-1)),Q=v(()=>(0,t.Lk)("strong",null,"권한 이전",-1)),T={class:"at-panels"},U={class:"at-panel"},F={class:"at-panel-header"},V={class:"at-panel-title"},D={key:0,class:"at-tag"},S={class:"at-panel-sub"},x={class:"at-table-wrap"},j={class:"at-table"},z=["checked"],M=v(()=>(0,t.Lk)("th",null,"No",-1)),N=v(()=>(0,t.Lk)("th",null,"이용자명",-1)),H=v(()=>(0,t.Lk)("th",null,"식별자(ID 등)",-1)),J={key:0},q=v(()=>(0,t.Lk)("td",{colspan:"4",class:"at-empty"},"로딩 중...",-1)),B=[q],G={key:1},O=v(()=>(0,t.Lk)("td",{colspan:"4",class:"at-empty"}," 조회된 이용자가 없습니다. ",-1)),P=[O],Y=["value"],Z={class:"at-panel"},$={class:"at-panel-header"},aa={class:"at-panel-title"},la={key:0,class:"at-tag at-tag-secondary"},ea={class:"at-panel-sub"},ta={class:"at-table-wrap"},ua={class:"at-table"},sa=v(()=>(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"No"),(0,t.Lk)("th",null,"이용자명"),(0,t.Lk)("th",null,"식별자(ID 등)")])],-1)),na={key:0},ra=v(()=>(0,t.Lk)("td",{colspan:"3",class:"at-empty"},"로딩 중...",-1)),oa=[ra],va={key:1},ca=v(()=>(0,t.Lk)("td",{colspan:"3",class:"at-empty"}," 조회된 이용자가 없습니다. ",-1)),da=[ca],ia={class:"at-actions"},ka=["disabled"],La={key:0,class:"at-modal-backdrop"},pa={class:"at-modal"},ha=v(()=>(0,t.Lk)("h3",{class:"at-modal-title"},"권한 이전 확인",-1)),ya={class:"at-modal-text"},ga=v(()=>(0,t.Lk)("br",null,null,-1)),ma=v(()=>(0,t.Lk)("br",null,null,-1));var _a={__name:"AuthorityTransfer",setup(a){const l=(0,o.n)(),e=(0,n.KR)(1),v=(0,n.KR)(0),k=(0,n.KR)(1),q=(0,n.KR)(0),O=(0,t.EW)(()=>"AA3"===l.role),ra=(0,n.KR)([]),ca=(0,n.KR)(""),_a=(0,n.KR)(""),ba=(0,n.KR)(""),Ca=(0,n.KR)([]),fa=(0,n.KR)([]),Ea=(0,n.KR)([]),Ka=(0,n.KR)(!1),Xa=(0,n.KR)(!1),Ia=(0,n.KR)(!1),wa=(0,n.KR)(!1),Ra=(0,t.EW)(()=>{const a=ra.value.find(a=>String(a.user_code)===String(ca.value));return a?a.name:""}),Wa=(0,t.EW)(()=>{const a=ra.value.find(a=>String(a.user_code)===String(_a.value));return a?a.name:""}),Aa=(0,t.EW)(()=>Ca.value.length>0&&Ea.value.length===Ca.value.length),Qa=(0,t.EW)(()=>ca.value&&_a.value&&ca.value!==_a.value&&Ea.value.length>0),Ta=a=>a.user_name||a.child_name||a.name||"-",Ua=a=>a.user_id||a.child_code||a.identifier||"",Fa=async()=>{if(O.value)try{const a=await r.A.get("/api/managers/simple",{params:{loginId:l.userId}}),e=a.data?.data??[];ra.value=e.map(a=>({user_code:a.user_code??a.manager_code,name:a.name??a.manager_name}))}catch(a){console.error("[AuthorityTransfer] 담당자 목록 조회 실패:",a)}},Va=async()=>{if(!ca.value)return Ca.value=[],void(Ea.value=[]);Ka.value=!0;try{const a=await r.A.get("/api/authority-transfer/users",{params:{loginId:l.userId,managerCode:ca.value,keyword:ba.value||"",page:e.value,size:20}}),t=a.data?.data??{};Ca.value=t.list??t,v.value=t.totalCount??Ca.value.length}catch(a){console.error("[AuthorityTransfer] sourceUsers 조회 실패:",a)}finally{Ka.value=!1}},Da=async()=>{if(_a.value){Xa.value=!0;try{const a=await r.A.get("/api/authority-transfer/users",{params:{loginId:l.userId,managerCode:_a.value,page:k.value,size:20}}),e=a.data?.data??{};fa.value=e.list??e,q.value=e.totalCount??fa.value.length}catch(a){console.error("[AuthorityTransfer] targetUsers 조회 실패:",a)}finally{Xa.value=!1}}else fa.value=[]},Sa=()=>{Aa.value?Ea.value=[]:Ea.value=Ca.value.map(a=>a.user_code)},xa=()=>{ba.value="",Va()},ja=()=>{Da()},za=()=>{Qa.value&&(wa.value=!0)},Ma=()=>{wa.value=!1},Na=async()=>{if(Qa.value){Ia.value=!0;try{await r.A.post("/api/authority-transfer/transfer",{loginId:l.userId,fromManagerCode:ca.value,toManagerCode:_a.value,userCodes:Ea.value}),alert("권한(담당자) 이전이 완료되었습니다."),await Va(),await Da(),Ea.value=[]}catch(a){console.error("[AuthorityTransfer] 권한 이전 실패:",a),alert("권한 이전 처리 중 오류가 발생했습니다.")}finally{Ia.value=!1}}},Ha=async()=>{wa.value=!1,await Na()};return(0,t.sV)(async()=>{O.value&&await Fa()}),(a,l)=>((0,t.uX)(),(0,t.CE)("div",c,[d,O.value?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",h,[(0,t.Lk)("div",y,[(0,t.Lk)("div",g,[m,(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":l[0]||(l[0]=a=>ca.value=a),class:"at-select",onChange:xa},[_,((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ra.value,a=>((0,t.uX)(),(0,t.CE)("option",{key:a.user_code,value:a.user_code},(0,u.v_)(a.name),9,b))),128))],544),[[s.u1,ca.value]])]),(0,t.Lk)("div",C,[f,(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>_a.value=a),class:"at-select",onChange:ja},[E,((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ra.value,a=>((0,t.uX)(),(0,t.CE)("option",{key:a.user_code,value:a.user_code},(0,u.v_)(a.name),9,K))),128))],544),[[s.u1,_a.value]])]),(0,t.Lk)("div",X,[I,(0,t.Lk)("div",w,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>ba.value=a),class:"at-input",placeholder:"이용자 이름 또는 ID 검색",onKeyup:(0,s.jR)(Va,["enter"])},null,40,R),[[s.Jo,ba.value,void 0,{trim:!0}]]),(0,t.Lk)("button",{class:"at-btn",onClick:Va},"검색")])])]),(0,t.Lk)("div",W,[(0,t.Lk)("p",null,[(0,t.eW)(" • 왼쪽에서 "),A,(0,t.eW)("를 선택하고, 아래의 "),Q,(0,t.eW)(" 버튼을 누르면 선택한 이용자의 담당자가 "),(0,t.Lk)("strong",null,(0,u.v_)(Wa.value||"선택된 담당자"),1),(0,t.eW)("(으)로 변경됩니다. ")])])]),(0,t.Lk)("div",T,[(0,t.Lk)("div",U,[(0,t.Lk)("div",F,[(0,t.Lk)("h3",V,[(0,t.eW)(" 현재 담당자 이용자 목록 "),Ra.value?((0,t.uX)(),(0,t.CE)("span",D,(0,u.v_)(Ra.value),1)):(0,t.Q3)("",!0)]),(0,t.Lk)("small",S," 전체 "+(0,u.v_)(Ca.value.length)+"명 ",1)]),(0,t.Lk)("div",x,[(0,t.Lk)("table",j,[(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,[(0,t.Lk)("input",{type:"checkbox",checked:Aa.value,onChange:Sa},null,40,z)]),M,N,H])]),(0,t.Lk)("tbody",null,[Ka.value?((0,t.uX)(),(0,t.CE)("tr",J,B)):0===Ca.value.length?((0,t.uX)(),(0,t.CE)("tr",G,P)):(0,t.Q3)("",!0),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Ca.value,(a,e)=>((0,t.uX)(),(0,t.CE)("tr",{key:a.user_code},[(0,t.Lk)("td",null,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=a=>Ea.value=a),value:a.user_code},null,8,Y),[[s.lH,Ea.value]])]),(0,t.Lk)("td",null,(0,u.v_)(e+1),1),(0,t.Lk)("td",null,(0,u.v_)(Ta(a)),1),(0,t.Lk)("td",null,(0,u.v_)(Ua(a)),1)]))),128))])])])]),(0,t.Lk)("div",Z,[(0,t.Lk)("div",$,[(0,t.Lk)("h3",aa,[(0,t.eW)(" 이전받을 담당자 이용자 목록 "),Wa.value?((0,t.uX)(),(0,t.CE)("span",la,(0,u.v_)(Wa.value),1)):(0,t.Q3)("",!0)]),(0,t.Lk)("small",ea," 전체 "+(0,u.v_)(fa.value.length)+"명 ",1)]),(0,t.Lk)("div",ta,[(0,t.Lk)("table",ua,[sa,(0,t.Lk)("tbody",null,[Xa.value?((0,t.uX)(),(0,t.CE)("tr",na,oa)):0===fa.value.length?((0,t.uX)(),(0,t.CE)("tr",va,da)):(0,t.Q3)("",!0),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(fa.value,(a,l)=>((0,t.uX)(),(0,t.CE)("tr",{key:a.user_code},[(0,t.Lk)("td",null,(0,u.v_)(l+1),1),(0,t.Lk)("td",null,(0,u.v_)(Ta(a)),1),(0,t.Lk)("td",null,(0,u.v_)(Ua(a)),1)]))),128))])])])])]),(0,t.Lk)("div",ia,[(0,t.Lk)("button",{class:"at-btn at-btn-primary",disabled:!Qa.value||Ia.value,onClick:za},(0,u.v_)(Ia.value?"이전 처리 중...":"선택한 이용자 권한 이전"),9,ka)])])):((0,t.uX)(),(0,t.CE)("div",i,L)),((0,t.uX)(),(0,t.Wv)(t.Im,{to:"body"},[wa.value?((0,t.uX)(),(0,t.CE)("div",La,[(0,t.Lk)("div",pa,[ha,(0,t.Lk)("p",ya,[(0,t.eW)(" 선택한 "+(0,u.v_)(Ea.value.length)+"명의 이용자를",1),ga,(0,t.Lk)("strong",null,(0,u.v_)(Ra.value),1),(0,t.eW)(" → "),(0,t.Lk)("strong",null,(0,u.v_)(Wa.value),1),ma,(0,t.eW)(" 로 이전하시겠습니까? ")]),(0,t.Lk)("div",{class:"at-modal-actions"},[(0,t.Lk)("button",{class:"at-btn",onClick:Ma},"취소"),(0,t.Lk)("button",{class:"at-btn at-btn-primary",onClick:Ha}," 예, 이전하기 ")])])])):(0,t.Q3)("",!0)]))]))}},ba=e(6262);const Ca=(0,ba.A)(_a,[["__scopeId","data-v-1e41c5f1"]]);var fa=Ca}}]);
//# sourceMappingURL=50.0504ecdf.js.map