"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[400],{2400:function(e,t,a){a.r(t),a.d(t,{default:function(){return F}});a(8743),a(3725),a(5019),a(9838),a(1339);var l=a(641),u=a(2644),n=a(9322),r=a(9841),s=a(4335),o=a(5220),c=a(5386);const v=e=>((0,l.Qi)("data-v-74c4ab1e"),e=e(),(0,l.jt)(),e),d={class:"result-form"},i=["onSubmit"],_={class:"card"},p=v(()=>(0,l.Lk)("h3",null,"기본 정보",-1)),k={class:"grid-2"},b=v(()=>(0,l.Lk)("label",null,"연결 이벤트 선택",-1)),y=v(()=>(0,l.Lk)("option",{value:""},"이벤트 선택",-1)),L=["value"],m=v(()=>(0,l.Lk)("label",null,"작성일",-1)),h=v(()=>(0,l.Lk)("label",null,"결과 제목",-1)),C=v(()=>(0,l.Lk)("label",null,"매니저 코드",-1)),f=["value"],g={class:"card"},w=v(()=>(0,l.Lk)("h3",null,"내용",-1)),E={class:"card"},R=v(()=>(0,l.Lk)("h3",null,"첨부파일",-1)),A=["href"],K=["onClick"],X=["onClick"],j={class:"submit-wrapper"},D={type:"submit",class:"btn-submit"},I={key:0,class:"modal"},q={class:"modal-content"},J=v(()=>(0,l.Lk)("h4",null,"반려 사유 입력",-1)),Q={class:"modal-actions"},$={key:1,class:"card"},x=v(()=>(0,l.Lk)("h4",null,"최근 반려 이력",-1)),N=v(()=>(0,l.Lk)("strong",null,"일자:",-1)),S=v(()=>(0,l.Lk)("strong",null,"사유:",-1));var U={__name:"EventResultAdd",setup(e){const t=(0,o.lq)(),a=(0,o.rd)(),v=JSON.parse(localStorage.getItem("user")||"{}"),U=v.user_code,V=v.name||"",W="ADMIN"===v.position||"admin"===v.role,F=new Date;F.setHours(0,0,0,0);const M=(0,r.KR)(!1),O=(0,r.KR)(!1),T=(0,r.KR)(""),B=(0,r.KR)(null),H=(0,r.KR)([]),z=(0,r.KR)([]),G=(0,r.KR)([]),P=(0,r.KR)([]),Y=(0,r.KR)({event_result_code:"",event_code:"",result_status:"BA1",result_subject:"",result_content:"",report_register_date:new Date,user_code:U}),Z=(0,l.EW)(()=>H.value.filter(e=>null===e.event_result_code)),ee=(0,l.EW)(()=>(0,c.A)(Y.value.report_register_date,"yyyy-MM-dd")),te=e=>{const t=Array.from(e.target.files);G.value.push(...t)},ae=e=>G.value.splice(e,1),le=(e,t)=>{P.value.push(e),z.value.splice(t,1)},ue=async()=>{try{const e=await s.A.get("/api/event/applyResult",{params:{user_code:U}});H.value=e.data.data||[]}catch(e){console.error("내 이벤트 목록 조회 실패",e)}},ne=async e=>{try{const t=await s.A.get(`/api/event/result/${e}`),a=t.data.data;if(!a)return;M.value=!0,Y.value={...Y.value,event_result_code:a.event_result_code,event_code:a.event_code,result_status:a.result_status,result_subject:a.result_subject,result_content:a.result_content,report_register_date:new Date(a.report_register_date),user_code:a.user_code},z.value=a.attachments||[]}catch(t){console.error(t)}};(0,l.KC)(async()=>{await ue();const e=t.query.resultNo;e?await ne(e):Y.value.report_register_date=new Date});const re=async()=>{try{const e=new FormData,t={...Y.value,report_register_date:ee.value,deletedAttachments:P.value.map(e=>e.attachment_code||e.id||e.server_filename)};e.append("resultInfo",JSON.stringify(t)),G.value.forEach(t=>e.append("attachments",t)),M.value?(await s.A.put(`/api/event/result/${Y.value.event_result_code}`,e,{headers:{"Content-Type":"multipart/form-data"}}),alert("결과보고서 수정 완료")):(await s.A.post("/api/event/result",e,{headers:{"Content-Type":"multipart/form-data"}}),alert("결과보고서 등록 완료")),a.push("/event/list")}catch(e){console.error(e),alert(M.value?"수정 실패":"등록 실패")}},se=async()=>{try{const e=Y.value.event_result_code;await s.A.post(`/api/event/${e}/approve`),alert("승인 처리되었습니다."),M.value&&await ne(e)}catch(e){console.error(e),alert("승인 중 오류")}},oe=async()=>{try{const e=Y.value.event_result_code;await s.A.post(`/api/event/${e}/reject`,{reason:T.value}),alert("반려 처리되었습니다."),O.value=!1,M.value&&await ne(e)}catch(e){console.error(e),alert("반려 중 오류")}},ce=async()=>{try{const e=Y.value.event_result_code||t.query.resultNo,a=await s.A.get(`/api/event/${e}/rejection-reason`);B.value=a.data.result}catch(e){console.error(e),alert("반려사유 없음 또는 조회 오류")}};return(e,t)=>((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("h2",null,"결과보고서 "+(0,u.v_)(M.value?"수정":"등록"),1),(0,l.Lk)("form",{onSubmit:(0,n.D$)(re,["prevent"])},[(0,l.Lk)("div",_,[p,(0,l.Lk)("div",k,[(0,l.Lk)("div",null,[b,(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>Y.value.event_code=e),required:""},[y,((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Z.value,e=>((0,l.uX)(),(0,l.CE)("option",{value:e.event_code,key:e.event_code},(0,u.v_)(e.event_name),9,L))),128))],512),[[n.u1,Y.value.event_code]])]),(0,l.Lk)("div",null,[m,(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>ee.value=e),readonly:""},null,512),[[n.Jo,ee.value]])]),(0,l.Lk)("div",null,[h,(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>Y.value.result_subject=e),required:""},null,512),[[n.Jo,Y.value.result_subject]])]),(0,l.Lk)("div",null,[C,(0,l.Lk)("input",{type:"text",value:(0,r.R1)(V)||(0,r.R1)(U),readonly:""},null,8,f)])])]),(0,l.Lk)("div",g,[w,(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>Y.value.result_content=e),rows:"6",required:""},null,512),[[n.Jo,Y.value.result_content]])]),(0,l.Lk)("div",E,[R,(0,l.Lk)("input",{type:"file",multiple:"",onChange:te,class:"file-input"},null,32),(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(z.value,(e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:"ex-"+t},[(0,l.Lk)("a",{href:e.file_path,target:"_blank"},(0,u.v_)(e.original_filename),9,A),(0,l.Lk)("button",{type:"button",class:"btn-danger",onClick:a=>le(e,t)}," 삭제 ",8,K)]))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(G.value,(e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:"new-"+t},[(0,l.eW)((0,u.v_)(e.name)+" ",1),(0,l.Lk)("button",{type:"button",class:"btn-danger",onClick:e=>ae(t)}," 삭제 ",8,X)]))),128))])]),(0,l.Lk)("div",j,[(0,l.Lk)("button",D,(0,u.v_)(M.value?"수정":"등록"),1),(0,r.R1)(W)&&M.value?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"btn-primary",onClick:se}," 승인 ")):(0,l.Q3)("",!0),(0,r.R1)(W)&&M.value?((0,l.uX)(),(0,l.CE)("button",{key:1,type:"button",class:"btn-danger",onClick:t[4]||(t[4]=e=>O.value=!0)}," 반려 ")):(0,l.Q3)("",!0),M.value?((0,l.uX)(),(0,l.CE)("button",{key:2,type:"button",class:"btn",onClick:ce}," 반려사유 조회 ")):(0,l.Q3)("",!0)])],40,i),O.value?((0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("div",q,[J,(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>T.value=e),rows:"4",placeholder:"반려 사유를 입력하세요"},null,512),[[n.Jo,T.value]]),(0,l.Lk)("div",Q,[(0,l.Lk)("button",{onClick:oe,class:"btn-danger"},"반려 처리"),(0,l.Lk)("button",{onClick:t[6]||(t[6]=e=>O.value=!1),class:"btn"},"취소")])])])):(0,l.Q3)("",!0),B.value?((0,l.uX)(),(0,l.CE)("div",$,[x,(0,l.Lk)("p",null,[N,(0,l.eW)(" "+(0,u.v_)(B.value.rejection_date),1)]),(0,l.Lk)("p",null,[S,(0,l.eW)(" "+(0,u.v_)(B.value.rejection_reason),1)])])):(0,l.Q3)("",!0)]))}},V=a(6262);const W=(0,V.A)(U,[["__scopeId","data-v-74c4ab1e"]]);var F=W}}]);
//# sourceMappingURL=400.97b00205.js.map