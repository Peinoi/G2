"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[966],{1966:function(e,a,l){l.r(a),l.d(a,{default:function(){return Ue}});l(8743),l(3725),l(1339);var s=l(641),t=l(2644),n=l(9841),i=l(5220),r=l(4335),u=l(6698),c=l(6571),o=l(2798);const d=e=>((0,s.Qi)("data-v-7f262014"),e=e(),(0,s.jt)(),e),v={class:"p-6 max-w-5xl mx-auto"},p={class:"form-action"},m={class:"flex items-center gap-2"},k={class:"detail-card"},C={class:"flex justify-between items-start detail-header"},f=d(()=>(0,s.Lk)("div",null,[(0,s.Lk)("h2",{class:"text-2xl font-semibold"},"지원계획 상세")],-1)),b={key:0,class:"text-sm text-gray-500 py-6"},L={key:1,class:"text-sm text-red-500 py-6"},y={class:"meta-card"},g={class:"meta-grid"},h={class:"meta-item"},_=d(()=>(0,s.Lk)("span",{class:"meta-label"},"지원자",-1)),w={class:"meta-value"},x={class:"meta-item"},E=d(()=>(0,s.Lk)("span",{class:"meta-label"},"보호자",-1)),W={class:"meta-value"},X={class:"meta-item"},A=d(()=>(0,s.Lk)("span",{class:"meta-label"},"담당자",-1)),S={class:"meta-value"},F={class:"meta-item"},K=d(()=>(0,s.Lk)("span",{class:"meta-label"},"장애유형",-1)),N={class:"meta-value"},R={class:"meta-item"},j=d(()=>(0,s.Lk)("span",{class:"meta-label"},"우선순위",-1)),q={class:"meta-value"},B={class:"meta-item"},z=d(()=>(0,s.Lk)("span",{class:"meta-label"},"상담지 제출일",-1)),Q={class:"meta-value"},$={class:"meta-item"},D=d(()=>(0,s.Lk)("span",{class:"meta-label"},"진행기간",-1)),I={class:"meta-value"},T=d(()=>(0,s.Lk)("span",{class:"mx-1"},"~",-1)),U={key:0,class:"info-card muted-info"},P=d(()=>(0,s.Lk)("strong",null,"임시 저장",-1)),M=d(()=>(0,s.Lk)("br",null,null,-1)),O=d(()=>(0,s.Lk)("span",{class:"font-semibold"},"[작성하기]",-1)),V=d(()=>(0,s.Lk)("strong",null,"작성 전",-1)),Y=d(()=>(0,s.Lk)("br",null,null,-1)),G=d(()=>(0,s.Lk)("span",{class:"font-semibold"},"[작성하기]",-1)),H={class:"block-card"},J=d(()=>(0,s.Lk)("h3",{class:"block-title"},"메인 계획",-1)),Z={class:"field-block"},ee=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 목표",-1)),ae={class:"field-value"},le={class:"field-block"},se=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 내용 (일반용)",-1)),te={class:"field-value whitespace-pre-line"},ne={key:0,class:"field-block"},ie=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 내용 (관리자용)",-1)),re={class:"field-value whitespace-pre-line"},ue={key:1,class:"field-block mt-3"},ce=d(()=>(0,s.Lk)("div",{class:"field-label"},"첨부 파일",-1)),oe={key:0},de={class:"mt-1 text-xs text-gray-700 space-y-1"},ve=["href"],pe={key:1,class:"text-xs text-gray-400"},me={class:"space-y-4 mt-4"},ke=d(()=>(0,s.Lk)("h3",{class:"font-semibold text-lg"},"추가 계획",-1)),Ce={class:"flex justify-between items-center text-sm mb-2 border-b border-gray-200 pb-2"},fe={class:"font-medium"},be={class:"field-block"},Le=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 목표",-1)),ye={class:"field-value"},ge={class:"field-block"},he=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 내용 (일반용)",-1)),_e={class:"field-value whitespace-pre-line"},we={key:0,class:"field-block"},xe=d(()=>(0,s.Lk)("div",{class:"field-label"},"계획 내용 (관리자용)",-1)),Ee={class:"field-value whitespace-pre-line"},We={key:1,class:"text-sm text-gray-500"},Xe={key:0,class:"rejection-card"},Ae=d(()=>(0,s.Lk)("div",{class:"font-semibold mb-1 text-sm"},"반려 이력",-1)),Se={class:"mb-1"},Fe={class:"font-medium"},Ke=d(()=>(0,s.Lk)("div",{class:"font-medium"},"사유:",-1)),Ne={class:"whitespace-pre-line mt-1"},Re={class:"right-wrap mt-2"},je={key:1,class:"pt-4 border-t mt-2 space-y-3"},qe={class:"approve-actions"},Be={key:2,class:"modal-overlay"},ze={class:"modal-container"},Qe=d(()=>(0,s.Lk)("h3",{class:"text-lg font-semibold mb-3"},"반려 사유 입력",-1)),$e={class:"modal-actions"};var De={__name:"PlanDetail",setup(e){const a=(0,i.lq)(),l=(0,i.rd)(),d=(0,o.n)();d.reload();const De=Number(a.params.planCode||0),Ie=Number(a.query.submitCode||0),Te=(0,s.EW)(()=>Number(a.query.role||0)),Ue=(0,n.KR)(""),Pe=(0,s.EW)(()=>"CC1"===Ue.value||"CC2"===Ue.value),Me=(0,n.KR)({childName:"",name:"",guardianName:"",assigneeName:"",disabilityType:"",counselSubmitAt:"",priority:""}),Oe=(0,s.EW)(()=>{const e=(Me.value.priority||"").toUpperCase();switch(e){case"BB1":return"긴급";case"BB2":return"중점";case"BB3":return"계획";default:return"-"}}),Ve=(0,s.EW)(()=>{const e=Me.value.counselSubmitAt;return e?String(e).slice(0,10):"-"}),Ye=(0,n.KR)({planDate:"",expectedStart:"",expectedEnd:"",goal:"",publicContent:"",privateContent:""}),Ge=(0,n.KR)([]),He=(0,n.KR)([]),Je=(0,n.KR)(!1),Ze=(0,n.KR)(""),ea=(0,n.KR)(!1),aa=(0,n.KR)(""),la=(0,n.KR)({reason:"",date:""}),sa=(0,s.EW)(()=>{const e=la.value?.date;return e?String(e).slice(0,10):"-"});function ta(){const e=new Date;return e.toISOString().slice(0,10)}async function na(){if(!Ie)return;const{data:e}=await r.A.get(`/api/plans/${Ie}`);if(!e?.success||!e.result)throw new Error(e?.message||"기본 정보를 찾을 수 없습니다.");const a=e.result;Me.value={childName:a.childName||"",name:a.name||"",guardianName:a.guardianName||"",assigneeName:a.assigneeName||"-",disabilityType:a.disabilityType||"-",counselSubmitAt:a.counselSubmitAt||"",priority:a.level||"-"}}async function ia(){const{data:e}=await r.A.get(`/api/plans/detail/${De}`);if(!e?.success||!e.result)throw new Error(e?.message||"지원계획 정보를 찾을 수 없습니다.");const a=e.result;Ue.value=a.status||"",Ye.value={planDate:a.main?.planDate?String(a.main.planDate).slice(0,10):ta(),expectedStart:a.main?.expectedStart||"",expectedEnd:a.main?.expectedEnd||"",goal:a.main?.goal||"",publicContent:a.main?.publicContent||"",privateContent:a.main?.privateContent||""},Ge.value=(a.items||[]).map((e,a)=>({id:e.planItemCode||Date.now()+a,goal:e.goal||"",publicContent:e.publicContent||"",privateContent:e.privateContent||""}))||[],He.value=(a.attachments||[]).map(e=>({attachCode:e.attachCode,originalFilename:e.originalFilename,url:e.url}))||[]}async function ra(){try{const{data:e}=await r.A.get(`/api/plans/${De}/rejection-reason`);if(e?.success&&e.result){const a=e.result;la.value={reason:a.rejection_reason||"",date:a.rejection_date||a.approval_date||""}}else la.value={reason:"",date:""}}catch(e){console.error("[loadRejectionInfo]",e),la.value={reason:"",date:""}}}function ua(e){const a=(e||"").toString().toUpperCase();switch(a){case"CC1":return"작성전";case"CC2":return"작성전";case"CC3":return"검토전";case"CC4":return"지원 진행중";case"CC5":return"검토완료";case"CC6":return"재승인요청";case"CC7":return"반려";default:return e||"-"}}function ca(e){const a=(e||"").toString().toUpperCase();switch(a){case"CC1":case"CC2":return"p-gray";case"CC3":return"p-yellow";case"CC4":return"p-blue";case"CC5":return"p-green";case"CC6":return"p-orange";case"CC7":return"p-red";default:return"p-gray"}}function oa(){Ie&&window.open(`/counsel/detail/${Ie}`,"_blank")}function da(){l.back()}function va(){De&&l.push({name:"plan-edit",params:{planCode:De},query:Ie?{submitCode:Ie,role:Te.value}:{role:Te.value}})}function pa(){Ie&&l.push({name:"plan-write",params:{submitcode:Ie},query:{role:Te.value}})}async function ma(){try{const e=d.userCode;if(!e)return void alert("로그인 정보가 없어 승인자를 기록할 수 없습니다. 다시 로그인해주세요.");const{data:a}=await r.A.post(`/api/plans/${De}/approve`,{processorCode:e});a?.success?(alert("지원계획이 승인되었습니다."),await ia()):alert(a.message||"승인 처리 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}}function ka(){aa.value="",ea.value=!0}async function Ca(){if(aa.value.trim())try{const{data:e}=await r.A.post(`/api/plans/${De}/reject`,{reason:aa.value});e?.success?(alert("지원계획이 반려되었습니다."),ea.value=!1,await ia()):alert(e.message||"반려 처리 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}else alert("반려 사유를 입력해주세요.")}function fa(){ea.value=!1}return(0,s.sV)(async()=>{try{if(Je.value=!0,!De)throw new Error("planCode가 없습니다. (라우터 params 확인 필요)");const e=[ia()];Ie&&e.push(na()),await Promise.all(e),1!==Te.value&&await ra()}catch(e){console.error(e),Ze.value=e.message||"지원계획 조회 중 오류가 발생했습니다."}finally{Je.value=!1}}),(e,a)=>((0,s.uX)(),(0,s.CE)("section",v,[(0,s.Lk)("div",p,[(0,s.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:da},{default:(0,s.k6)(()=>[(0,s.eW)(" ← 목록으로 ")]),_:1}),(0,s.Lk)("div",m,[2!==Te.value||"CC1"!==Ue.value&&"CC2"!==Ue.value?2===Te.value&&"CC3"===Ue.value?((0,s.uX)(),(0,s.Wv)(u.A,{key:1,color:"dark",size:"sm",onClick:va},{default:(0,s.k6)(()=>[(0,s.eW)(" 수정하기 ")]),_:1})):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(u.A,{key:0,color:"dark",size:"sm",onClick:pa},{default:(0,s.k6)(()=>[(0,s.eW)(" 작성하기 ")]),_:1}))])]),(0,s.Lk)("div",k,[(0,s.Lk)("header",C,[f,(0,s.Lk)("span",{class:(0,t.C4)(["status-pill",ca(Ue.value)])},(0,t.v_)(ua(Ue.value)),3)]),Je.value?((0,s.uX)(),(0,s.CE)("div",b," 지원계획 정보를 불러오는 중입니다... ")):Ze.value?((0,s.uX)(),(0,s.CE)("div",L,(0,t.v_)(Ze.value),1)):((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",y,[(0,s.Lk)("div",g,[(0,s.Lk)("div",h,[_,(0,s.Lk)("span",w,(0,t.v_)(Me.value.childName||"본인"),1)]),(0,s.Lk)("div",x,[E,(0,s.Lk)("span",W,(0,t.v_)(Me.value.guardianName||"-"),1)]),(0,s.Lk)("div",X,[A,(0,s.Lk)("span",S,(0,t.v_)(Me.value.assigneeName||"-"),1)]),(0,s.Lk)("div",F,[K,(0,s.Lk)("span",N,(0,t.v_)(Me.value.disabilityType||"-"),1)]),(0,s.Lk)("div",R,[j,(0,s.Lk)("span",q,(0,t.v_)(Oe.value),1)]),(0,s.Lk)("div",B,[z,(0,s.Lk)("span",Q,[(0,s.bF)(u.A,{color:"dark",size:"sm",onClick:oa},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Ve.value),1)]),_:1})])]),(0,s.Lk)("div",$,[D,(0,s.Lk)("span",I,[(0,s.Lk)("span",null,(0,t.v_)(Ye.value.expectedStart||"미지정"),1),T,(0,s.Lk)("span",null,(0,t.v_)(Ye.value.expectedEnd||"미지정"),1)])])])]),Pe.value?((0,s.uX)(),(0,s.CE)("div",U,["CC1"===Ue.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)(" 이 지원계획은 "),P,(0,s.eW)(" 상태입니다."),M,(0,s.eW)(" 목표, 내용 및 첨부파일은 "),O,(0,s.eW)(" 화면에서만 확인·수정할 수 있습니다. ")],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)(" 이 지원계획은 아직 "),V,(0,s.eW)(" 상태입니다."),Y,(0,s.eW)(" 목표, 내용 및 첨부파일은 "),G,(0,s.eW)(" 버튼을 눌러 작성해 주세요. ")],64))])):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",H,[J,(0,s.Lk)("div",Z,[ee,(0,s.Lk)("div",ae,(0,t.v_)(Ye.value.goal||"-"),1)]),(0,s.Lk)("div",le,[se,(0,s.Lk)("div",te,(0,t.v_)(Ye.value.publicContent||"-"),1)]),1!==Te.value?((0,s.uX)(),(0,s.CE)("div",ne,[ie,(0,s.Lk)("div",re,(0,t.v_)(Ye.value.privateContent||"-"),1)])):(0,s.Q3)("",!0),1!==Te.value?((0,s.uX)(),(0,s.CE)("div",ue,[ce,He.value.length?((0,s.uX)(),(0,s.CE)("div",oe,[(0,s.Lk)("ul",de,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(He.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.attachCode,class:"file-row"},[(0,s.Lk)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",class:"file-link"},(0,t.v_)(e.originalFilename),9,ve)]))),128))])])):((0,s.uX)(),(0,s.CE)("div",pe," 첨부된 파일이 없습니다. "))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",me,[ke,Ge.value.length?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(Ge.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id||a,class:"block-card"},[(0,s.Lk)("div",Ce,[(0,s.Lk)("div",fe,"계획 #"+(0,t.v_)(a+1),1)]),(0,s.Lk)("div",be,[Le,(0,s.Lk)("div",ye,(0,t.v_)(e.goal||"-"),1)]),(0,s.Lk)("div",ge,[he,(0,s.Lk)("div",_e,(0,t.v_)(e.publicContent||"-"),1)]),1!==Te.value?((0,s.uX)(),(0,s.CE)("div",we,[xe,(0,s.Lk)("div",Ee,(0,t.v_)(e.privateContent||"-"),1)])):(0,s.Q3)("",!0)]))),128)):((0,s.uX)(),(0,s.CE)("p",We,"추가 계획이 없습니다."))])],64))],64))]),!la.value.reason||"CC7"!==Ue.value&&"CC6"!==Ue.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Xe,[Ae,(0,s.Lk)("div",Se,[(0,s.eW)(" 반려일자: "),(0,s.Lk)("span",Fe,(0,t.v_)(sa.value),1)]),(0,s.Lk)("div",null,[Ke,(0,s.Lk)("p",Ne,(0,t.v_)(la.value.reason),1)])])),(0,s.Lk)("div",Re,[2===Te.value&&"CC7"===Ue.value?((0,s.uX)(),(0,s.Wv)(u.A,{key:0,color:"dark",size:"sm",onClick:va},{default:(0,s.k6)(()=>[(0,s.eW)(" 재수정하기 ")]),_:1})):(0,s.Q3)("",!0)]),3!==Te.value||"CC3"!==Ue.value&&"CC6"!==Ue.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",je,[(0,s.Lk)("div",qe,[(0,s.bF)(u.A,{color:"dark",size:"sm",class:"px-4",onClick:ma},{default:(0,s.k6)(()=>[(0,s.eW)(" 승인 ")]),_:1}),(0,s.bF)(u.A,{color:"dark",size:"sm",class:"px-4",onClick:ka},{default:(0,s.k6)(()=>[(0,s.eW)(" 반려 ")]),_:1})])])),ea.value?((0,s.uX)(),(0,s.CE)("div",Be,[(0,s.Lk)("div",ze,[Qe,(0,s.bF)(c.A,{id:"plan-reject-reason",variant:"outline",rows:4,placeholder:"반려 사유를 입력하세요...",value:aa.value,onInput:a[0]||(a[0]=e=>aa.value=e.target.value)},null,8,["value"]),(0,s.Lk)("div",$e,[(0,s.bF)(u.A,{color:"dark",size:"sm",onClick:fa},{default:(0,s.k6)(()=>[(0,s.eW)(" 취소 ")]),_:1}),(0,s.bF)(u.A,{color:"dark",size:"sm",onClick:Ca},{default:(0,s.k6)(()=>[(0,s.eW)(" 반려 ")]),_:1})])])])):(0,s.Q3)("",!0)]))}},Ie=l(6262);const Te=(0,Ie.A)(De,[["__scopeId","data-v-7f262014"]]);var Ue=Te},6571:function(e,a,l){l.d(a,{A:function(){return d}});var s=l(641),t=l(2644);const n=["id","rows","name","value","placeholder","isRequired","disabled"];function i(e,a,l,i,r,u){return(0,s.uX)(),(0,s.CE)("div",{class:(0,t.C4)(["input-group",`input-group-${l.variant} ${u.getStatus(l.error,l.success)}`])},[(0,s.Lk)("textarea",{id:l.id,class:"form-control",rows:l.rows,name:l.name,value:l.value,placeholder:l.placeholder,isRequired:l.isRequired,disabled:l.disabled},null,8,n)],2)}var r=l(5685),u={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,r.A)()},methods:{getStatus:(e,a)=>{let l;return l=a?"is-valid":e?"is-invalid":null,l}}},c=l(6262);const o=(0,c.A)(u,[["render",i]]);var d=o}}]);
//# sourceMappingURL=966.b44f3480.js.map