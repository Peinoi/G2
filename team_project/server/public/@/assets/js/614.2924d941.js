"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[614],{6571:function(e,a,t){t.d(a,{A:function(){return d}});var l=t(641),s=t(2644);const n=["id","rows","name","value","placeholder","isRequired","disabled"];function u(e,a,t,u,i,o){return(0,l.uX)(),(0,l.CE)("div",{class:(0,s.C4)(["input-group",`input-group-${t.variant} ${o.getStatus(t.error,t.success)}`])},[(0,l.Lk)("textarea",{id:t.id,class:"form-control",rows:t.rows,name:t.name,value:t.value,placeholder:t.placeholder,isRequired:t.isRequired,disabled:t.disabled},null,8,n)],2)}var i=t(5685),o={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,i.A)()},methods:{getStatus:(e,a)=>{let t;return t=a?"is-valid":e?"is-invalid":null,t}}},r=t(6262);const c=(0,r.A)(o,[["render",u]]);var d=c},8614:function(e,a,t){t.r(a),t.d(a,{default:function(){return Le}});t(8743),t(3725),t(5019),t(9838),t(1339),t(9229);var l=t(641),s=t(2644),n=t(9322),u=t(9841),i=t(5220),o=t(4335),r=t(6698),c=t(6571),d=t(2351);const m=e=>((0,l.Qi)("data-v-0473b349"),e=e(),(0,l.jt)(),e),v={class:"p-6"},p={class:"page-shell space-y-6"},k={class:"page-header"},f=m(()=>(0,l.Lk)("div",null,[(0,l.Lk)("h2",{class:"page-title text-2xl md:text-3xl font-bold tracking-tight"}," 상담서 수정 ")],-1)),b={class:"header-actions"},L={key:0,class:"text-sm text-gray-500"},y={key:1,class:"text-sm text-red-600"},g={class:"meta-card"},h={class:"meta-grid"},x={class:"meta-item"},C=m(()=>(0,l.Lk)("span",{class:"meta-label"},"지원자",-1)),_={class:"meta-value"},w={class:"meta-item"},A=m(()=>(0,l.Lk)("span",{class:"meta-label"},"보호자",-1)),E={class:"meta-value"},F={class:"meta-item"},B=m(()=>(0,l.Lk)("span",{class:"meta-label"},"담당자",-1)),K={class:"meta-value"},R={class:"meta-item"},X=m(()=>(0,l.Lk)("span",{class:"meta-label"},"장애유형",-1)),D={class:"meta-value"},z={class:"meta-item"},V=m(()=>(0,l.Lk)("span",{class:"meta-label"},"조사지 제출일",-1)),S={class:"meta-value"},I={class:"meta-item"},N=m(()=>(0,l.Lk)("span",{class:"meta-label"},"상담일",-1)),W={class:"meta-value"},q={class:"card-block space-y-4"},U=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 제목",-1)),$=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 내용",-1)),J=m(()=>(0,l.Lk)("span",{class:"block text-sm font-medium mb-1"},"기존 첨부 파일",-1)),M={key:0},j={class:"mt-1 text-xs text-gray-700 space-y-1"},O={class:"flex items-center justify-between gap-2"},Q=["href"],T=["onClick"],Y={key:0,class:"text-[11px] text-red-500 pl-1"},G={key:1,class:"text-xs text-gray-400"},H=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"첨부 파일 추가",-1)),P=m(()=>(0,l.Lk)("p",{class:"mt-1 text-xs text-gray-500"}," * 여러 개 파일을 한 번에 선택하거나, 나눠서 여러 번 선택할 수 있습니다. ",-1)),Z={key:0,class:"mt-2 text-xs text-gray-700 space-y-1"},ee={class:"truncate"},ae=["onClick"],te={class:"record-header"},le=m(()=>(0,l.Lk)("h4",{class:"font-medium text-sm"},"추가 상담 기록",-1)),se=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담일: ",-1)),ne=["onUpdate:modelValue"],ue=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 제목",-1)),ie=m(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 내용",-1)),oe={class:"action-bar"},re={class:"left-actions"},ce={class:"right-actions"},de=m(()=>(0,l.Lk)("option",{value:"BB1"},"긴급",-1)),me=m(()=>(0,l.Lk)("option",{value:"BB2"},"중점",-1)),ve=m(()=>(0,l.Lk)("option",{value:"BB3"},"계획",-1)),pe=[de,me,ve];var ke={__name:"CounselEdit",setup(e){const a=(0,i.lq)(),t=(0,i.rd)(),m=Number(a.params.submitCode),de=JSON.parse(localStorage.getItem("user")||"{}"),me=Number(de.user_code||0),ve=(0,u.KR)(!1),ke=(0,u.KR)(""),fe=(0,u.KR)(""),be=(0,l.EW)(()=>"CB4"===fe.value),Le=(0,u.KR)({name:"",ssnFront:"",submitAt:""}),ye=(0,l.EW)(()=>{const e=Le.value.submitAt;return e?e.slice(0,10):"-"}),ge=(0,u.KR)({counselDate:"",title:"",content:""}),he=(0,u.KR)([]),xe=(0,u.KR)("BB3"),Ce=(0,u.KR)([]),_e=(0,u.KR)([]),we=(0,u.KR)([]),Ae=(0,u.KR)(null);async function Ee(){ve.value=!0,ke.value="";try{const{data:e}=await o.A.get(`/api/counsel/${m}`);if(!e?.success||!e.result)throw new Error(e?.message||"상담 정보를 찾을 수 없습니다.");const a=e.result;Le.value=a.submit_info||Le.value,ge.value={counselDate:a.main?.counsel_date||"",title:a.main?.title||"",content:a.main?.content||""},xe.value=a.priority||"BB3",fe.value=a.status||"",he.value=(a.details||[]).map((e,a)=>({id:Date.now()+a,counselDate:e.counsel_date||"",title:e.title||"",content:e.content||""}))||[],Ce.value=a.attachments||[]}catch(e){console.error(e),ke.value=e.message||"상담 정보 조회 중 오류"}finally{ve.value=!1}}function Fe(){window.open(`/survey/submission/${m}`,"_blank")}function Be(){t.push({name:"counselList"})}function Ke(){he.value.push({id:Date.now(),counselDate:"",title:"",content:""})}function Re(e){he.value=he.value.filter(a=>a.id!==e)}function Xe(e){const a=_e.value.indexOf(e);-1===a?_e.value.push(e):_e.value.splice(a,1)}function De(e){const a=Array.from(e.target.files||[]),t=a.filter(e=>!we.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified));we.value=[...we.value,...t],e.target&&(e.target.value="")}function ze(e){we.value.splice(e,1)}function Ve(){if(!ge.value.counselDate)return"상담일을 입력해주세요.";if(!ge.value.title.trim())return"상담 제목을 입력해주세요.";if(!ge.value.content.trim())return"상담 내용을 입력해주세요.";for(const e of he.value){if(!e.counselDate)return"추가 상담 기록의 상담일을 입력해주세요.";if(!e.title.trim())return"추가 상담 기록의 제목을 입력해주세요.";if(!e.content.trim())return"추가 상담 기록의 내용을 입력해주세요."}return null}async function Se(){const e=Ve();if(e)alert(e);else try{const e={submitCode:m,priority:xe.value,mainForm:ge.value,records:he.value,removeAttachmentCodes:_e.value,modifier:me,requesterCode:me},a=new FormData;a.append("formJson",JSON.stringify(e)),we.value.forEach(e=>{a.append("mainFiles",e)});const l=await o.A.post("/api/counsel/new",a,{headers:{"Content-Type":"multipart/form-data"}});l.data?.success?(be.value?alert("재작성이 완료되었습니다. 승인요청이 다시 올라갔습니다."):alert("상담 수정이 완료되었습니다."),t.push({name:"counselList"})):alert(l.data.message||"수정 실패")}catch(a){console.error(a),alert("서버 오류: "+(a.response?.data?.message||a.message))}}return Ee(),(e,a)=>((0,l.uX)(),(0,l.CE)("section",v,[(0,l.Lk)("div",p,[(0,l.Lk)("header",k,[f,(0,l.Lk)("div",b,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Be},{default:(0,l.k6)(()=>[(0,l.eW)(" ← 목록으로 ")]),_:1})])]),ve.value?((0,l.uX)(),(0,l.CE)("div",L,"불러오는 중...")):ke.value?((0,l.uX)(),(0,l.CE)("div",y,(0,s.v_)(ke.value),1)):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[(0,l.Lk)("div",g,[(0,l.Lk)("div",h,[(0,l.Lk)("div",x,[C,(0,l.Lk)("span",_,(0,s.v_)(Le.value.childName||"본인"),1)]),(0,l.Lk)("div",w,[A,(0,l.Lk)("span",E,(0,s.v_)(Le.value.guardianName||"-"),1)]),(0,l.Lk)("div",F,[B,(0,l.Lk)("span",K,(0,s.v_)(Le.value.assigneeName||"-"),1)]),(0,l.Lk)("div",R,[X,(0,l.Lk)("span",D,(0,s.v_)(Le.value.disabilityType||"-"),1)]),(0,l.Lk)("div",z,[V,(0,l.Lk)("span",S,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Fe},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(ye.value),1)]),_:1})])]),(0,l.Lk)("div",I,[N,(0,l.Lk)("span",W,[(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=e=>ge.value.counselDate=e),class:"input"},null,512),[[n.Jo,ge.value.counselDate]])])])])]),(0,l.Lk)("div",q,[(0,l.Lk)("div",null,[U,(0,l.bF)(d.A,{id:"edit-title",variant:"static",size:"default",modelValue:ge.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>ge.value.title=e),placeholder:"상담 제목을 입력하세요"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[$,(0,l.bF)(c.A,{id:"edit-content",variant:"outline",rows:5,placeholder:"상담 내용을 입력하세요...",value:ge.value.content,onInput:a[2]||(a[2]=e=>ge.value.content=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",null,[J,Ce.value.length?((0,l.uX)(),(0,l.CE)("div",M,[(0,l.Lk)("ul",j,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ce.value,e=>((0,l.uX)(),(0,l.CE)("li",{key:e.attachCode,class:"space-y-0.5"},[(0,l.Lk)("div",O,[(0,l.Lk)("a",{href:e.url,target:"_blank",class:(0,s.C4)(["flex-1 min-w-0 truncate underline",{"line-through text-gray-400":_e.value.includes(e.attachCode)}])},(0,s.v_)(e.originalFilename),11,Q),(0,l.Lk)("button",{type:"button",class:"shrink-0 px-2 py-0.5 border rounded text-[11px] text-gray-600 hover:bg-gray-100",onClick:a=>Xe(e.attachCode)},(0,s.v_)(_e.value.includes(e.attachCode)?"취소":"삭제"),9,T)]),_e.value.includes(e.attachCode)?((0,l.uX)(),(0,l.CE)("div",Y," 삭제 예정 ")):(0,l.Q3)("",!0)]))),128))])])):((0,l.uX)(),(0,l.CE)("div",G," 기존에 첨부된 파일이 없습니다. "))]),(0,l.Lk)("div",null,[H,(0,l.Lk)("input",{ref_key:"fileInputRef",ref:Ae,type:"file",multiple:"",onChange:De,class:"file-input"},null,544),P,we.value.length?((0,l.uX)(),(0,l.CE)("ul",Z,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(we.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.name+"_"+e.lastModified+"_"+a,class:"flex items-center justify-between gap-2"},[(0,l.Lk)("span",ee," • "+(0,s.v_)(e.name)+" ("+(0,s.v_)((e.size/1024).toFixed(1))+" KB) ",1),(0,l.Lk)("button",{type:"button",class:"shrink-0 px-2 py-0.5 border rounded text-[11px] text-gray-600 hover:bg-gray-100",onClick:e=>ze(a)}," 삭제 ",8,ae)]))),128))])):(0,l.Q3)("",!0)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(he.value,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"record-card space-y-4"},[(0,l.Lk)("div",te,[le,(0,l.bF)(r.A,{color:"dark",size:"sm",variant:"outlined",onClick:a=>Re(e.id)},{default:(0,l.k6)(()=>[(0,l.eW)(" 제거 ")]),_:2},1032,["onClick"])]),(0,l.Lk)("div",null,[se,(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":a=>e.counselDate=a,class:"input"},null,8,ne),[[n.Jo,e.counselDate]])]),(0,l.Lk)("div",null,[ue,(0,l.bF)(d.A,{id:`record-title-${e.id}`,variant:"static",size:"default",modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"상담 제목을 입력하세요"},null,8,["id","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",null,[ie,(0,l.bF)(c.A,{id:`record-content-${e.id}`,variant:"outline",rows:3,placeholder:"상담 내용을 입력하세요...",value:e.content,onInput:a=>e.content=a.target.value},null,8,["id","value","onInput"])])]))),128)),(0,l.Lk)("div",oe,[(0,l.Lk)("div",re,[(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Be},{default:(0,l.k6)(()=>[(0,l.eW)(" 수정 취소 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Ke},{default:(0,l.k6)(()=>[(0,l.eW)(" + 상담 기록 추가 ")]),_:1})]),(0,l.Lk)("div",ce,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>xe.value=e),class:"input priority-select"},pe,512),[[n.u1,xe.value]]),(0,l.bF)(r.A,{color:"dark",size:"sm",onClick:Se},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(be.value?"재작성 완료":"수정 완료"),1)]),_:1})])])],64))])]))}},fe=t(6262);const be=(0,fe.A)(ke,[["__scopeId","data-v-0473b349"]]);var Le=be}}]);
//# sourceMappingURL=614.2924d941.js.map