"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[497],{5497:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});var l=t(641),s=t(2644),n=t(9841),c=t(5220),u=t(4335),r=t(6698);const i=e=>((0,l.Qi)("data-v-59d0765b"),e=e(),(0,l.jt)(),e),o={class:"p-6 max-w-5xl mx-auto space-y-6"},d={class:"form-action"},v={key:0,class:"detail-card"},k={class:"flex justify-between items-center detail-header"},p=i(()=>(0,l.Lk)("h2",{class:"text-2xl font-semibold"},"결과보고서 상세",-1)),_={class:"meta-card improved-meta"},m={class:"info-grid"},f=i(()=>(0,l.Lk)("div",{class:"info-label"},"제목",-1)),L={class:"info-value"},b=i(()=>(0,l.Lk)("div",{class:"info-label"},"작성일",-1)),h={class:"info-value"},y={class:"content-block"},g=i(()=>(0,l.Lk)("div",{class:"content-title"},"내용",-1)),C={class:"content-box whitespace-pre-line"},w={key:0,class:"detail-card"},E=i(()=>(0,l.Lk)("h3",{class:"text-xl font-semibold mb-4"},"참석자 목록",-1)),A={class:"attendance-table"},x=i(()=>(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"신청코드"),(0,l.Lk)("th",null,"자녀명"),(0,l.Lk)("th",null,"보호자명"),(0,l.Lk)("th",null,"참석여부")])],-1)),X={key:0},j={key:1},K={key:0,class:"pagination"},R=["disabled"],I={class:"page-info"},Q=["disabled"],W={class:"content-block"},F=i(()=>(0,l.Lk)("div",{class:"content-title"},"첨부파일",-1)),B={key:0},S={class:"file-list"},$=["onClick"],z={key:1,class:"text-xs text-gray-400"},N=["src"],O={key:1,class:"pt-4 border-t mt-2 space-y-3"},q={class:"approve-actions"},D=10;var J={__name:"EventResultInfo",setup(e){const a=(0,c.lq)(),t=(0,c.rd)(),i=(0,n.KR)(null),J=Number(a.params.resultCode||0),M=()=>{const e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e).role||null}catch{return null}},V=(0,n.KR)(M()),G=(0,n.KR)(""),H=e=>{const a=e.original_filename.split(".").pop().toLowerCase();["jpg","jpeg","png","gif","webp"].includes(a)?G.value=e.file_path:"pdf"===a?window.open(e.file_path,"_blank"):window.location.href=e.file_path},P=()=>G.value="",T=e=>{switch(e){case"BA1":return"status-pill--before";case"BA2":return"status-pill--done";case"BA3":return"status-pill--rejected";default:return""}},U=async()=>{try{const e=await u.A.post(`/api/event/result/${J}/approve`);e.data.success?(alert("승인되었습니다."),await Z()):alert(e.data.message||"승인 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.message||""))}},Y=async()=>{const e=prompt("반려 사유를 입력해주세요:");if(e)try{const a=await u.A.post(`/api/event/result/${J}/reject`,{reason:e});a.data.success?(alert("반려 처리되었습니다."),await Z()):alert(a.data.message||"반려 실패")}catch(a){console.error(a),alert("서버 오류: "+(a.message||""))}},Z=async()=>{try{const e=await u.A.get(`/api/event/result/${J}`);"success"===e.data?.status?i.value=e.data.data:alert("결과보고서 조회 실패")}catch(e){console.error("fetchResult error:",e),alert("서버 오류 발생")}},ee=(0,n.KR)([]),ae=(0,n.KR)(1),te=(0,l.EW)(()=>{const e=(ae.value-1)*D;return ee.value.slice(e,e+D)}),le=(0,l.EW)(()=>Math.ceil(ee.value.length/D)),se=async()=>{if(i.value?.event_code)try{const e=await u.A.get(`/api/event/myAttendanceList/${i.value.event_code}`);ee.value=e.data.data||[],ae.value=1}catch(e){console.error("fetchAttendance error:",e),alert("서버 오류 발생")}},ne=e=>e?new Date(e).toISOString().slice(0,10):"",ce=(0,l.EW)(()=>"AA3"===V.value&&"BA2"!==i.value?.result_status),ue=()=>t.back();return(0,l.sV)(async()=>{await Z(),await se()}),(e,a)=>((0,l.uX)(),(0,l.CE)("section",o,[(0,l.Lk)("div",d,[(0,l.bF)(r.A,{color:"dark",size:"sm",variant:"outlined",onClick:ue},{default:(0,l.k6)(()=>[(0,l.eW)(" ← 목록으로 ")]),_:1})]),i.value?((0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("header",k,[p,(0,l.Lk)("span",{class:(0,s.C4)(["status-pill",T(i.value.result_status)])},(0,s.v_)(i.value.result_status_name),3)]),(0,l.Lk)("div",_,[(0,l.Lk)("div",m,[f,(0,l.Lk)("div",L,(0,s.v_)(i.value.result_subject),1),b,(0,l.Lk)("div",h,(0,s.v_)(ne(i.value.report_register_date)),1)])]),(0,l.Lk)("div",y,[g,(0,l.Lk)("div",C,(0,s.v_)(i.value.result_content),1)]),ee.value&&ee.value.length?((0,l.uX)(),(0,l.CE)("div",w,[E,(0,l.Lk)("table",A,[x,(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(te.value,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.apply_code},[(0,l.Lk)("td",null,(0,s.v_)(e.apply_code),1),(0,l.Lk)("td",null,(0,s.v_)(e.child_name),1),(0,l.Lk)("td",null,(0,s.v_)(e.applicant_name),1),(0,l.Lk)("td",null,["승인"===e.apply_status_name?((0,l.uX)(),(0,l.CE)("span",X,"참석")):((0,l.uX)(),(0,l.CE)("span",j,"불참석"))])]))),128))])]),le.value>1?((0,l.uX)(),(0,l.CE)("div",K,[(0,l.Lk)("button",{class:"page-btn",disabled:1===ae.value,onClick:a[0]||(a[0]=e=>ae.value--)}," 이전 ",8,R),(0,l.Lk)("span",I,(0,s.v_)(ae.value)+" / "+(0,s.v_)(le.value),1),(0,l.Lk)("button",{class:"page-btn",disabled:ae.value===le.value,onClick:a[1]||(a[1]=e=>ae.value++)}," 다음 ",8,Q)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",W,[F,i.value.attachments?.length?((0,l.uX)(),(0,l.CE)("div",B,[(0,l.Lk)("ul",S,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.value.attachments,e=>((0,l.uX)(),(0,l.CE)("li",{key:e.server_filename},[(0,l.Lk)("span",{class:"file-name",onClick:a=>H(e)},(0,s.v_)(e.original_filename),9,$)]))),128))])])):((0,l.uX)(),(0,l.CE)("div",z,"첨부된 파일이 없습니다.")),G.value?((0,l.uX)(),(0,l.CE)("div",{key:2,class:"preview-modal",onClick:P},[(0,l.Lk)("img",{src:G.value,class:"preview-img"},null,8,N)])):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),ce.value?((0,l.uX)(),(0,l.CE)("div",O,[(0,l.Lk)("div",q,[(0,l.bF)(r.A,{color:"dark",size:"sm",class:"px-4",onClick:U},{default:(0,l.k6)(()=>[(0,l.eW)(" 승인 ")]),_:1}),(0,l.bF)(r.A,{color:"dark",size:"sm",class:"px-4",onClick:Y},{default:(0,l.k6)(()=>[(0,l.eW)(" 반려 ")]),_:1})])])):(0,l.Q3)("",!0)]))}},M=t(6262);const V=(0,M.A)(J,[["__scopeId","data-v-59d0765b"]]);var G=V}}]);
//# sourceMappingURL=497.21482d82.js.map