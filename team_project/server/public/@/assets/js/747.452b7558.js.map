{"version":3,"file":"@/assets/js/747.452b7558.js","mappings":"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","sources":["webpack://vue-material-dashboard-2/./src/views/PlanEdit.vue","webpack://vue-material-dashboard-2/./src/views/PlanEdit.vue?b1c1","webpack://vue-material-dashboard-2/./src/components/MaterialTextarea.vue","webpack://vue-material-dashboard-2/./src/components/MaterialTextarea.vue?6270"],"sourcesContent":["<template>\r\n  <section class=\"p-6\">\r\n    <div class=\"page-shell space-y-6\">\r\n      <!-- 상단 타이틀 -->\r\n      <header class=\"page-header\">\r\n        <h2 class=\"page-title text-2xl md:text-3xl font-bold tracking-tight\">\r\n          지원계획 수정\r\n        </h2>\r\n      </header>\r\n\r\n      <!-- 로딩 / 에러 -->\r\n      <p v-if=\"loading\" class=\"text-sm text-gray-500\">\r\n        지원계획 정보를 불러오는 중입니다...\r\n      </p>\r\n      <p v-if=\"error\" class=\"text-sm text-red-500\">{{ error }}</p>\r\n\r\n      <!-- 기본정보 카드 -->\r\n      <div class=\"meta-card\">\r\n        <div class=\"meta-grid\">\r\n          <!-- 1. 지원자 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">지원자</span>\r\n            <span class=\"meta-value\">\r\n              {{ submitInfo.childName || \"본인\" }}\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 2. 보호자 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">보호자</span>\r\n            <span class=\"meta-value\">\r\n              {{ submitInfo.name || \"-\" }}\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 3. 담당자 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">담당자</span>\r\n            <span class=\"meta-value\">\r\n              {{ submitInfo.assigneeName || \"-\" }}\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 4. 장애유형 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">장애유형</span>\r\n            <span class=\"meta-value\">\r\n              {{ submitInfo.disabilityType || \"-\" }}\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 우선순위 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">우선순위</span>\r\n            <span class=\"meta-value\">\r\n              {{ priorityLabel(submitInfo.level) }}\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 5. 상담지 제출일 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">상담지 제출일</span>\r\n            <span class=\"meta-value\">\r\n              <MaterialButton color=\"dark\" size=\"sm\" @click=\"openCounselDetail\">\r\n                {{ formattedCounselSubmitAt }}\r\n              </MaterialButton>\r\n            </span>\r\n          </div>\r\n\r\n          <!-- 6. 예상 진행기간 -->\r\n          <div class=\"meta-item\">\r\n            <span class=\"meta-label\">진행기간</span>\r\n            <span class=\"meta-value period-value\">\r\n              <input\r\n                type=\"month\"\r\n                v-model=\"mainForm.expectedStart\"\r\n                class=\"input-month\"\r\n              />\r\n              ~\r\n              <input\r\n                type=\"month\"\r\n                v-model=\"mainForm.expectedEnd\"\r\n                class=\"input-month\"\r\n              />\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 메인 계획 카드 -->\r\n      <div class=\"card-block space-y-4\">\r\n        <!-- 계획 목표 -->\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">계획 목표</label>\r\n          <MaterialInput\r\n            :id=\"`plan-goal-${planCode}`\"\r\n            variant=\"static\"\r\n            size=\"default\"\r\n            v-model=\"mainForm.goal\"\r\n            placeholder=\"지원계획의 목표를 입력하세요\"\r\n          />\r\n        </div>\r\n\r\n        <!-- 계획 내용 (일반용) -->\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">\r\n            계획 내용 (일반용)\r\n          </label>\r\n          <MaterialTextarea\r\n            id=\"plan-content-public\"\r\n            variant=\"outline\"\r\n            :rows=\"4\"\r\n            placeholder=\"대상자/일반용 계획 내용을 입력하세요...\"\r\n            :value=\"mainForm.publicContent\"\r\n            @input=\"(e) => (mainForm.publicContent = e.target.value)\"\r\n          />\r\n        </div>\r\n\r\n        <!-- 계획 내용 (관리자용) -->\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">\r\n            계획 내용 (관리자용)\r\n          </label>\r\n          <MaterialTextarea\r\n            id=\"plan-content-private\"\r\n            variant=\"outline\"\r\n            :rows=\"4\"\r\n            placeholder=\"관계자/관리자용 내부 계획 내용을 입력하세요...\"\r\n            :value=\"mainForm.privateContent\"\r\n            @input=\"(e) => (mainForm.privateContent = e.target.value)\"\r\n          />\r\n        </div>\r\n\r\n        <!-- 첨부 파일 -->\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">첨부 파일</label>\r\n          <input\r\n            ref=\"fileInputRef\"\r\n            type=\"file\"\r\n            multiple\r\n            @change=\"onMainFilesChange\"\r\n            class=\"file-input\"\r\n          />\r\n          <p class=\"mt-1 text-xs text-gray-500\">\r\n            * 여러 개 파일을 한 번에 선택하거나, 나눠서 여러 번 선택할 수\r\n            있습니다.\r\n          </p>\r\n\r\n          <!-- 기존 첨부파일 -->\r\n          <ul\r\n            v-if=\"existingFiles.length\"\r\n            class=\"mt-2 text-xs text-gray-700 space-y-1\"\r\n          >\r\n            <li\r\n              v-for=\"(file, idx) in existingFiles\"\r\n              :key=\"file.attachCode\"\r\n              class=\"file-row\"\r\n            >\r\n              <span class=\"file-link\">\r\n                {{ file.originalFilename }}\r\n              </span>\r\n              <button\r\n                type=\"button\"\r\n                class=\"chip-button\"\r\n                @click=\"removeExistingFile(idx, file.attachCode)\"\r\n              >\r\n                삭제\r\n              </button>\r\n            </li>\r\n          </ul>\r\n\r\n          <!-- 이번에 새로 선택한 파일 목록 -->\r\n          <ul\r\n            v-if=\"mainFiles.length\"\r\n            class=\"mt-2 text-xs text-gray-700 space-y-1\"\r\n          >\r\n            <li\r\n              v-for=\"(file, idx) in mainFiles\"\r\n              :key=\"file.name + '_' + file.lastModified + '_' + idx\"\r\n              class=\"file-row\"\r\n            >\r\n              <span class=\"file-link\">\r\n                {{ file.name }} ({{ (file.size / 1024).toFixed(1) }} KB)\r\n              </span>\r\n              <button\r\n                type=\"button\"\r\n                class=\"chip-button\"\r\n                @click=\"removeMainFile(idx)\"\r\n              >\r\n                삭제\r\n              </button>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 추가 계획 카드들 -->\r\n      <div\r\n        v-for=\"item in planItems\"\r\n        :key=\"item.id\"\r\n        class=\"record-card space-y-4\"\r\n      >\r\n        <div class=\"record-header\">\r\n          <h4 class=\"font-medium text-sm\">추가 계획</h4>\r\n\r\n          <MaterialButton\r\n            color=\"dark\"\r\n            size=\"sm\"\r\n            variant=\"outlined\"\r\n            @click=\"removePlanItem(item.id)\"\r\n          >\r\n            제거\r\n          </MaterialButton>\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">계획 목표</label>\r\n          <MaterialInput\r\n            :id=\"`plan-item-goal-${item.id}`\"\r\n            variant=\"outline\"\r\n            size=\"default\"\r\n            v-model=\"item.goal\"\r\n            placeholder=\"추가 계획의 목표를 입력하세요\"\r\n          />\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">\r\n            계획 내용 (일반용)\r\n          </label>\r\n          <MaterialTextarea\r\n            :id=\"`plan-item-public-${item.id}`\"\r\n            variant=\"outline\"\r\n            :rows=\"3\"\r\n            placeholder=\"대상자/일반용 내용을 입력하세요...\"\r\n            :value=\"item.publicContent\"\r\n            @input=\"(e) => (item.publicContent = e.target.value)\"\r\n          />\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label class=\"block text-sm mb-1 font-medium\">\r\n            계획 내용 (관자용)\r\n          </label>\r\n          <MaterialTextarea\r\n            :id=\"`plan-item-private-${item.id}`\"\r\n            variant=\"outline\"\r\n            :rows=\"3\"\r\n            placeholder=\"관계자/관리자용 내용을 입력하세요...\"\r\n            :value=\"item.privateContent\"\r\n            @input=\"(e) => (item.privateContent = e.target.value)\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 하단 버튼 라인 -->\r\n      <div class=\"action-bar\">\r\n        <div class=\"left-actions\">\r\n          <MaterialButton color=\"dark\" size=\"sm\" @click=\"goBack\">\r\n            수정 취소\r\n          </MaterialButton>\r\n\r\n          <MaterialButton color=\"dark\" size=\"sm\" @click=\"addPlanItem\">\r\n            + 계획 추가\r\n          </MaterialButton>\r\n        </div>\r\n\r\n        <div class=\"right-actions\">\r\n          <MaterialButton\r\n            color=\"dark\"\r\n            size=\"sm\"\r\n            class=\"ml-auto shrink-0\"\r\n            @click=\"submitAll\"\r\n          >\r\n            {{ isResubmit ? \"재작성 완료\" : \"수정 완료\" }}\r\n          </MaterialButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from \"vue\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport axios from \"axios\";\r\n\r\nimport MaterialButton from \"@/components/MaterialButton.vue\";\r\nimport MaterialTextarea from \"@/components/MaterialTextarea.vue\";\r\nimport MaterialInput from \"@/components/MaterialInput.vue\";\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\n\r\n// 라우터에서 받은 값들\r\nconst planCode = Number(route.params.planCode || 0);\r\nconst submitCode = Number(route.query.submitCode || 0);\r\n\r\n// 기본 정보\r\nconst submitInfo = ref({\r\n  name: \"\", // 보호자(작성자)\r\n  childName: \"\", // 지원자\r\n  guardianName: \"\", // 보호자 = name\r\n  assigneeName: \"\", // 담당자\r\n  disabilityType: \"\", // 장애 유형\r\n  counselSubmitAt: \"\", // 상담지 제출일\r\n  level: \"\",\r\n});\r\n\r\nconst formattedCounselSubmitAt = computed(() => {\r\n  const v = submitInfo.value.counselSubmitAt;\r\n  return v ? String(v).slice(0, 10) : \"-\";\r\n});\r\n\r\n// 메인 계획 폼\r\nconst mainForm = ref({\r\n  planDate: \"\", // 계획 작성일\r\n  expectedStart: \"\",\r\n  expectedEnd: \"\",\r\n  goal: \"\",\r\n  publicContent: \"\",\r\n  privateContent: \"\",\r\n});\r\n\r\n// 첨부 파일들\r\nconst mainFiles = ref([]);\r\nconst fileInputRef = ref(null);\r\n\r\n// 기존 첨부파일\r\nconst existingFiles = ref([]);\r\n// 삭제 예정 첨부 코드\r\nconst removedAttachCodes = ref([]);\r\n\r\n// 추가 계획 목록\r\nconst planItems = ref([]);\r\n\r\nconst loading = ref(false);\r\nconst error = ref(\"\");\r\nconst status = ref(\"\");\r\n\r\n// 반려인 경우 재작성 모드\r\nconst isResubmit = computed(() => status.value === \"CC7\");\r\n\r\n// 오늘 날짜 YYYY-MM-DD\r\nfunction getTodayStr() {\r\n  const d = new Date();\r\n  return d.toISOString().slice(0, 10);\r\n}\r\n\r\n// 기본정보 + 계획 상세 로딩\r\nasync function loadData() {\r\n  loading.value = true;\r\n  error.value = \"\";\r\n\r\n  try {\r\n    if (!submitCode) {\r\n      throw new Error(\"submitCode가 없습니다. (쿼리로 전달 필요)\");\r\n    }\r\n    if (!planCode) {\r\n      throw new Error(\"planCode가 없습니다. (params로 전달 필요)\");\r\n    }\r\n\r\n    const [basicRes, detailRes] = await Promise.all([\r\n      axios.get(`/api/plans/${submitCode}`),\r\n      axios.get(`/api/plans/detail/${planCode}`),\r\n    ]);\r\n\r\n    // 1) 기본 정보\r\n    if (!basicRes.data?.success || !basicRes.data.result) {\r\n      throw new Error(\r\n        basicRes.data?.message || \"지원자 기본 정보를 찾을 수 없습니다.\"\r\n      );\r\n    }\r\n    const basic = basicRes.data.result;\r\n\r\n    submitInfo.value = {\r\n      name: basic.name || \"\", // 보호자(작성자)\r\n      childName: basic.childName || \"\",\r\n      guardianName: basic.guardianName || basic.name || \"\",\r\n      assigneeName: basic.assigneeName || \"\",\r\n      disabilityType: basic.disabilityType || \"\",\r\n      counselSubmitAt: basic.counselSubmitAt || \"\",\r\n      level: basic.level || \"\",\r\n    };\r\n\r\n    // 2) 계획 상세 정보\r\n    if (!detailRes.data?.success || !detailRes.data.result) {\r\n      throw new Error(\r\n        detailRes.data?.message || \"지원계획 정보를 찾을 수 없습니다.\"\r\n      );\r\n    }\r\n    const d = detailRes.data.result;\r\n\r\n    mainForm.value = {\r\n      planDate: d.main?.planDate\r\n        ? String(d.main.planDate).slice(0, 10)\r\n        : getTodayStr(),\r\n      expectedStart: d.main?.expectedStart || \"\",\r\n      expectedEnd: d.main?.expectedEnd || \"\",\r\n      goal: d.main?.goal || \"\",\r\n      publicContent: d.main?.publicContent || \"\",\r\n      privateContent: d.main?.privateContent || \"\",\r\n    };\r\n\r\n    status.value = d.status || \"\";\r\n\r\n    planItems.value =\r\n      (d.items || []).map((it, idx) => ({\r\n        id: it.planItemCode || Date.now() + idx,\r\n        goal: it.goal || \"\",\r\n        publicContent: it.publicContent || \"\",\r\n        privateContent: it.privateContent || \"\",\r\n      })) || [];\r\n\r\n    existingFiles.value =\r\n      (d.attachments || []).map((a) => ({\r\n        attachCode: a.attachCode,\r\n        originalFilename: a.originalFilename,\r\n        url: a.url,\r\n      })) || [];\r\n  } catch (e) {\r\n    console.error(e);\r\n    error.value = e.message || \"지원계획 정보 조회 중 오류\";\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n}\r\n\r\nfunction priorityLabel(code) {\r\n  const c = (code || \"\").toString().toUpperCase();\r\n\r\n  switch (c) {\r\n    case \"BB1\":\r\n      return \"긴급\";\r\n    case \"BB2\":\r\n      return \"중점\";\r\n    case \"BB3\":\r\n      return \"계획\";\r\n    default:\r\n      return \"-\";\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  loadData();\r\n});\r\n\r\n// 파일 변경 핸들러\r\nfunction onMainFilesChange(e) {\r\n  const files = Array.from(e.target.files || []);\r\n\r\n  const newOnes = files.filter(\r\n    (f) =>\r\n      !mainFiles.value.some(\r\n        (ex) =>\r\n          ex.name === f.name &&\r\n          ex.size === f.size &&\r\n          ex.lastModified === f.lastModified\r\n      )\r\n  );\r\n\r\n  mainFiles.value = [...mainFiles.value, ...newOnes];\r\n\r\n  if (e.target) {\r\n    e.target.value = \"\";\r\n  }\r\n}\r\n\r\n// 새로 선택된 파일 삭제\r\nfunction removeMainFile(index) {\r\n  mainFiles.value.splice(index, 1);\r\n}\r\n\r\n// 기존 파일 삭제 (바로 UI에서 제거 + 코드만 모아두기)\r\nfunction removeExistingFile(index, attachCode) {\r\n  if (attachCode && !removedAttachCodes.value.includes(attachCode)) {\r\n    removedAttachCodes.value.push(attachCode);\r\n  }\r\n  existingFiles.value.splice(index, 1);\r\n}\r\n\r\n// 상담지 상세 열기 (새 탭)\r\nfunction openCounselDetail() {\r\n  if (!submitCode) return;\r\n  const url = `/counsel/detail/${submitCode}`;\r\n  window.open(url, \"_blank\");\r\n}\r\n\r\n// 목록으로 돌아가기\r\nfunction goBack() {\r\n  router.push({ name: \"planList\" });\r\n}\r\n\r\n// 추가 계획 블록 추가\r\nfunction addPlanItem() {\r\n  planItems.value.push({\r\n    id: Date.now(),\r\n    goal: \"\",\r\n    publicContent: \"\",\r\n    privateContent: \"\",\r\n  });\r\n}\r\n\r\n// 추가 계획 삭제\r\nfunction removePlanItem(id) {\r\n  planItems.value = planItems.value.filter((p) => p.id !== id);\r\n}\r\n\r\n// 유효성 체크\r\nfunction validate() {\r\n  if (!mainForm.value.goal.trim()) return \"계획 목표를 입력해주세요.\";\r\n  if (!mainForm.value.publicContent.trim())\r\n    return \"계획 내용(일반용)을 입력해주세요.\";\r\n  if (!mainForm.value.privateContent.trim())\r\n    return \"계획 내용(관리자용)을 입력해주세요.\";\r\n\r\n  for (const p of planItems.value) {\r\n    if (!p.goal.trim()) return \"추가 계획의 목표를 입력해주세요.\";\r\n    if (!p.publicContent.trim())\r\n      return \"추가 계획의 내용(일반용)을 입력해주세요.\";\r\n    if (!p.privateContent.trim())\r\n      return \"추가 계획의 내용(관리자용)을 입력해주세요.\";\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nconst user = JSON.parse(localStorage.getItem(\"user\") || \"{}\");\r\nconst modifier = Number(user.user_code || 0);\r\n\r\n// 수정/재작성 완료\r\nasync function submitAll() {\r\n  const err = validate();\r\n  if (err) {\r\n    alert(err);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const formJson = {\r\n      planCode,\r\n      submitCode,\r\n      mainForm: mainForm.value,\r\n      planItems: planItems.value,\r\n      removedAttachCodes: removedAttachCodes.value,\r\n      modifier,\r\n    };\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"formJson\", JSON.stringify(formJson));\r\n\r\n    mainFiles.value.forEach((file) => {\r\n      formData.append(\"planFiles\", file);\r\n    });\r\n\r\n    // 1) 내용/첨부 업데이트\r\n    const res = await axios.put(`/api/plans/${planCode}`, formData, {\r\n      headers: {\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    });\r\n\r\n    if (!res.data?.success) {\r\n      alert(res.data.message || \"수정 실패\");\r\n      return;\r\n    }\r\n\r\n    // 2) 반려(CC7) → 재승인요청(CC6) 전환\r\n    if (isResubmit.value) {\r\n      await axios.post(`/api/plans/${planCode}/resubmit`, {\r\n        requesterCode: 2, // TODO: 로그인 사용자 코드로 변경\r\n      });\r\n      alert(\"재작성된 지원계획이 재승인 요청 되었습니다.\");\r\n    } else {\r\n      alert(\"지원계획이 수정되었습니다.\");\r\n    }\r\n\r\n    router.push({ name: \"planList\" });\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\r\n      \"수정 처리 중 서버 오류: \" + (e.response?.data?.message || e.message)\r\n    );\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\nsection {\r\n  color: #111827;\r\n}\r\n\r\n/* 페이지 폭 통일 */\r\n.page-shell {\r\n  max-width: 960px;\r\n  margin: 0 auto;\r\n}\r\n\r\n/* 헤더 */\r\n.page-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 1rem;\r\n}\r\n\r\n.page-title {\r\n  letter-spacing: -0.02em;\r\n}\r\n\r\n/* ===== 기본정보 카드 ===== */\r\n.meta-card {\r\n  border-radius: 0.75rem;\r\n  border: 1px solid #e5e7eb;\r\n  background-color: #f9fafb;\r\n  padding: 0.9rem 1rem;\r\n  font-size: 0.85rem;\r\n}\r\n\r\n/* meta grid (작성/수정 공용) */\r\n.meta-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\r\n  gap: 0.75rem 1rem;\r\n}\r\n\r\n.meta-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.meta-label {\r\n  font-size: 0.78rem;\r\n  color: #6b7280;\r\n  margin-bottom: 0.15rem;\r\n}\r\n\r\n.meta-value {\r\n  font-size: 0.9rem;\r\n  color: #111827;\r\n  font-weight: 500;\r\n}\r\n\r\n/* 기간 month input */\r\n.period-value {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.35rem;\r\n}\r\n\r\n.input-month {\r\n  width: 78px;\r\n  min-width: 78px;\r\n  max-width: 78px;\r\n  padding: 0.2rem 0.35rem;\r\n  font-size: 0.75rem;\r\n  border-radius: 0.375rem;\r\n  border: 1px solid #d1d5db;\r\n  background: white;\r\n}\r\n\r\n/* ===== 메인 카드 ===== */\r\n.card-block {\r\n  border-radius: 0.9rem;\r\n  border: 1px solid #e5e7eb;\r\n  background-color: #ffffff;\r\n  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.04);\r\n  padding: 1.25rem 1.1rem;\r\n}\r\n\r\n/* form group 간 간격 */\r\n.form-group + .form-group {\r\n  margin-top: 0.85rem;\r\n}\r\n\r\n/* 공통 input */\r\n.input {\r\n  border-radius: 0.375rem;\r\n  border: 1px solid #d1d5db;\r\n  padding: 0.35rem 0.6rem;\r\n  font-size: 0.875rem;\r\n  outline: none;\r\n  min-width: 8rem;\r\n  background-color: #ffffff;\r\n}\r\n\r\n.input:focus {\r\n  border-color: #111827;\r\n}\r\n\r\n/* ===== 파일 인풋 ===== */\r\n.file-input {\r\n  display: block;\r\n  width: 100%;\r\n  font-size: 0.8rem;\r\n}\r\n\r\n/* 파일 리스트 */\r\n.file-row {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.file-link {\r\n  flex: 0 1 auto;\r\n  min-width: 0;\r\n  font-size: 0.8rem;\r\n  color: #374151;\r\n  text-decoration: none;\r\n  word-break: break-all;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.file-link:hover {\r\n  text-decoration: underline;\r\n  color: #111827;\r\n}\r\n\r\n/* 파일 삭제 chip 버튼 */\r\n.chip-button {\r\n  padding: 0.15rem 0.45rem;\r\n  border-radius: 999px;\r\n  border: 1px solid #d1d5db;\r\n  background-color: #f9fafb;\r\n  font-size: 0.7rem;\r\n  color: #4b5563;\r\n  cursor: pointer;\r\n  white-space: nowrap;\r\n}\r\n\r\n.chip-button:hover {\r\n  background-color: #e5e7eb;\r\n}\r\n\r\n/* ===== 추가 계획 카드 ===== */\r\n.record-card {\r\n  margin-top: 10px;\r\n  border-radius: 0.8rem;\r\n  border: 1px solid #e5e7eb;\r\n  background-color: #ffffff;\r\n  padding: 1.1rem 1rem;\r\n  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.04);\r\n}\r\n\r\n.record-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n/* ===== 하단 버튼바 ===== */\r\n.action-bar {\r\n  margin-top: 10px;\r\n  padding-top: 0.5rem;\r\n  border-top: 1px solid #e5e7eb;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.left-actions,\r\n.right-actions {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n/* ===== 공통 폰트 ===== */\r\nsection,\r\nlabel,\r\ninput,\r\ntextarea {\r\n  font-family:\r\n    \"Noto Sans KR\",\r\n    system-ui,\r\n    -apple-system,\r\n    BlinkMacSystemFont,\r\n    \"Segoe UI\",\r\n    sans-serif;\r\n}\r\n</style>\r\n","import script from \"./PlanEdit.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./PlanEdit.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./PlanEdit.vue?vue&type=style&index=0&id=89ed639c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-89ed639c\"]])\n\nexport default __exports__","<template>\r\n  <div\r\n    class=\"input-group\"\r\n    :class=\"`input-group-${variant} ${getStatus(error, success)}`\"\r\n  >\r\n    <textarea\r\n      :id=\"id\"\r\n      class=\"form-control\"\r\n      :rows=\"rows\"\r\n      :name=\"name\"\r\n      :value=\"value\"\r\n      :placeholder=\"placeholder\"\r\n      :isRequired=\"isRequired\"\r\n      :disabled=\"disabled\"\r\n    ></textarea>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport setMaterialInput from \"@/assets/js/material-input.js\";\r\n\r\nexport default {\r\n  name: \"MaterialTextarea\",\r\n  props: {\r\n    variant: {\r\n      type: String,\r\n      default: \"outline\",\r\n    },\r\n    id: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    name: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    value: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    placeholder: {\r\n      type: String,\r\n      default: \"Your text here...\",\r\n    },\r\n    isRequired: Boolean,\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    rows: {\r\n      type: Number,\r\n      default: 5,\r\n    },\r\n    success: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    error: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  mounted() {\r\n    setMaterialInput();\r\n  },\r\n  methods: {\r\n    getStatus: (error, success) => {\r\n      let isValidValue;\r\n\r\n      if (success) {\r\n        isValidValue = \"is-valid\";\r\n      } else if (error) {\r\n        isValidValue = \"is-invalid\";\r\n      } else {\r\n        isValidValue = null;\r\n      }\r\n\r\n      return isValidValue;\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import { render } from \"./MaterialTextarea.vue?vue&type=template&id=204b2d53\"\nimport script from \"./MaterialTextarea.vue?vue&type=script&lang=js\"\nexport * from \"./MaterialTextarea.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","planCode","Number","params","submitCode","query","submitInfo","ref","name","childName","guardianName","assigneeName","disabilityType","counselSubmitAt","level","formattedCounselSubmitAt","computed","v","value","String","slice","mainForm","planDate","expectedStart","expectedEnd","goal","publicContent","privateContent","mainFiles","fileInputRef","existingFiles","removedAttachCodes","planItems","loading","error","status","isResubmit","getTodayStr","d","Date","toISOString","async","loadData","Error","basicRes","detailRes","Promise","all","axios","get","data","success","result","message","basic","main","items","map","it","idx","id","planItemCode","now","attachments","a","attachCode","originalFilename","url","e","console","priorityLabel","code","c","toString","toUpperCase","onMainFilesChange","files","Array","from","target","newOnes","filter","f","some","ex","size","lastModified","removeMainFile","index","splice","removeExistingFile","includes","push","openCounselDetail","window","open","goBack","addPlanItem","removePlanItem","p","validate","trim","onMounted","user","JSON","parse","localStorage","getItem","modifier","user_code","submitAll","err","alert","formJson","formData","FormData","append","stringify","forEach","file","res","put","headers","post","requesterCode","response","__exports__","_createElementBlock","class","_normalizeClass","$props","variant","$options","getStatus","_createElementVNode","rows","placeholder","isRequired","disabled","props","type","default","required","Boolean","mounted","setMaterialInput","methods","isValidValue","render"],"sourceRoot":""}