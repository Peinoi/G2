{"version":3,"file":"@/assets/js/400.97b00205.js","mappings":"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","sources":["webpack://vue-material-dashboard-2/./src/views/EventResultAdd.vue","webpack://vue-material-dashboard-2/./src/views/EventResultAdd.vue?63fd"],"sourcesContent":["<template>\r\n  <div class=\"result-form\">\r\n    <h2>결과보고서 {{ isUpdated ? \"수정\" : \"등록\" }}</h2>\r\n\r\n    <form @submit.prevent=\"submitForm\">\r\n      <div class=\"card\">\r\n        <h3>기본 정보</h3>\r\n        <div class=\"grid-2\">\r\n          <div>\r\n            <label>연결 이벤트 선택</label>\r\n            <select v-model=\"form.event_code\" required>\r\n              <option value=\"\">이벤트 선택</option>\r\n              <option\r\n                v-for=\"ev in filteredMyEvents\"\r\n                :value=\"ev.event_code\"\r\n                :key=\"ev.event_code\"\r\n              >\r\n                {{ ev.event_name }}\r\n              </option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label>작성일</label>\r\n            <input type=\"date\" v-model=\"formattedReportDate\" readonly />\r\n          </div>\r\n\r\n          <div>\r\n            <label>결과 제목</label>\r\n            <input type=\"text\" v-model=\"form.result_subject\" required />\r\n          </div>\r\n\r\n          <div>\r\n            <label>매니저 코드</label>\r\n            <input type=\"text\" :value=\"userName || user_code\" readonly />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card\">\r\n        <h3>내용</h3>\r\n        <textarea v-model=\"form.result_content\" rows=\"6\" required></textarea>\r\n      </div>\r\n\r\n      <div class=\"card\">\r\n        <h3>첨부파일</h3>\r\n        <input\r\n          type=\"file\"\r\n          multiple\r\n          @change=\"handleFileChange\"\r\n          class=\"file-input\"\r\n        />\r\n        <ul>\r\n          <li v-for=\"(f, idx) in existingAttachments\" :key=\"'ex-' + idx\">\r\n            <a :href=\"f.file_path\" target=\"_blank\">{{ f.original_filename }}</a>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-danger\"\r\n              @click=\"removeExistingAttachment(f, idx)\"\r\n            >\r\n              삭제\r\n            </button>\r\n          </li>\r\n          <li v-for=\"(f, idx) in newFiles\" :key=\"'new-' + idx\">\r\n            {{ f.name }}\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-danger\"\r\n              @click=\"removeNewFile(idx)\"\r\n            >\r\n              삭제\r\n            </button>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- 등록 버튼 -->\r\n      <div class=\"submit-wrapper\">\r\n        <button type=\"submit\" class=\"btn-submit\">\r\n          {{ isUpdated ? \"수정\" : \"등록\" }}\r\n        </button>\r\n\r\n        <!-- 승인/반려 버튼 : 권한에 따라 보여주면 됩니다 (여기선 예시로 isAdmin 사용) -->\r\n        <button\r\n          v-if=\"isAdmin && isUpdated\"\r\n          type=\"button\"\r\n          class=\"btn-primary\"\r\n          @click=\"approve\"\r\n        >\r\n          승인\r\n        </button>\r\n        <button\r\n          v-if=\"isAdmin && isUpdated\"\r\n          type=\"button\"\r\n          class=\"btn-danger\"\r\n          @click=\"showRejectPrompt = true\"\r\n        >\r\n          반려\r\n        </button>\r\n\r\n        <!-- 반려사유 보기 -->\r\n        <button\r\n          v-if=\"isUpdated\"\r\n          type=\"button\"\r\n          class=\"btn\"\r\n          @click=\"fetchRejectReason\"\r\n        >\r\n          반려사유 조회\r\n        </button>\r\n      </div>\r\n    </form>\r\n\r\n    <!-- 반려사유 모달(간단한 프롬프트 형태) -->\r\n    <div v-if=\"showRejectPrompt\" class=\"modal\">\r\n      <div class=\"modal-content\">\r\n        <h4>반려 사유 입력</h4>\r\n        <textarea\r\n          v-model=\"rejectReason\"\r\n          rows=\"4\"\r\n          placeholder=\"반려 사유를 입력하세요\"\r\n        ></textarea>\r\n        <div class=\"modal-actions\">\r\n          <button @click=\"submitReject\" class=\"btn-danger\">반려 처리</button>\r\n          <button @click=\"showRejectPrompt = false\" class=\"btn\">취소</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 반려사유 표시 -->\r\n    <div v-if=\"rejectionInfo\" class=\"card\">\r\n      <h4>최근 반려 이력</h4>\r\n      <p><strong>일자:</strong> {{ rejectionInfo.rejection_date }}</p>\r\n      <p><strong>사유:</strong> {{ rejectionInfo.rejection_reason }}</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onBeforeMount } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport dateFormat from \"@/utils/dateFormat\";\r\n\r\n// 라우터\r\nconst route = useRoute();\r\nconst router = useRouter();\r\n\r\n// 로그인 사용자 정보\r\nconst user = JSON.parse(localStorage.getItem(\"user\") || \"{}\");\r\nconst user_code = user.user_code;\r\nconst userName = user.name || \"\";\r\nconst isAdmin = user.position === \"ADMIN\" || user.role === \"admin\"; // 권한 체크 샘플\r\n\r\nconst today = new Date();\r\ntoday.setHours(0, 0, 0, 0);\r\n\r\n// 상태\r\nconst isUpdated = ref(false);\r\nconst showRejectPrompt = ref(false);\r\nconst rejectReason = ref(\"\");\r\nconst rejectionInfo = ref(null);\r\n\r\n// 이벤트 목록\r\nconst myEvents = ref([]);\r\n\r\n// DB 첨부파일 관리\r\nconst existingAttachments = ref([]); // DB에 저장된 첨부파일 목록\r\nconst newFiles = ref([]); // 업로드할 새 파일들\r\nconst attachmentDeleteList = ref([]);\r\n\r\n// Form 데이터\r\nconst form = ref({\r\n  event_result_code: \"\",\r\n  event_code: \"\",\r\n  result_status: \"BA1\",\r\n  result_subject: \"\",\r\n  result_content: \"\",\r\n  report_register_date: new Date(),\r\n  user_code: user_code,\r\n});\r\n\r\n// 이미 결과보고서 작성한 이벤트는 제외\r\nconst filteredMyEvents = computed(() => {\r\n  return myEvents.value.filter((ev) => ev.event_result_code === null);\r\n});\r\n\r\n// 작성일 포맷\r\nconst formattedReportDate = computed(() =>\r\n  dateFormat(form.value.report_register_date, \"yyyy-MM-dd\")\r\n);\r\n\r\n// --------------------\r\n// 파일 핸들링\r\n// --------------------\r\nconst handleFileChange = (e) => {\r\n  const files = Array.from(e.target.files);\r\n  newFiles.value.push(...files);\r\n};\r\nconst removeNewFile = (idx) => newFiles.value.splice(idx, 1);\r\nconst removeExistingAttachment = (file, idx) => {\r\n  // 프론트에서 바로 삭제 표시; 실제 삭제는 submit 시 서버에서 처리하도록 attachmentDeleteList에 저장\r\n  attachmentDeleteList.value.push(file);\r\n  existingAttachments.value.splice(idx, 1);\r\n};\r\n\r\n// --------------------\r\n// 이벤트 목록 로드\r\n// --------------------\r\nconst loadMyEvents = async () => {\r\n  try {\r\n    const res = await axios.get(\"/api/event/applyResult\", {\r\n      params: { user_code },\r\n    });\r\n\r\n    myEvents.value = res.data.data || [];\r\n  } catch (err) {\r\n    console.error(\"내 이벤트 목록 조회 실패\", err);\r\n  }\r\n};\r\n\r\n// --------------------\r\n// 결과보고서 조회 (수정 모드)\r\n// --------------------\r\nconst getResult = async (resultCode) => {\r\n  try {\r\n    const res = await axios.get(`/api/event/result/${resultCode}`);\r\n    const data = res.data.data;\r\n    if (!data) return;\r\n\r\n    isUpdated.value = true;\r\n    form.value = {\r\n      ...form.value,\r\n      event_result_code: data.event_result_code,\r\n      event_code: data.event_code,\r\n      result_status: data.result_status,\r\n      result_subject: data.result_subject,\r\n      result_content: data.result_content,\r\n      report_register_date: new Date(data.report_register_date),\r\n      user_code: data.user_code,\r\n    };\r\n\r\n    existingAttachments.value = data.attachments || [];\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\n// --------------------\r\n// 페이지 로드 시 실행\r\n// --------------------\r\nonBeforeMount(async () => {\r\n  await loadMyEvents();\r\n\r\n  const resultNo = route.query.resultNo;\r\n  if (resultNo) {\r\n    await getResult(resultNo);\r\n  } else {\r\n    form.value.report_register_date = new Date();\r\n  }\r\n});\r\n\r\n// --------------------\r\n// 등록/수정 제출\r\n// --------------------\r\nconst submitForm = async () => {\r\n  try {\r\n    const formData = new FormData();\r\n    const payload = {\r\n      ...form.value,\r\n      report_register_date: formattedReportDate.value,\r\n      deletedAttachments: attachmentDeleteList.value.map(\r\n        (a) => a.attachment_code || a.id || a.server_filename\r\n      ),\r\n    };\r\n    formData.append(\"resultInfo\", JSON.stringify(payload));\r\n    newFiles.value.forEach((f) => formData.append(\"attachments\", f));\r\n\r\n    if (isUpdated.value) {\r\n      await axios.put(\r\n        `/api/event/result/${form.value.event_result_code}`,\r\n        formData,\r\n        {\r\n          headers: { \"Content-Type\": \"multipart/form-data\" },\r\n        }\r\n      );\r\n      alert(\"결과보고서 수정 완료\");\r\n    } else {\r\n      await axios.post(\"/api/event/result\", formData, {\r\n        headers: { \"Content-Type\": \"multipart/form-data\" },\r\n      });\r\n      alert(\"결과보고서 등록 완료\");\r\n    }\r\n    router.push(\"/event/list\"); // 목록으로 이동\r\n  } catch (err) {\r\n    console.error(err);\r\n    alert(isUpdated.value ? \"수정 실패\" : \"등록 실패\");\r\n  }\r\n};\r\n\r\n// --------------------\r\n// 승인\r\n// --------------------\r\nconst approve = async () => {\r\n  try {\r\n    const code = form.value.event_result_code;\r\n    await axios.post(`/api/event/${code}/approve`);\r\n    alert(\"승인 처리되었습니다.\");\r\n    // 상태 반영 위해 재조회 또는 상태 변경\r\n    if (isUpdated.value) await getResult(code);\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\"승인 중 오류\");\r\n  }\r\n};\r\n\r\n// --------------------\r\n// 반려\r\n// --------------------\r\nconst submitReject = async () => {\r\n  try {\r\n    const code = form.value.event_result_code;\r\n    await axios.post(`/api/event/${code}/reject`, {\r\n      reason: rejectReason.value,\r\n    });\r\n    alert(\"반려 처리되었습니다.\");\r\n    showRejectPrompt.value = false;\r\n    if (isUpdated.value) await getResult(code);\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\"반려 중 오류\");\r\n  }\r\n};\r\n\r\n// 반려 사유 조회\r\nconst fetchRejectReason = async () => {\r\n  try {\r\n    const code = form.value.event_result_code || route.query.resultNo;\r\n    const res = await axios.get(`/api/event/${code}/rejection-reason`);\r\n    rejectionInfo.value = res.data.result;\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\"반려사유 없음 또는 조회 오류\");\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* 기존 디자인 유지 + 간단 모달 스타일 */\r\n.result-form {\r\n  max-width: 900px;\r\n  margin: 20px auto;\r\n  font-family: Arial, sans-serif;\r\n}\r\n.card {\r\n  border: 1px solid #ccc;\r\n  padding: 15px 20px;\r\n  margin-bottom: 20px;\r\n  border-radius: 8px;\r\n  background: #fafafa;\r\n}\r\n.grid-2 {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 15px 20px;\r\n}\r\nlabel {\r\n  display: block;\r\n  font-weight: bold;\r\n  margin-bottom: 4px;\r\n}\r\ninput,\r\nselect,\r\ntextarea {\r\n  width: 100%;\r\n  padding: 6px;\r\n  box-sizing: border-box;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\ntextarea {\r\n  resize: vertical;\r\n}\r\nbutton {\r\n  padding: 6px 12px;\r\n  margin-top: 6px;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n.btn-primary {\r\n  background: #1976d2;\r\n  color: #fff;\r\n}\r\n.btn-danger {\r\n  background: #d32f2f;\r\n  color: #fff;\r\n}\r\n.btn-submit {\r\n  width: auto;\r\n  background-color: #4caf50;\r\n  color: white;\r\n  font-size: 18px;\r\n  padding: 10px 20px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.modal {\r\n  position: fixed;\r\n  left: 0;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: rgba(0, 0, 0, 0.4);\r\n}\r\n.modal-content {\r\n  background: #fff;\r\n  padding: 16px;\r\n  border-radius: 8px;\r\n  width: 90%;\r\n  max-width: 600px;\r\n}\r\n.modal-actions {\r\n  display: flex;\r\n  gap: 8px;\r\n  justify-content: flex-end;\r\n  margin-top: 8px;\r\n}\r\n.submit-wrapper {\r\n  display: flex;\r\n  justify-content: center; /* 수평 중앙 정렬 */\r\n  margin-top: 20px; /* 버튼 위 여백 */\r\n}\r\n</style>\r\n","import script from \"./EventResultAdd.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./EventResultAdd.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./EventResultAdd.vue?vue&type=style&index=0&id=74c4ab1e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-74c4ab1e\"]])\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","user","JSON","parse","localStorage","getItem","user_code","userName","name","isAdmin","position","role","today","Date","setHours","isUpdated","ref","showRejectPrompt","rejectReason","rejectionInfo","myEvents","existingAttachments","newFiles","attachmentDeleteList","form","event_result_code","event_code","result_status","result_subject","result_content","report_register_date","filteredMyEvents","computed","value","filter","ev","formattedReportDate","dateFormat","handleFileChange","e","files","Array","from","target","push","removeNewFile","idx","splice","removeExistingAttachment","file","loadMyEvents","async","res","axios","get","params","data","err","console","error","getResult","resultCode","attachments","onBeforeMount","resultNo","query","submitForm","formData","FormData","payload","deletedAttachments","map","a","attachment_code","id","server_filename","append","stringify","forEach","f","put","headers","alert","post","approve","code","submitReject","reason","fetchRejectReason","result","__exports__"],"sourceRoot":""}