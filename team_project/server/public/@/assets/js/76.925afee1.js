"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[76],{5076:function(e,t,l){l.r(t),l.d(t,{default:function(){return te}});l(8743),l(3725),l(1339);var a=l(641),s=l(2644),i=l(9322),d=l(9841),o=l(5220),n=l(4335),u=l(6698),c=l(2351),r=l(1157);const v=e=>((0,a.Qi)("data-v-2a9b0cdf"),e=e(),(0,a.jt)(),e),p={class:"p-6 max-w-5xl mx-auto"},m={class:"mb-2 flex items-center justify-between header-row"},k=v(()=>(0,a.Lk)("h2",{class:"text-2xl font-semibold"},"조사지 수정",-1)),b={key:0},y={key:1,class:"text-red-600"},f={key:2,class:"empty-state"},C=v(()=>(0,a.Lk)("div",{class:"text-gray-600 mb-2"},"아직 불러올 항목이 없습니다.",-1)),_=v(()=>(0,a.Lk)("p",{class:"text-xs text-gray-400"}," 템플릿 버전을 다시 선택해서 진입해 주세요. ",-1)),x=[C,_],L={key:3,class:"space-y-6"},h={class:"section-header"},g={class:"section-title"},V={class:"space-x-2"},A={class:"grid md:grid-cols-2 gap-3 mb-4"},E={class:"space-y-4"},F={class:"sub-header"},X={class:"font-medium text-sm"},q={class:"space-x-2"},U={class:"grid md:grid-cols-2 gap-3 mb-3"},w={class:"space-y-3"},W={class:"question-header"},K={class:"font-medium text-sm text-gray-800"},z={class:"grid md:grid-cols-3 gap-3"},I=v(()=>(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-500 mb-1"}," 질문 타입 ",-1)),$=["onUpdate:modelValue","onChange"],R=v(()=>(0,a.Lk)("option",{value:"TEXT"},"단답형",-1)),T=v(()=>(0,a.Lk)("option",{value:"TEXTAREA"},"서술형",-1)),O=v(()=>(0,a.Lk)("option",{value:"RADIO"},"단일 선택",-1)),S=v(()=>(0,a.Lk)("option",{value:"CHECKBOX"},"다중 선택",-1)),j=[R,T,O,S],D={class:"md:col-span-2"},B={class:"mt-2"},H={key:0,class:"mt-4 border-t pt-3"},N={class:"flex items-center justify-between mb-2"},Q={class:"text-xs font-medium text-gray-700"},Y={class:"space-y-2"},G={class:"text-[11px] text-gray-500"},J={class:"text-right"},M={class:"form-actions"};var P={__name:"SurveyEdit",setup(e){const t=(0,o.rd)(),l=(0,o.lq)(),v=(0,a.EW)(()=>l.params.templateVerCode??l.params.id),C=(0,d.KR)(!1),_=(0,d.KR)(!1),R=(0,d.KR)(null),T=(0,d.KR)([]),O=(0,d.KR)(null),S=(()=>{let e=1;return()=>e++})(),P=e=>["RADIO","CHECKBOX"].includes(String(e).toUpperCase());function Z(){T.value.push({id:S(),title:"",desc:"",subsections:[]})}function ee(e){T.value.splice(e,1)}function te(e){T.value[e].subsections.push({id:S(),title:"",desc:"",items:[]})}function le(e,t){T.value[e].subsections.splice(t,1)}function ae(e,t){T.value[e].subsections[t].items.push({id:S(),type:"TEXT",text:"",required:!1,options:[]})}function se(e,t,l){T.value[e].subsections[t].items.splice(l,1)}function ie(e){P(e.type)?(Array.isArray(e.options)||(e.options=[]),0===e.options.length&&e.options.push({id:S(),label:""})):e.options=[]}function de(e,t,l){T.value[e].subsections[t].items[l].options.push({id:S(),label:""})}function oe(e,t,l,a){T.value[e].subsections[t].items[l].options.splice(a,1)}function ne(e,t){const l=t?.target?.checked??!e.required;e.required=l}async function ue(){if(!_.value)if(O.value){_.value=!0;try{const e={template:{created_by:1,created_at:(new Date).toISOString().slice(0,10)},sections:T.value.map((e,t)=>({order:t+1,title:e.title,desc:e.desc,subsections:e.subsections.map((e,t)=>({order:t+1,title:e.title,desc:e.desc,items:e.items.map((e,t)=>({order:t+1,question_type:e.type,question_text:e.text,is_required:e.required?"Y":"N",option_values:P(e.type)?e.options.map((e,t)=>{const l=e.label||"";return{label:l,value:l,order:t+1}}):null}))}))}))},{data:l}=await n.A.post(`/api/survey/update/${O.value}`,e);if(!l?.success)throw new Error(l?.message||"저장 실패");alert("새 버전으로 저장 완료!"),t.push({name:"surveyVersion"})}catch(e){console.error("save error:",e),alert(e?.response?.data?.message||e.message||"저장 실패")}finally{_.value=!1}}else alert("메이저 템플릿 코드가 없습니다. 화면을 새로고침해 주세요.")}function ce(){t.push({name:"surveyVersion"})}return(0,a.sV)(async()=>{C.value=!0;try{if(!v.value)throw new Error("세부버전 코드(templateVerCode)가 없습니다.");const e=`/api/survey/detail/ver/${v.value}`,{data:t}=await n.A.get(e),l=t?.result??t;O.value=l?.template_code??null;const a=l.sections||[];T.value=a.map(e=>({id:S(),title:e.section_title??"",desc:e.section_desc??"",subsections:(e.subsections||[]).map(e=>({id:S(),title:e.subsection_title??"",desc:e.subsection_desc??"",items:(e.items||[]).map(e=>({id:S(),type:(e.question_type||"TEXT").toUpperCase(),text:e.question_text??"",required:"Y"===e.is_required,options:(Array.isArray(e.option_values)?e.option_values:[]).map((e,t)=>({id:S(),label:e.label??e.value??"",order:Number(e.order??t+1)}))}))}))}))}catch(e){console.error(e),R.value=e?.response?.data?.message||e.message||"조사지 로드 실패"}finally{C.value=!1}}),(e,t)=>((0,a.uX)(),(0,a.CE)("section",p,[(0,a.Lk)("header",m,[k,(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:ce},{default:(0,a.k6)(()=>[(0,a.eW)(" ← 목록 ")]),_:1})]),C.value?((0,a.uX)(),(0,a.CE)("div",b,"불러오는 중...")):R.value?((0,a.uX)(),(0,a.CE)("div",y,(0,s.v_)(R.value),1)):0===T.value.length?((0,a.uX)(),(0,a.CE)("div",f,x)):((0,a.uX)(),(0,a.CE)("div",L,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(T.value,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"section-card"},[(0,a.Lk)("div",h,[(0,a.Lk)("h3",g,"항목 #"+(0,s.v_)(t+1),1),(0,a.Lk)("div",V,[(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>te(t)},{default:(0,a.k6)(()=>[(0,a.eW)(" 세부항목 추가 ")]),_:2},1032,["onClick"]),(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>ee(t)},{default:(0,a.k6)(()=>[(0,a.eW)(" 삭제 ")]),_:2},1032,["onClick"])])]),(0,a.Lk)("div",A,[(0,a.Lk)("div",null,[(0,a.bF)(c.A,{modelValue:e.title,"onUpdate:modelValue":t=>e.title=t,id:"sec-title-{{ sIndex }}",label:"항목 제목",variant:"static"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a.Lk)("div",null,[(0,a.bF)(c.A,{modelValue:e.desc,"onUpdate:modelValue":t=>e.desc=t,id:"sec-desc-{{ sIndex }}",label:"항목 설명",variant:"static"},null,8,["modelValue","onUpdate:modelValue"])])]),(0,a.Lk)("div",E,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.subsections,(l,d)=>((0,a.uX)(),(0,a.CE)("div",{key:l.id,class:"subsection-card"},[(0,a.Lk)("div",F,[(0,a.Lk)("div",X," 세부항목 #"+(0,s.v_)(d+1),1),(0,a.Lk)("div",q,[(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>ae(t,d)},{default:(0,a.k6)(()=>[(0,a.eW)(" 질문 추가 ")]),_:2},1032,["onClick"]),(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>le(t,d)},{default:(0,a.k6)(()=>[(0,a.eW)(" 삭제 ")]),_:2},1032,["onClick"])])]),(0,a.Lk)("div",U,[(0,a.Lk)("div",null,[(0,a.bF)(c.A,{modelValue:l.title,"onUpdate:modelValue":e=>l.title=e,id:`sub-title-${e.id}-${l.id}`,label:"세부항목 제목",variant:"static"},null,8,["modelValue","onUpdate:modelValue","id"])]),(0,a.Lk)("div",null,[(0,a.bF)(c.A,{modelValue:l.desc,"onUpdate:modelValue":e=>l.desc=e,id:`sub-desc-${e.id}-${l.id}`,label:"세부항목 설명",variant:"static"},null,8,["modelValue","onUpdate:modelValue","id"])])]),(0,a.Lk)("div",w,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.items,(e,l)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"question-card"},[(0,a.Lk)("div",W,[(0,a.Lk)("div",K," 질문 #"+(0,s.v_)(l+1),1),(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>se(t,d,l)},{default:(0,a.k6)(()=>[(0,a.eW)(" 삭제 ")]),_:2},1032,["onClick"])]),(0,a.Lk)("div",z,[(0,a.Lk)("div",null,[I,(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.type=t,class:"w-full input-basic",onChange:t=>ie(e)},j,40,$),[[i.u1,e.type]])]),(0,a.Lk)("div",D,[(0,a.bF)(c.A,{modelValue:e.text,"onUpdate:modelValue":t=>e.text=t,id:`q-text-${e.id}`,label:"질문 내용",variant:"static"},null,8,["modelValue","onUpdate:modelValue","id"])])]),(0,a.Lk)("div",B,[(0,a.bF)(r.A,{id:`required-${e.id}`,name:"required",checked:e.required,labelClass:"text-xs text-gray-700",onChange:t=>ne(e,t)},{default:(0,a.k6)(()=>[(0,a.eW)(" 필수 질문 ")]),_:2},1032,["id","checked","onChange"])]),P(e.type)?((0,a.uX)(),(0,a.CE)("div",H,[(0,a.Lk)("div",N,[(0,a.Lk)("div",Q," 옵션 ("+(0,s.v_)(e.options.length)+") ",1),(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>de(t,d,l)},{default:(0,a.k6)(()=>[(0,a.eW)(" + 옵션 추가 ")]),_:2},1032,["onClick"])]),(0,a.Lk)("div",Y,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.options,(i,o)=>((0,a.uX)(),(0,a.CE)("div",{key:i.id,class:"option-row"},[(0,a.Lk)("div",G," #"+(0,s.v_)(o+1),1),(0,a.Lk)("div",null,[(0,a.bF)(c.A,{modelValue:i.label,"onUpdate:modelValue":e=>i.label=e,id:`op-label-${e.id}-${i.id}`,label:"라벨",variant:"static"},null,8,["modelValue","onUpdate:modelValue","id"])]),(0,a.Lk)("div",J,[(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:e=>oe(t,d,l,o)},{default:(0,a.k6)(()=>[(0,a.eW)(" 삭제 ")]),_:2},1032,["onClick"])])]))),128))])])):(0,a.Q3)("",!0)]))),128))])]))),128))])]))),128)),(0,a.Lk)("div",M,[(0,a.bF)(u.A,{color:"dark",size:"sm",variant:"outlined",onClick:Z},{default:(0,a.k6)(()=>[(0,a.eW)(" + 항목 추가 ")]),_:1}),(0,a.bF)(u.A,{color:"dark",size:"sm",disabled:_.value,onClick:ue},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(_.value?"저장 중...":"수정 저장"),1)]),_:1},8,["disabled"])])]))]))}},Z=l(6262);const ee=(0,Z.A)(P,[["__scopeId","data-v-2a9b0cdf"]]);var te=ee}}]);
//# sourceMappingURL=76.925afee1.js.map