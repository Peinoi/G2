"use strict";(self["webpackChunkvue_material_dashboard_2"]=self["webpackChunkvue_material_dashboard_2"]||[]).push([[848],{2848:function(e,a,t){t.r(a),t.d(a,{default:function(){return ve}});t(8743),t(3725),t(5019),t(9838),t(1339),t(9229);var l=t(641),s=t(2644),n=t(9322),i=t(9841),u=t(5220),o=t(2798),r=t(4335),c=t(6698),d=t(6571),m=t(2351);const v=e=>((0,l.Qi)("data-v-44b660c4"),e=e(),(0,l.jt)(),e),p={class:"p-6"},k={class:"page-shell space-y-6"},f={class:"page-header"},b=v(()=>(0,l.Lk)("h2",{class:"page-title text-2xl md:text-3xl font-bold tracking-tight"}," 상담서 작성 ",-1)),L={class:"header-actions"},h={class:"meta-card"},y={class:"meta-grid"},g={class:"meta-item"},C=v(()=>(0,l.Lk)("span",{class:"meta-label"},"지원자",-1)),_={class:"meta-value"},F={class:"meta-item"},w=v(()=>(0,l.Lk)("span",{class:"meta-label"},"보호자",-1)),x={class:"meta-value"},A={class:"meta-item"},D=v(()=>(0,l.Lk)("span",{class:"meta-label"},"담당자",-1)),B={class:"meta-value"},R={class:"meta-item"},E=v(()=>(0,l.Lk)("span",{class:"meta-label"},"장애유형",-1)),K={class:"meta-value"},z={class:"meta-item"},V=v(()=>(0,l.Lk)("span",{class:"meta-label"},"조사지 제출일",-1)),X={class:"meta-value"},S={class:"meta-item"},I=v(()=>(0,l.Lk)("span",{class:"meta-label"},"상담일",-1)),N={class:"meta-value"},W=["min"],q={class:"card-block space-y-4"},U=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 제목",-1)),$=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 내용",-1)),J=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"첨부 파일",-1)),M=v(()=>(0,l.Lk)("p",{class:"mt-1 text-xs text-gray-500"}," * 여러 개 파일을 한 번에 선택하거나, 나눠서 여러 번 선택할 수 있습니다. ",-1)),T={key:0,class:"mt-2 text-xs text-gray-700 space-y-1"},Q=["href"],O=["onClick"],j={key:1,class:"mt-2 text-xs text-gray-700 space-y-1"},Y={class:"file-link"},G=["onClick"],H={class:"record-header"},P=v(()=>(0,l.Lk)("h4",{class:"font-medium text-sm"},"추가 상담 기록",-1)),Z=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담일: ",-1)),ee=["onUpdate:modelValue","min"],ae=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 제목",-1)),te=v(()=>(0,l.Lk)("label",{class:"block text-sm mb-1 font-medium"},"상담 내용",-1)),le={class:"action-bar"},se={class:"left-actions"},ne={class:"right-actions"},ie=v(()=>(0,l.Lk)("option",{value:"BB1"},"긴급",-1)),ue=v(()=>(0,l.Lk)("option",{value:"BB2"},"중점",-1)),oe=v(()=>(0,l.Lk)("option",{value:"BB3"},"계획",-1)),re=[ie,ue,oe];var ce={__name:"CounselNew",setup(e){const a=(0,o.n)(),t=(0,u.lq)(),v=(0,u.rd)(),ie=Number(t.params.submitCode),ue=(0,i.KR)({name:"",ssnFront:"",submitAt:""}),oe=(0,l.EW)(()=>{const e=ue.value.submitAt;return e?e.slice(0,10):""}),ce=(0,i.KR)({counselDate:"",title:"",content:""}),de=(0,i.KR)([]),me=(0,i.KR)(null),ve=(0,i.KR)([]),pe=(0,i.KR)([]),ke=(0,i.KR)([]),fe=(0,i.KR)("BB3"),be=(0,i.KR)(!1),Le=(0,i.KR)("");async function he(){be.value=!0,Le.value="";try{const{data:e}=await r.A.get(`/api/counsel/${ie}`);if(!e?.success||!e.result)throw new Error(e?.message||"상담 기본 정보를 찾을 수 없습니다.");const a=e.result;a.submit_info&&(ue.value=a.submit_info)}catch(e){console.error(e),Le.value=e.message||"상담 기본 정보 조회 중 오류"}finally{be.value=!1}}function ye(e){const a=Array.from(e.target.files||[]),t=a.filter(e=>!de.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified));de.value=[...de.value,...t],e.target&&(e.target.value="")}function ge(e){de.value.splice(e,1)}function Ce(e){pe.value.includes(e)||pe.value.push(e),ve.value=ve.value.filter(a=>a.attachCode!==e)}async function _e(){try{const e={submitCode:ie,priority:fe.value,mainForm:ce.value,records:ke.value,removeAttachmentCodes:pe.value},a=new FormData;a.append("formJson",JSON.stringify(e)),de.value.forEach(e=>{a.append("mainFiles",e)});const t=await r.A.post("/api/counsel/temp",a,{headers:{"Content-Type":"multipart/form-data"}});t.data?.success?alert("임시 저장이 완료되었습니다."):alert(t.data.message||"임시 저장 실패")}catch(e){console.error(e),alert("서버 오류: "+(e.response?.data?.message||e.message))}}async function Fe(){try{const{data:e}=await r.A.get(`/api/counsel/${ie}`);if(!e?.success||!e.result)return void alert(e?.message||"불러올 상담 내용이 없습니다.");const a=e.result;a.submit_info&&(ue.value=a.submit_info),ce.value={counselDate:a.main?.counsel_date||"",title:a.main?.title||"",content:a.main?.content||""},fe.value=a.priority||"BB3",ke.value=(a.details||[]).map((e,a)=>({id:e.detail_code||Date.now()+a,counselDate:e.counsel_date||"",title:e.title||"",content:e.content||""}))||[],ve.value=(a.attachments||[]).map(e=>({attachCode:e.attachCode,originalFilename:e.originalFilename,url:e.url}))||[],de.value=[],pe.value=[],alert("임시 저장된 내용을 불러왔습니다.")}catch(e){console.error(e),alert("상담 내용 불러오기 중 오류: "+(e.response?.data?.message||e.message))}}function we(){window.open(`/survey/submission/${ie}`,"_blank")}function xe(){v.push({name:"counselList"})}function Ae(){ke.value.push({id:Date.now(),counselDate:"",title:"",content:""})}function De(e){ke.value=ke.value.filter(a=>a.id!==e)}function Be(){if(!ce.value.counselDate)return"상담일을 입력해주세요.";if(oe.value&&ce.value.counselDate<oe.value)return"상담일은 조사지 제출일보다 이전일 수 없습니다.";if(!ce.value.title.trim())return"상담 제목을 입력해주세요.";if(!ce.value.content.trim())return"상담 내용을 입력해주세요.";for(const e of ke.value){if(!e.counselDate)return"추가 상담 기록의 상담일을 입력해주세요.";if(oe.value&&e.counselDate<oe.value)return"추가 상담 기록의 상담일은 조사지 제출일보다 이전일 수 없습니다.";if(!e.title.trim())return"추가 상담 기록의 제목을 입력해주세요.";if(!e.content.trim())return"추가 상담 기록의 내용을 입력해주세요."}return null}async function Re(){const e=Be();if(e)alert(e);else try{const e={submitCode:ie,priority:fe.value,mainForm:ce.value,records:ke.value,removeAttachmentCodes:pe.value,modifier:a.userCode,requesterCode:a.userCode},t=new FormData;t.append("formJson",JSON.stringify(e)),de.value.forEach(e=>{t.append("mainFiles",e)});const l=await r.A.post("/api/counsel/new",t,{headers:{"Content-Type":"multipart/form-data"}});l.data?.success?(alert("상담 저장 완료!"),v.push({name:"counselList"})):alert(l.data.message||"저장 실패")}catch(t){console.error(t),alert("서버 오류: "+(t.response?.data?.message||t.message))}}return(0,l.sV)(()=>{a.reload(),he()}),(e,a)=>((0,l.uX)(),(0,l.CE)("section",p,[(0,l.Lk)("div",k,[(0,l.Lk)("header",f,[b,(0,l.Lk)("div",L,[(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:Fe},{default:(0,l.k6)(()=>[(0,l.eW)(" 불러오기 ")]),_:1}),(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:_e},{default:(0,l.k6)(()=>[(0,l.eW)(" 임시 저장 ")]),_:1})])]),(0,l.Lk)("div",h,[(0,l.Lk)("div",y,[(0,l.Lk)("div",g,[C,(0,l.Lk)("span",_,(0,s.v_)(ue.value.childName||"본인"),1)]),(0,l.Lk)("div",F,[w,(0,l.Lk)("span",x,(0,s.v_)(ue.value.guardianName||"-"),1)]),(0,l.Lk)("div",A,[D,(0,l.Lk)("span",B,(0,s.v_)(ue.value.assigneeName||"-"),1)]),(0,l.Lk)("div",R,[E,(0,l.Lk)("span",K,(0,s.v_)(ue.value.disabilityType||"-"),1)]),(0,l.Lk)("div",z,[V,(0,l.Lk)("span",X,[(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:we},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(oe.value),1)]),_:1})])]),(0,l.Lk)("div",S,[I,(0,l.Lk)("span",N,[(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=e=>ce.value.counselDate=e),class:"input",min:oe.value},null,8,W),[[n.Jo,ce.value.counselDate]])])])])]),(0,l.Lk)("div",q,[(0,l.Lk)("div",null,[U,(0,l.bF)(m.A,{id:"main-title",variant:"static",size:"default",modelValue:ce.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.value.title=e),placeholder:"상담 제목을 입력하세요"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[$,(0,l.bF)(d.A,{id:"main-content",variant:"outline",rows:5,placeholder:"상담 내용을 입력하세요...",value:ce.value.content,onInput:a[2]||(a[2]=e=>ce.value.content=e.target.value)},null,8,["value"])]),(0,l.Lk)("div",null,[J,(0,l.Lk)("input",{ref_key:"fileInputRef",ref:me,type:"file",multiple:"",onChange:ye,class:"file-input"},null,544),M,ve.value.length?((0,l.uX)(),(0,l.CE)("ul",T,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ve.value,e=>((0,l.uX)(),(0,l.CE)("li",{key:e.attachCode,class:"file-row"},[(0,l.Lk)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",class:"file-link"},(0,s.v_)(e.originalFilename),9,Q),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:a=>Ce(e.attachCode)}," 삭제 ",8,O)]))),128))])):(0,l.Q3)("",!0),de.value.length?((0,l.uX)(),(0,l.CE)("ul",j,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(de.value,(e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:e.name+"_"+e.lastModified+"_"+a,class:"file-row"},[(0,l.Lk)("span",Y,(0,s.v_)(e.name)+" ("+(0,s.v_)((e.size/1024).toFixed(1))+" KB) ",1),(0,l.Lk)("button",{type:"button",class:"chip-button",onClick:e=>ge(a)}," 삭제 ",8,G)]))),128))])):(0,l.Q3)("",!0)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ke.value,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"record-card space-y-4"},[(0,l.Lk)("div",H,[P,(0,l.bF)(c.A,{color:"dark",size:"sm",variant:"outlined",onClick:a=>De(e.id)},{default:(0,l.k6)(()=>[(0,l.eW)(" 제거 ")]),_:2},1032,["onClick"])]),(0,l.Lk)("div",null,[Z,(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":a=>e.counselDate=a,class:"input",min:oe.value},null,8,ee),[[n.Jo,e.counselDate]])]),(0,l.Lk)("div",null,[ae,(0,l.bF)(m.A,{id:`record-title-${e.id}`,variant:"static",size:"default",modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"상담 제목을 입력하세요"},null,8,["id","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",null,[te,(0,l.bF)(d.A,{id:`record-content-${e.id}`,variant:"outline",rows:3,placeholder:"상담 내용을 입력하세요...",value:e.content,onInput:a=>e.content=a.target.value},null,8,["id","value","onInput"])])]))),128)),(0,l.Lk)("div",le,[(0,l.Lk)("div",se,[(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:xe},{default:(0,l.k6)(()=>[(0,l.eW)(" 작성 취소 ")]),_:1}),(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:Ae},{default:(0,l.k6)(()=>[(0,l.eW)(" + 상담 기록 추가 ")]),_:1})]),(0,l.Lk)("div",ne,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value=e),class:"input priority-select"},re,512),[[n.u1,fe.value]]),(0,l.bF)(c.A,{color:"dark",size:"sm",onClick:Re},{default:(0,l.k6)(()=>[(0,l.eW)(" 작성 완료 ")]),_:1})])])])]))}},de=t(6262);const me=(0,de.A)(ce,[["__scopeId","data-v-44b660c4"]]);var ve=me},6571:function(e,a,t){t.d(a,{A:function(){return d}});var l=t(641),s=t(2644);const n=["id","rows","name","value","placeholder","isRequired","disabled"];function i(e,a,t,i,u,o){return(0,l.uX)(),(0,l.CE)("div",{class:(0,s.C4)(["input-group",`input-group-${t.variant} ${o.getStatus(t.error,t.success)}`])},[(0,l.Lk)("textarea",{id:t.id,class:"form-control",rows:t.rows,name:t.name,value:t.value,placeholder:t.placeholder,isRequired:t.isRequired,disabled:t.disabled},null,8,n)],2)}var u=t(5685),o={name:"MaterialTextarea",props:{variant:{type:String,default:"outline"},id:{type:String,required:!0},name:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"Your text here..."},isRequired:Boolean,disabled:{type:Boolean,default:!1},rows:{type:Number,default:5},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},mounted(){(0,u.A)()},methods:{getStatus:(e,a)=>{let t;return t=a?"is-valid":e?"is-invalid":null,t}}},r=t(6262);const c=(0,r.A)(o,[["render",i]]);var d=c}}]);
//# sourceMappingURL=848.8e4733a9.js.map